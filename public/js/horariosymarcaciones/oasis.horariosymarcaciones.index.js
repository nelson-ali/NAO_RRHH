function getParametroVacio(){return{idOrganigrama:0,idArea:0,idUbicacion:0,idMaquina:0,idRelaboral:0,fechaIni:"",fechaFin:""}}function definirGrillaParaListaRelaborales(e,a){var t,n={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"fecha_nac",type:"date"},{name:"edad",type:"integer"},{name:"lugar_nac",type:"integer"},{name:"genero",type:"integer"},{name:"e_civil",type:"integer"},{name:"id_relaboral",type:"integer"},{name:"id_persona",type:"integer"},{name:"tiene_contrato_vigente",type:"integer"},{name:"tiene_contrato_vigente_descripcion",type:"string"},{name:"id_fin_partida",type:"integer"},{name:"finpartida",type:"string"},{name:"ubicacion",type:"string"},{name:"id_condicion",type:"integer"},{name:"condicion",type:"string"},{name:"item",type:"integer"},{name:"tiene_item",type:"integer"},{name:"id_cargo",type:"integer"},{name:"cargo_codigo",type:"string"},{name:"cargo_resolucion_ministerial_id",type:"integer"},{name:"cargo_resolucion_ministerial",type:"string"},{name:"estado",type:"integer"},{name:"estado_descripcion",type:"string"},{name:"nombres",type:"string"},{name:"ci",type:"string"},{name:"expd",type:"string"},{name:"num_complemento",type:"string"},{name:"id_organigrama",type:"integer"},{name:"gerencia_administrativa",type:"string"},{name:"departamento_administrativo",type:"string"},{name:"id_area",type:"integer"},{name:"area",type:"string"},{name:"id_ubicacion",type:"integer"},{name:"ubicacion",type:"string"},{name:"num_contrato",type:"string"},{name:"fin_partida",type:"string"},{name:"partida",type:"integer"},{name:"id_procesocontratacion",type:"integer"},{name:"proceso_codigo",type:"string"},{name:"nivelsalarial",type:"string"},{name:"nivelsalarial_resolucion",type:"string"},{name:"cargo",type:"string"},{name:"sueldo",type:"numeric"},{name:"fecha_ini",type:"date"},{name:"fecha_incor",type:"date"},{name:"fecha_fin",type:"date"},{name:"fecha_baja",type:"date"},{name:"motivo_baja",type:"string"},{name:"relaboral_previo_id",type:"integer"},{name:"observacion",type:"string"},{name:"fecha_ing",type:"date"}],url:"/relaborales/listactivosengestion?gestion="+e,cache:!1},r=new $.jqx.dataAdapter(n);t=prepareSimulator("grid"),$("#divGridRelaborales").jqxGrid({theme:t,width:"100%",height:"590px",source:r,sortable:!0,altRows:!0,groupable:!0,columnsresize:!0,pageable:!0,pagerMode:"advanced",showfilterrow:!0,filterable:!0,showtoolbar:!0,autorowheight:!0,selectionmode:"checkbox",enablebrowserselection:!0,rendertoolbar:function(e){var a=$("<div></div>");e.append(a),a.append("<button id='generatemarcrowbutton' class='btn btn-sm btn-primary' type='button'  title='Formulario para la generaci&oacute;n de la matriz de marcaciones previstas y efectivas para una gesti&oacute;n y mes determinados.'><i class='fa fa-flag-checkered fa-2x text-primary' title='Formulario para la generaci&oacute;n de la matriz de marcaciones previstas y efectivas para una gesti&oacute;n y mes determinados.'/></i></button>"),a.append("<button id='calculaterowbutton' class='btn btn-sm btn-primary' type='button'  title='Formulario para el c&aacute;lculo de asistencia.'><i class='gi gi-calculator fa-2x text-warning' title='Formulario para el c&aacute;lculo de asistencia.'/></i></button>"),a.append("<button title='Ver calendario de turnos y permisos de manera global para la persona.' id='turnrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-calendar fa-2x text-success' title='Vista Turnos Laborales por relaci&oacute;n laboral.'/></i></button>"),a.append("<button title='Exportar resumen a CSV.' id='csvrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-file-text-o fa-2x text-default' title='Exportar resumen a CSV.'/></i></button>"),a.append("<button title='Refrescar Grilla' id='refreshbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-repeat fa-2x text-default' title='Refrescar grilla.'/></i></button>"),a.append("<button title='Desagrupar.' id='cleargroupsrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-chain-broken fa-2x text-default' title='Desagrupar.'/></i></button>"),a.append("<button title='Desfiltrar.' id='clearfiltersrowbutton' class='btn btn-sm btn-primary' type='button'><i class='gi gi-sorting fa-2x text-default' title='Desfiltrar.'/></i></button>"),$("#generatemarcrowbutton").jqxButton(),$("#calculaterowbutton").jqxButton(),$("#turnrowbutton").jqxButton(),$("#csvrowbutton").jqxButton(),$("#refreshbutton").jqxButton(),$("#cleargroupsrowbutton").jqxButton(),$("#clearfiltersrowbutton").jqxButton(),$("#hdnIdRelaboralVista").val(0),$("#divCalculoFechas").hide(),$("#listrowbutton").off(),$("#listrowbutton").on("click",function(){var e=$("#divGridRelaborales").jqxGrid("getselectedrowindex");if(0<=e){var a=$("#divGridRelaborales").jqxGrid("getrowdata",e);if(null!=a){var t=a.id_relaboral;if($(".msjs-alert").hide(),$("#hdnIdPersonaHistorial").val(a.id_persona),0<=a.tiene_contrato_vigente){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs("disableAt",3),$("#divTabControlMarcaciones").jqxTabs("enableAt",1),$("#divTabControlMarcaciones").jqxTabs({selectedItem:1}),$("#tabFichaPersonal").jqxTabs({theme:"oasis",width:"100%",height:"100%",position:"top"}),$("#tabFichaPersonal").jqxTabs({selectedItem:0}),$("#ddNombres").html(a.nombres);var n=obtenerRutaFoto(a.ci,a.num_complemento);$("#imgFotoPerfilContactoPer").attr("src",n),$("#imgFotoPerfilContactoInst").attr("src",n),$("#imgFotoPerfil").attr("src",n),cargarPersonasContactosHorariosYMarcaciones(1,a.id_persona),$("#hdnIdRelaboralVista").val(t),$("#hdnSwPrimeraVistaHistorial").val(0),$("#divContent_"+a.id_relaboral).focus().select(),definirGrillaParaListaControlMarcacionesDebidasYRealizadasPorIdRelaboral(a)}else{var r="Para acceder a la vista del registro, la persona debe haber tenido al menos un registro de relaci&oacute,n laboral que implica un estado ACTIVO o PASIVO.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}}else{var r="Debe seleccionar un registro necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}),$("#generatemarcrowbutton").off(),$("#generatemarcrowbutton").on("click",function(){var e=$("#divGridRelaborales").jqxGrid("selectedrowindexes");if(0<e.length){$("#popupGestionMesGeneracionMarcaciones").modal("show"),$("#divCalculoFechas").hide();var a=new Date,t=a.getDate(),n=a.getMonth()+1,r=a.getMonth()+1,i=a.getFullYear(),o=a.getFullYear(),c=$("#lstGestion").val();i!=c&&(t=1,n=12,i=c);var l="";t<=9&&(l="0");var s="";n<=9&&(s="0");var d=l+t+"-"+s+n+"-"+i,p=l+t+"-"+s+n+"-"+i,h="01-"+n+"-"+i,u=obtenerUltimoDiaMes(h);cargarGestionesDisponiblesParaGeneracionMarcaciones(i),cargarMesesDisponiblesParaGeneracionMarcaciones(i,n),cargarTiposDisponiblesParaGeneracionMarcaciones(i,n,0),$("#lstGestionGeneracionMarcaciones").off(),$("#lstGestionGeneracionMarcaciones").on("change",function(){cargarMesesDisponiblesParaGeneracionMarcaciones($("#lstGestionGeneracionMarcaciones").val(),0),cargarTiposDisponiblesParaGeneracionMarcaciones($("#lstGestionGeneracionMarcaciones").val(),0,0),$("#divCalculoFechas").hide()}),$("#lstMesGeneracionMarcaciones").off(),$("#lstMesGeneracionMarcaciones").on("change",function(){cargarTiposDisponiblesParaGeneracionMarcaciones($("#lstGestionGeneracionMarcaciones").val(),$("#lstMesGeneracionMarcaciones").val(),0),$("#divCalculoFechas").hide()}),$("#lstTipoGeneracionMarcaciones").off(),$("#lstTipoGeneracionMarcaciones").on("change",function(){1==this.value||3==this.value?(h="01-"+$("#lstMesGeneracionMarcaciones").val()+"-"+$("#lstGestionGeneracionMarcaciones").val(),u=obtenerUltimoDiaMes(h),p=$("#lstMesGeneracionMarcaciones").val()!=r||c!=o?(d=h,u):d=t+"-"+n+"-"+i,$("#divCalculoFechas").show(),$("#txtCalculoFechaIni").datepicker("remove"),$("#txtCalculoFechaIni").datepicker({format:"dd-mm-yyyy",weekStart:1,startDate:h,endDate:u,autoclose:!0}),$("#txtCalculoFechaIni").datepicker("update",d),$("#txtCalculoFechaFin").datepicker("remove"),$("#txtCalculoFechaFin").datepicker({format:"dd-mm-yyyy",weekStart:1,startDate:h,endDate:u,autoclose:!0}),$("#txtCalculoFechaFin").datepicker("update",p),$("#txtCalculoFechaIni").focus()):$("#divCalculoFechas").hide()}),$("#lstGestionGeneracionMarcaciones").focus()}else $("#divMsjePorError").html(""),$("#divMsjePorError").append("Debe al menos seleccionar un registro para solicitar la generaci&oacute;n de las marcaciones previstas y efectivas."),$("#divMsjeNotificacionError").jqxNotification("open")}),$("#calculaterowbutton").off(),$("#calculaterowbutton").on("click",function(){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),$("#divTabControlMarcaciones").jqxTabs("enableAt",2),$("#divTabControlMarcaciones").jqxTabs({selectedItem:2}),$("#divTabControlMarcaciones").jqxTabs("disableAt",3),$("#txtFechaIniCalculo").datepicker("update",""),$("#txtFechaIniCalculo").val("").datepicker("update"),$("#txtFechaFinCalculo").datepicker("update",""),$("#txtFechaFinCalculo").val("").datepicker("update"),$("#txtCiCalculo").val(""),$("#strongCantidadCis").text(0),$("#txtCiCalculo").tagsinput("removeAll");for(var e=$("#divGridRelaborales").jqxGrid("selectedrowindexes"),a=0;a<e.length;a++){var t=$("#divGridRelaborales").jqxGrid("getrowdata",e[a]);$("#txtCiCalculo").tagsinput("add",t.ci)}var n={ci:"",idOrganigrama:0,idArea:0,idUbicacion:0,idMaquina:0,idRelaboral:0,fechaIni:"",fechaFin:""},r=new Date,i=r.getDate(),o=r.getMonth()+1,c=r.getFullYear(),l=i+"-"+o+"-"+c;$("#txtFechaIniCalculo").datepicker("update",l),$("#txtFechaFinCalculo").datepicker("update",l),definirGrillaMarcacionesYCalculos(n)}),$("#turnrowbutton").off(),$("#turnrowbutton").on("click",function(){var e=$("#divGridRelaborales").jqxGrid("getselectedrowindex");if(0<=e){var a=$("#divGridRelaborales").jqxGrid("getrowdata",e);if(null!=a){var t=$("#divGridRelaborales").jqxGrid("selectedrowindexes");if(1==t.length){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs("enableAt",3),$("#divTabControlMarcaciones").jqxTabs({selectedItem:3}),$("#spanPrefijoCalendarioLaboral").html(""),$("#spanSufijoCalendarioLaboral").html(" Vs. Calendario de Excepciones (Individual)");var n=new Date,r=n.getDate(),i=n.getMonth(),o=n.getFullYear();0==a.estado&&(r=a.fecha_baja.getDate(),i=a.fecha_baja.getMonth(),o=a.fecha_baja.getFullYear()),$("#calendar").html("");var c=iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignaciones(a,a.id_relaboral,5,0,3,[],o,i,r);sumarTotalHorasPorSemana(c),$("#btnRefrescarCalendarioLaboralAndExcept").off(),$("#btnRefrescarCalendarioDetalle").off(),$("#btnRefrescarCalendarioLaboralAndExcept, #btnRefrescarCalendarioDetalle").on("click",function(){$("#calendar").html("");var e=iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignaciones(a,a.id_relaboral,5,0,3,[],o,i,r);sumarTotalHorasPorSemana(e)})}else{var l="Debe seleccionar un s&oacute;lo registro para la obtención de la vista de turnos laborales correspondientes.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(l),$("#divMsjeNotificacionError").jqxNotification("open")}}else{var l="Para acceder a la vista del registro, la persona debe haber tenido al menos un registro de relaci&oacute,n laboral que implica un estado ACTIVO o PASIVO.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(l),$("#divMsjeNotificacionError").jqxNotification("open")}switch($("#tabFichaPersonalTurnAndExcept").jqxTabs({theme:"oasis",width:"100%",height:"100%",position:"top"}),$("#tabFichaPersonalTurnAndExcept").jqxTabs({selectedItem:0}),$(".ddNombresTurnAndExcept").html(a.nombres+"&nbsp;"),$(".ddCIAndNumComplementoExpdTurnAndExcept").html(a.ci+a.num_complemento+" "+a.expd+"&nbsp;"),$("#ddCargoTurnAndExcept").html(a.cargo+"&nbsp;"),$("#ddProcesoTurnAndExcept").html(a.proceso_codigo+"&nbsp;"),$("#ddFinanciamientoTurnAndExcept").html(a.condicion+" (Partida "+a.partida+")"),$("#ddGerenciaTurnAndExcept").html(a.gerencia_administrativa+"&nbsp;"),""!=a.departamento_administrativo&&null!=a.departamento_administrativo?($("#ddDepartamentoTurnAndExcept").show(),$("#dtDepartamentoTurnAndExcept").show(),$("#ddDepartamentoTurnAndExcept").html(a.departamento_administrativo+"&nbsp;")):($("#dtDepartamentoTurnAndExcept").hide(),$("#ddDepartamentoTurnAndExcept").hide()),$("#ddUbicacionTurnAndExcept").html(a.ubicacion+"&nbsp;"),a.tiene_item){case 1:$("#dtItemTurnAndExcept").show(),$("#ddItemTurnAndExcept").show(),$("#ddItemTurnAndExcept").html(a.item+"&nbsp;");break;case 0:$("#dtItemTurnAndExcept").hide(),$("#ddItemTurnAndExcept").hide()}if($("#ddNivelSalarialTurnAndExcept").html(a.nivelsalarial+"&nbsp;"),$("#ddHaberTurnAndExcept").html(a.sueldo+"&nbsp;"),$("#ddFechaIngTurnAndExcept").html(fechaConvertirAFormato(a.fecha_ing,"-")+"&nbsp;"),null!=a.fecha_incor){var s=fechaConvertirAFormato(a.fecha_incor,"-");$("#dtFechaIncorTurnAndExcept").show(),$("#ddFechaIncorTurnAndExcept").show(),$("#ddFechaIncorTurnAndExcept").html(s+"&nbsp;")}else $("#dtFechaIncorTurnAndExcept").hide(),$("#ddFechaIncorTurnAndExcept").hide();switch($("#ddFechaIniTurnAndExcept").html(fechaConvertirAFormato(a.fecha_ini,"-")+"&nbsp;"),a.tiene_item){case 1:$("#dtFechaFinTurnAndExcept").hide(),$("#ddFechaFinTurnAndExcept").hide();break;case 0:$("#dtFechaFinTurnAndExcept").show(),$("#ddFechaFinTurnAndExcept").show(),$("#ddFechaFinTurnAndExcept").html(fechaConvertirAFormato(a.fecha_fin,"-")+"&nbsp;")}$("#ddEstadoDescripcionTurnAndExcept").html(a.estado_descripcion+"&nbsp;"),0==a.estado?($("#dtFechaBajaTurnAndExcept").show(),$("#ddFechaBajaTurnAndExcept").show(),$("#ddFechaBajaTurnAndExcept").html(fechaConvertirAFormato(a.fecha_baja,"-")+"&nbsp;"),$("#dtMotivoBajaTurnAndExcept").show(),$("#ddMotivoBajaTurnAndExcept").show(),$("#ddMotivoBajaTurnAndExcept").html(a.motivo_baja+"&nbsp;")):($("#dtFechaBajaTurnAndExcept").hide(),$("#ddFechaBajaTurnAndExcept").hide(),$("#dtMotivoBajaTurnAndExcept").hide(),$("#ddMotivoBajaTurnAndExcept").hide()),$("#ddNombresTurnAndExcept").html(a.nombres);var d=obtenerRutaFoto(a.ci,a.num_complemento);$("#imgFotoPerfilTurnAndExceptRelaboral").attr("src",d),$("#imgFotoPerfilContactoPerTurnAndExcept").attr("src",d),$("#imgFotoPerfilContactoInstTurnAndExcept").attr("src",d),$("#imgFotoPerfilTurnAndExcept").attr("src",d),cargarPersonasContactosHorariosYMarcaciones(2,a.id_persona)}else{var l="Debe seleccionar un registro necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(l),$("#divMsjeNotificacionError").jqxNotification("open")}}),$("#csvrowbutton").off(),$("#csvrowbutton").on("click",function(){for(var t="",e=$("#divGridRelaborales").jqxGrid("selectedrowindexes"),a=0;a<e.length;a++){var n=$("#divGridRelaborales").jqxGrid("getrowdata",e[a]);t+=n.id_relaboral+","}t=(t+=",").replace(",,","");var r=$("#lstGestion").val(),i=new Date,o=i.getFullYear(),c=i.getMonth()+1;c=o==r?(r=o,i.getMonth()+1):1,cargarMesesParaResumenCsv(1,r,c),cargarMesesParaResumenCsv(2,r,c),$("#lstMesInicioExportacionResumenCsv").on("change",function(){cargarMesesParaResumenCsv(2,r,$(this).val())}),$("#popupExportacionResumenCsv").modal("show"),$("#btnAplicarExportacionResumenCsv").off(),$("#btnAplicarExportacionResumenCsv").on("click",function(){var e=$("#lstMesInicioExportacionResumenCsv").val(),a=$("#lstMesFinalExportacionResumenCsv").val();exportarResumenCsv(r,e,a,t)})}),$("#refreshbutton").on("click",function(){$("#divGridRelaborales").jqxGrid("updatebounddata")}),$("#cleargroupsrowbutton").off(),$("#cleargroupsrowbutton").on("click",function(){$("#divGridRelaborales").jqxGrid("cleargroups")}),$("#clearfiltersrowbutton").off(),$("#clearfiltersrowbutton").on("click",function(){$("#divGridRelaborales").jqxGrid("clearfilters")})},columns:[{text:"Nro.",sortable:!1,filterable:!1,editable:!1,groupable:!1,draggable:!1,resizable:!1,columntype:"number",pinned:!0,width:50,cellsalign:"center",align:"center",cellsrenderer:rownumberrenderer},{text:"Nombres y Apellidos",columntype:"textbox",filtertype:"input",datafield:"nombres",pinned:!0,width:215,align:"center",hidden:a.hdnNombres.hidden},{text:"CI",columntype:"textbox",filtertype:"input",datafield:"ci",pinned:!0,width:90,cellsalign:"center",align:"center",hidden:a.hdnCi.hidden},{text:"Expd",filtertype:"checkedlist",datafield:"expd",pinned:!0,width:40,cellsalign:"center",align:"center",hidden:a.hdnExpd.hidden},{text:"Genero",filtertype:"checkedlist",datafield:"genero",filteritems:["F","M"],pinned:!1,width:40,cellsalign:"center",align:"center",hidden:a.hdnGenero.hidden},{text:"Edad",filtertype:"checkedlist",datafield:"edad",width:40,cellsalign:"center",align:"center",hidden:a.hdnEdad.hidden},{text:"Fecha Nac",datafield:"fecha_nac",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:a.hdnFechaNac.hidden},{text:"Ubicaci&oacute;n",filtertype:"checkedlist",datafield:"ubicacion",width:150,cellsalign:"center",align:"center",hidden:a.hdnUbicacion.hidden},{text:"Condici&oacute;n",filtertype:"checkedlist",datafield:"condicion",width:150,cellsalign:"center",align:"center",hidden:a.hdnCondicion.hidden},{text:"Estado",filtertype:"checkedlist",datafield:"estado_descripcion",width:100,cellsalign:"center",align:"center",hidden:a.hdnEstadoDescripcion.hidden,cellclassname:cellclass},{text:"Activo",filtertype:"checkedlist",datafield:"tiene_contrato_vigente_descripcion",filteritems:["SI","NO"],width:50,cellsalign:"center",align:"center",hidden:a.hdnActivo.hidden,cellclassname:cellclass},{text:"Gerencia",filtertype:"checkedlist",datafield:"gerencia_administrativa",width:220,align:"center",hidden:a.hdnGerencia.hidden},{text:"Departamento",filtertype:"checkedlist",datafield:"departamento_administrativo",width:220,align:"center",hidden:a.hdnDepartamento.hidden},{text:"&Aacute;rea",filtertype:"checkedlist",datafield:"area",width:220,align:"center",hidden:a.hdnArea.hidden},{text:"Proceso",filtertype:"checkedlist",datafield:"proceso_codigo",width:220,cellsalign:"center",align:"center",hidden:a.hdnProcesoContratacion.hidden},{text:"Fuente",filtertype:"checkedlist",datafield:"fin_partida",width:220,cellsalign:"center",align:"center",hidden:a.hdnFuente.hidden},{text:"Nivel Salarial",filtertype:"checkedlist",datafield:"nivelsalarial",width:220,align:"center",hidden:a.hdnNivelSalarial.hidden},{text:"Cargo",columntype:"textbox",filtertype:"input",datafield:"cargo",width:215,align:"center",hidden:a.hdnCargo.hidden},{text:"Haber",filtertype:"checkedlist",datafield:"sueldo",width:100,cellsalign:"right",align:"center",hidden:a.hdnHaber.hidden},{text:"Fecha Ingreso",datafield:"fecha_ing",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:a.hdnFechaIng.hidden},{text:"Fecha Inicio",datafield:"fecha_ini",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:a.hdnFechaIni.hidden},{text:"Fecha Incor.",datafield:"fecha_incor",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:a.hdnFechaIncor.hidden},{text:"Fecha Fin",datafield:"fecha_fin",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:a.hdnFechaFin.hidden},{text:"Fecha Baja",datafield:"fecha_baja",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:a.hdnFechaBaja.hidden},{text:"Motivo Baja",datafield:"motivo_baja",width:100,hidden:a.hdnMotivoBaja.hidden},{text:"Observacion",datafield:"observacion",width:100,hidden:a.hdnObservacion.hidden}]})}$().ready(function(){$("#divProgressBar").hide();$("#divTabControlMarcaciones").jqxTabs("theme","oasis"),$("#divTabControlMarcaciones").jqxTabs("enableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs("disableAt",3);var t={hdnNombres:{title:"Nombres y Apellidos",selectable:!0,hidden:!0},hdnCi:{title:"CI",selectable:!1,hidden:!1},hdnExpd:{title:"Expd",selectable:!1,hidden:!1},hdnGenero:{title:"Genero",selectable:!0,hidden:!0},hdnEdad:{title:"Edad",selectable:!0,hidden:!0},hdnFechaNac:{title:"Fecha Nac",selectable:!0,hidden:!0},hdnUbicacion:{title:"Ubicacion",selectable:!0,hidden:!0},hdnCondicion:{title:"Condicion",selectable:!0,hidden:!0},hdnEstadoDescripcion:{title:"Estado",selectable:!1,hidden:!1},hdnActivo:{title:"Activo",selectable:!0,hidden:!0},hdnGerencia:{title:"Gerencia",selectable:!1,hidden:!1},hdnDepartamento:{title:"Departamento",selectable:!0,hidden:!0},hdnArea:{title:"Area",selectable:!0,hidden:!0},hdnProcesoContratacion:{title:"Proceso",selectable:!0,hidden:!0},hdnFuente:{title:"Fuente",selectable:!0,hidden:!0},hdnNivelSalarial:{title:"Nivel",selectable:!0,hidden:!0},hdnCargo:{title:"Cargo",selectable:!0,hidden:!0},hdnHaber:{title:"Haber",selectable:!0,hidden:!0},hdnFechaIng:{title:"Fecha Ingreso",selectable:!0,hidden:!0},hdnFechaIni:{title:"Fecha Inicio",selectable:!0,hidden:!0},hdnFechaIncor:{title:"Fecha Incor.",selectable:!0,hidden:!0},hdnFechaFin:{title:"Fecha Fin",selectable:!0,hidden:!0},hdnFechaBaja:{title:"Fecha Baja",selectable:!0,hidden:!0},hdnMotivoBaja:{title:"Motivo Baja",selectable:!0,hidden:!0},hdnObservacion:{title:"Observacion",selectable:!0,hidden:!0}};$.each(t,function(e,a){(1==$("#"+e).val()&&1==a.selectable||0==a.selectable||null==$("#"+e).val())&&(t[e].hidden=!1)}),defineColumnasOcultas("divGridRelaborales","divComboColumnasVisibles","chkAllColumnasVisibles",t),cargarGestionesRelaborales((new Date).getFullYear()),definirGrillaParaListaRelaborales($("#lstGestion").val(),t),$("#lstGestion").off(),$("#lstGestion").on("change",function(){definirGrillaParaListaRelaborales($("#lstGestion").val(),t)}),$("#btnGuardarControlExcepcionNew").on("click",function(){validaFormularioControlExcepciones(1)&&(guardaControlExcepciones(1)&&($("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("enableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs({selectedItem:1}),$("#msjs-alert").hide()))}),$("#btnGuardarControlExcepcionEdit").on("click",function(){validaFormularioControlExcepciones(2)&&(guardaControlExcepciones(2)&&($("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("enableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs({selectedItem:1}),$("#msjs-alert").hide()))}),$("#btnAplicarGestionGeneracionMarcaciones").on("click",function(){var e=$("#lstGestionGeneracionMarcaciones").val(),a=$("#lstMesGeneracionMarcaciones").val(),t=$("#lstTipoGeneracionMarcaciones").val();$(".progress-bar",".bars-container").each(function(){$(this).css("width","0%").html("0%")});var n="01-"+a+"-"+e,r="01-"+a+"-"+e;if(1!=t&&3!=t||(n=$("#txtCalculoFechaIni").val(),r=$("#txtCalculoFechaFin").val()),0<e&&0<a&&0<t&&""!=n&&""!=r){$("#popupGestionMesGeneracionMarcaciones").modal("hide");for(var i=$("#divGridRelaborales").jqxGrid("selectedrowindexes"),o=0,c=0,l=i.length,s=0;s<i.length;s++){var d=n,p=r;0==s&&$("#divProgressBar").show();var h=$("#divGridRelaborales").jqxGrid("getrowdata",i[s]),u="",m="";if(0==h.estado&&null!=h.fecha_baja&&""!=h.fecha_baja){u=fechaConvertirAFormato(h.fecha_baja,"-");procesaTextoAFecha(p,"-")>procesaTextoAFecha(u,"-")&&(p=u)}m=null!=h.fecha_incor&&""!=h.fecha_incor?fechaConvertirAFormato(h.fecha_incor,"-"):"";var b=!1,f=!1;switch(t){case"1":(b=generarMarcacion(1,h.id_relaboral,e,a,d,p,"H",h.estado,m,u))&&(f=generarMarcacion(1,h.id_relaboral,e,a,d,p,"M",h.estado,m,u));break;case"2":b=generarMarcacion(1,h.id_relaboral,e,a,d,p,"H",h.estado,m,u);break;case"3":f=generarMarcacion(1,h.id_relaboral,e,a,d,p,"M",h.estado,m,u)}c++,b&&f&&o++;var v=parseFloat(100*c/l);v=v.toFixed(0),$(".progress-bar",".bars-container").each(function(){var e=v+"%";$(this).css("width",e).html(e+" ["+c+":"+l+"]")})}if(setTimeout(function(){$("#divProgressBar").hide()},3e3),0<o&&o===l){var g="Se generaron los registros de marcacion prevista y efectiva para "+o+" registros de relacion laboral.";$("#divMsjePorSuccess").html(""),$("#divMsjePorSuccess").append(g),$("#divMsjeNotificacionSuccess").jqxNotification("open"),alert(g)}else{g="Se generaron "+o+" registros de marcacion prevista y efectiva para "+l+" registros de relacion laboral seleccionadas.";$("#divMsjePorWarning").html(""),$("#divMsjePorWarning").append(g),$("#divMsjeNotificacionWarning").jqxNotification("open"),alert(g)}}}),$("#btnGuardarBaja").click(function(){validaFormularioPorBajaRegistro()&&guardarRegistroBaja()}),$("#btnVolverDesdeMarcaciones").click(function(){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs("disableAt",3),$("#msjs-alert").hide()}),$("#btnExportarMarcacionesExcel").on("click",function(){exportarReporteHorariosYMarcaciones(1,idRelaboral)}),$("#btnExportarMarcacionesPDF").on("click",function(){exportarReporteHorariosYMarcaciones(2,idRelaboral)}),$("#btnImprimirCalendarioLaboralAndExcept").on("click",function(){$("#page-content").printArea({mode:"popup",popClose:!1})}),$("#btnImprimirCalendarioDetalle").on("click",function(){$("#divCalendarioDetalles").printArea({mode:"popup",popClose:!1})}),$("#lstMotivosBajas").change(function(){var e=this.value.split("_");$("#hdnFechaRenBaja").val(e[0]),$("#hdnFechaAceptaRenBaja").val(e[1]),$("#hdnFechaAgraServBaja").val(e[2]),0<e[0]?defineFechasBajas(e[1],e[2],e[3]):$("#divFechasBaja").hide()}),$("#chkAi").on("click",function(){var e=$("#txtCargoMovilidad").val();("object"==jQuery.type(e)&&(e=String(e.label)),null!=(e+="")&&""!=e)&&(1==this.checked?e.indexOf("a.i.")<0&&(e+=" a.i.",$("#txtCargoMovilidad").val(e)):0<e.indexOf("a.i.")&&(e=e.replace("a.i.","").trim(),$("#txtCargoMovilidad").val(e)))}),$("#btnCalcular").on("click",function(){getParametroVacio();var t=0;$.each(1,function(e,a){t++});var e=$("#txtFechaIniCalculo").val(),a=$("#txtFechaFinCalculo").val(),n=$("#txtCiCalculo").val()+"",r=0;""!=n&&(r=n.split(",").length);if(0<r)if(""!=e&&null!=e&&""!=a&&null!=a&&0<t){definirGrillaMarcacionesYCalculos({ci:n,idOrganigrama:0,idArea:0,idUbicacion:0,idMaquina:0,idRelaboral:0,fechaIni:e,fechaFin:a})}else{$("#divMsjePorError").html(""),$("#divMsjePorError").append("Debe seleccionar las fechas para el rango en el cual se obtendr&aacute; el c&aacute;lculo."),$("#divMsjeNotificacionError").jqxNotification("open"),""!=e?$("#txtFechaFinCalculo").focus():$("#txtFechaIniCalculo").focus()}else alert("Debe seleccionar al menos un persona de la cual se obtendrá el reporte solicitado.")}),$("#popupGeneradorMarcacionDebida").on("hidden.bs.modal",function(){$("#divGridControlMarcaciones").jqxGrid("updatebounddata")}),$("#txtCiCalculo").on("itemAdded",function(e){var a=$("#txtCiCalculo").val()+"";if(""!=a){var t=a.split(",");$("#strongCantidadCis").text(t.length)}else $("#strongCantidadCis").text(0)}),$("#txtCiCalculo").on("itemRemoved",function(e){var a=$("#txtCiCalculo").val()+"";if(""!=a){var t=a.split(",");$("#strongCantidadCis").text(t.length)}else $("#strongCantidadCis").text(0)}),$("#liList,#btnCancelarTurnAndExcept,#btnVolverDesdeCalculos").click(function(){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs({selectedItem:0}),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs("disableAt",3),$("#msjs-alert").hide()}),$("#liExcept").click(function(){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("enableAt",1),$("#divTabControlMarcaciones").jqxTabs({selectedItem:1}),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#msjs-alert").hide()}),$("#btnDesfiltrartodomarcaciones").click(function(){$("#divGridControlMarcaciones").jqxGrid("clearfilters")}),$("#btnDesagrupartodomarcaciones").click(function(){$("#divGridControlMarcaciones").jqxGrid("cleargroups")}),$(".numeral").keyup(function(e){""!=$(this).val()&&$(this).val($(this).val().replace(/[^0-9]/g,""))}),$(".literal").keyup(function(e){""!=$(this).val()&&$(this).val($(this).val().replace(/[^A-Z,a-z,ñ,Ñ, ]/g,""))}),$("#divMsjeNotificacionError").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:7e3,template:"error"}),$("#divMsjeNotificacionWarning").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:7e3,template:"warning"}),$("#divMsjeNotificacionSuccess").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:7e3,template:"success"}),$(document).keypress(OperaEvento),$(document).keyup(OperaEvento)});var rownumberrenderer=function(e,a,t,n,r,i){return"<div align='center'>"+(e+1)+"</div>"};function OperaEvento(e){"keyup"!=e.type&&"keydown"!=e.type||"27"!=e.which||($("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs("disableAt",3),$("#divTabControlMarcaciones").jqxTabs({selectedItem:0}),$("#divGridRelaborales").jqxGrid("updatebounddata"))}function procesaTextoAFecha(e,a){var t=e.split(a);return(e=new Date(t[1]+"/"+t[0]+"/"+t[2])).getTime()}function obtenerRutaFoto(e,a){var t="/images/perfil-profesional.jpg";return""!=e&&$.ajax({url:"/relaborales/obtenerrutafoto/",type:"POST",datatype:"json",async:!1,cache:!1,data:{ci:e,num_complemento:a},success:function(e){var a=jQuery.parseJSON(e);1==a.result&&(t=a.ruta)},error:function(){alert("Se ha producido un error Inesperado")}}),t}function fechaHoy(e,a){""==e&&(e="-");var t=new Date,n=t.getDate().toString(),r=(t.getMonth()+1).toString(),i=1===n.length?"0"+n:n,o=1===r.length?"0"+r:r;if("dd-mm-yyyy"==a)var c=i+e+o+e+t.getFullYear();else if("mm-dd-yyyy"==a)c=o+e+i+e+t.getFullYear();else c=t;return c}var cellclass=function(e,a,t){return"ACTIVO"==t?"verde":"EN PROCESO"==t?"amarillo":"PASIVO"==t?"rojo":""};function obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(e,a,t,F,n,r,i){var C=[],o=new Date,T=(o.getDate(),o.getMonth(),o.getFullYear(),!0);switch(t){case 1:case 2:T=!0}return $.ajax({url:"/calendariolaboral/listallregisteredbyrelaboralmixto",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e,id_perfillaboral:a,fecha_ini:n,fecha_fin:r},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){var t=0,n="00:00:00",r="24:00:00",i="#000000",o="DESCANSO",c=(a.perfil_laboral,a.perfil_laboral_grupo);null!=a.id_horariolaboral?(t=a.id_horariolaboral,o=a.horario_nombre,n=a.hora_entrada.split(":"),r=a.hora_salida.split(":"),i=a.color):(n=n.split(":"),r=r.split(":"));var l=a.calendario_fecha_ini.split("-"),s=l[0],d=l[1]-1,p=l[2],h=n[0],u=n[1],m=(n[2],a.calendario_fecha_fin.split("-")),b=m[0],f=m[1]-1,$=m[2],v=r[0],g=r[1],x=(r[2],"r_");0==t&&(x="d_");var y=i;F||(y="#000000",x="b_"),C.push({id:a.id_calendariolaboral,className:x+t,title:o,start:new Date(s,d,p,h,u),end:new Date(b,f,$,v,g),allDay:T,color:i,textColor:y,editable:F,borderColor:y,horas_laborales:a.horas_laborales,dias_laborales:a.dias_laborales,hora_entrada:a.hora_entrada,hora_salida:a.hora_salida,tipo_evento:"h",icon:"fa fa-clock-o"})})}}),C}function ImageExist(e){var a=new Image;return a.src=e,0!=a.height}function fechaConvertirAFormato(e,a){""==a&&(a="-");var t=e,n=t.getDate(),r=t.getMonth(),i="",o="";return n<10&&(i="0"),(r+=1)<10&&(o="0"),i+n+a+o+r+a+t.getFullYear()}function iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignaciones(u,m,e,b,f,a,t,n,r){f=parseInt(f);var v=[],g=7,i=($(".calendar-events"),"prev,next"),o="year",c=!0,l=!0,s=!0,d=!0;switch(e){case 1:case 2:case 3:switch(f){case 1:case 2:break;case 3:i="",o="year"}break;case 4:break;case 5:s=l=c=!1}switch(f){case 1:case 2:d=!1,!(g=5)}return $("#calendar").fullCalendar({header:{left:i,center:"title",right:o},year:t,month:n,date:r,firstDay:1,weekends:d,editable:c,droppable:l,selectable:s,weekNumbers:!0,weekNumberTitle:"#S",timeFormat:"H(:mm)",drop:function(e,a){var t=$(this).data("eventObject"),n=$.extend({},t);n.start=e,$("#calendar").fullCalendar("renderEvent",n,!0),sumarTotalHorasPorSemana(v)},eventDrop:function(e,a,t,n,r){sumarTotalHorasPorSemana(v)},events:a,eventClick:function(r,e,a){var i=r.className+"",t=i.split("_"),n=t[1];i=t[0];var o=0;null!=r.id&&(o=r.id);var c=fechaConvertirAFormato(r.start,"-"),l=c,s=r.start;null!=r.end&&""!=r.end&&(l=fechaConvertirAFormato(r.end,"-"),s=r.end);var d=r.start,p=s,h=s;($("#txtHorarioFechaIni").datepicker("setDate",r.start),$("#txtHorarioFechaFin").datepicker("setDate",s),$("#txtHorarioFechaIni").datepicker({format:"dd-mm-yyyy",default:r.start,weekStart:1,startDate:d,endDate:p,autoclose:!0}).on("changeDate",function(e){(d=new Date(e.date.valueOf())).setDate(d.getDate(new Date(e.date.valueOf()))),$("#txtHorarioFechaFin").datepicker("setStartDate",d)}),$("#txtHorarioFechaFin").datepicker({default:s,weekStart:1,startDate:d,endDate:h,autoclose:!0}).on("changeDate",function(e){(p=new Date(e.date.valueOf())).setDate(p.getDate(new Date(e.date.valueOf()))),$("#txtHorarioFechaIni").datepicker("setEndDate",p)}),0<n)?cargarModalHorario(n)?("b"==i?($("#btnDescartarHorario").hide(),$("#btnGuardarModificacionHorario").hide(),$("#txtHorarioFechaIni").prop("disabled","disabled"),$("#txtHorarioFechaFin").prop("disabled","disabled")):($("#btnDescartarHorario").show(),$("#txtHorarioFechaIni").prop("disabled",!1),$("#txtHorarioFechaFin").prop("disabled",!1)),$("#popupDescripcionHorario").modal("show"),$("#btnDescartarHorario").off(),$("#btnDescartarHorario").on("click",function(){switch(i){case"r":case"d":bajaTurnoEnCalendario(o)&&($("#calendar").fullCalendar("removeEvents",r._id),$("#popupDescripcionHorario").modal("hide"));break;case"n":$("#calendar").fullCalendar("removeEvents",r._id),$("#popupDescripcionHorario").modal("hide")}sumarTotalHorasPorSemana(v)}),$("#btnGuardarModificacionHorario").off(),$("#btnGuardarModificacionHorario").on("click",function(){switch(i){case"r":case"n":if(c!=$("#txtHorarioFechaIni").val()||l!=$("#txtHorarioFechaFin").val()){$("#calendar").fullCalendar("removeEvents",r._id),$("#popupDescripcionHorario").modal("hide");var e=$("#txtHorarioFechaIni").val(),a=$("#txtHorarioFechaFin").val(),t=e.split("-"),n=a.split("-");e=t[2]+"-"+t[1]+"-"+t[0],a=n[2]+"-"+n[1]+"-"+n[0],addEvent={id:r.id,title:r.title,className:r.className,start:e,end:a,color:r.color,editable:!0,hora_entrada:r.hora_entrada,hora_salida:r.hora_salida},$("#calendar").fullCalendar("renderEvent",addEvent,!0)}$("#popupDescripcionHorario").modal("hide")}sumarTotalHorasPorSemana(v)})):alert("Error al determinar los datos del horario."):alert("El registro corresponde a una boleta de excepción (permiso) o una marcación.")},eventResize:function(e,a,t){sumarTotalHorasPorSemana(v)},eventRender:function(e,a){var t=e.tipo_evento+"";if("c"===t||"h"===t){var n='<i class="'+e.icon+'"></i> ';$(a).find(".fc-event-title").prepend(n)}if("m"===t){var r=(e.className+"").replace("_"," ");$(a).tooltip({title:"Marcación en "+r})}},viewRender:function(e){switch(e.name){case"month":removerColumnaSumaTotales(),agregarColumnaSumaTotales(g);var i="",o="";v=[];var c=0,l=0,a=["mon","tue","wed","thu","fri","sat","sun"];$.each(a,function(e,a){l=0,$("td.fc-"+a).map(function(e,a){l++;var t=$(this).data("date"),n=$(this).data("date");if(null!=t){var r=t.split("-");switch(t=r[2]+"-"+r[1]+"-"+r[0],c=r[0],l){case 1:""==i&&(i=t),v.push({semana:1,fecha:t});break;case 2:v.push({semana:2,fecha:t});break;case 3:v.push({semana:3,fecha:t});break;case 4:v.push({semana:4,fecha:t});break;case 5:v.push({semana:5,fecha:t});break;case 6:o=t,v.push({semana:6,fecha:t})}n<$.fullCalendar.formatDate(new Date,"yyyy-MM-dd")&&$(this).css("background-color","#efefef")}})});var t="",n="",r=(t=fechaConvertirAFormato($("#calendar").fullCalendar("getDate"),"-")).split("-");n=obtenerUltimoDiaMes(t="01-"+r[1]+"-"+r[2]),$("#hdnFechaInicialCalendario").val(t),$("#hdnFechaFinalCalendario").val(n),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(b,m,i,o);var s=obtenerArrExcepcionesEnCalendarioPorRango(u,e.name,g,i,o);$("#calendar").fullCalendar("removeEvents");var d=obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(m,0,f,!1,i,o,0);$("#calendar").fullCalendar("addEventSource",d),$("#calendar").fullCalendar("addEventSource",s);var p=obtenerFeriadosRangoFechas(0,0,c,i,o);$.each(a,function(e,a){l=0,$("td.fc-"+a).map(function(e,a){l++;$(this).data("date");var t=$(this).data("date"),n="",r="",i=$(this);$.each(p,function(e,a){n=a.fecha_ini,r=a.fecha_fin;if(t<=r&&n<=t){$(".fc-day-content");i.append("<h6><b>(f) "+a.feriado+"</b></h6>"),i.css("background-color","orange")}})})}),sumarTotalHorasPorSemana(v);var h=obtenerTodasMarcacionesRegistradas(u.ci,i,o);$("#calendar").fullCalendar("addEventSource",h);break;case"agendaWeek":n=obtenerFechaMasDias(t=fechaConvertirAFormato(t=$("#calendar").fullCalendar("getView").start,"-"),g-1),$("#hdnFechaInicialCalendario").val(t),$("#hdnFechaFinalCalendario").val(n),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(b,m,t,n);break;case"agendaDay":n=t=fechaConvertirAFormato($("#calendar").fullCalendar("getDate"),"-"),$("#hdnFechaInicialCalendario").val(t),$("#hdnFechaFinalCalendario").val(n),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(b,m,t,n)}}}),v}function sumarTotalHorasPorSemana(a){var e=$("#calendar").fullCalendar("clientEvents"),o=0,c=0,l=0,s=0,d=0,p=0;$("#spSumaSemana1").html(0),$("#spSumaSemana2").html(0),$("#spSumaSemana3").html(0),$("#spSumaSemana4").html(0),$("#spSumaSemana5").html(0),$("#spSumaSemana6").html(0),$("#tdSumaSemana1").css("background-color","white"),$("#tdSumaSemana2").css("background-color","white"),$("#tdSumaSemana3").css("background-color","white"),$("#tdSumaSemana4").css("background-color","white"),$("#tdSumaSemana5").css("background-color","white"),$("#tdSumaSemana6").css("background-color","white"),$.each(e,function(e,t){var n=$.fullCalendar.formatDate(t.start,"dd-MM-yyyy"),r=$.fullCalendar.formatDate(t.end,"dd-MM-yyyy");""==r&&(r=n);var i="-";$.each(a,function(e,a){1==a.semana&&procesaTextoAFecha(n,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(r,i)&&(o+=parseFloat(t.horas_laborales)),2==a.semana&&procesaTextoAFecha(n,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(r,i)&&(c+=parseFloat(t.horas_laborales)),3==a.semana&&procesaTextoAFecha(n,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(r,i)&&(l+=parseFloat(t.horas_laborales)),4==a.semana&&procesaTextoAFecha(n,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(r,i)&&(s+=parseFloat(t.horas_laborales)),5==a.semana&&procesaTextoAFecha(n,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(r,i)&&(d+=parseFloat(t.horas_laborales)),6==a.semana&&procesaTextoAFecha(n,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(r,i)&&(p+=parseFloat(t.horas_laborales))})}),$("#spSumaSemana1").html(o.toFixed(2)),$("#spSumaSemana2").html(c.toFixed(2)),$("#spSumaSemana3").html(l.toFixed(2)),$("#spSumaSemana4").html(s.toFixed(2)),$("#spSumaSemana5").html(d.toFixed(2)),$("#spSumaSemana6").html(p.toFixed(2));var t=(c+l+s)/3;$("#spSumaPromedioTresSemanas").html(t.toFixed(2));48<o?$("#tdSumaSemana1").css("background-color","#FF4000"):$("#tdSumaSemana1").css("background-color","white"),48<c?$("#tdSumaSemana2").css("background-color","#FF4000"):$("#tdSumaSemana2").css("background-color","#efefef"),48<l?$("#tdSumaSemana3").css("background-color","#FF4000"):$("#tdSumaSemana3").css("background-color","#efefef"),48<s?$("#tdSumaSemana4").css("background-color","#FF4000"):$("#tdSumaSemana4").css("background-color","#efefef"),48<d?$("#tdSumaSemana5").css("background-color","#FF4000"):$("#tdSumaSemana5").css("background-color","white"),48<p?$("#tdSumaSemana6").css("background-color","#FF4000"):$("#tdSumaSemana6").css("background-color","white"),48<t?$("#tdSumaPromedioTresSemanas").css("background-color","red"):$("#tdSumaPromedioTresSemanas").css("background-color","white")}function agregarColumnaSumaTotales(e){$(".fc-border-separate tr:first").append("<th style='width: 87px;' id='thColumnaTotales' class='thColumnaTotales'> Hrs Semana </th>");var t=0;$(".fc-border-separate tr.fc-week").each(function(e,a){t++,$(this).append("<td id='tdSumaSemana"+t+"' class='tdSumaSemana fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaSemana"+t+"' class='fc-day-suma-horas-semana'><span id='spSumaSemana"+t+"' class='spSumaSemana'>100</span></div></div></td>")});var a=e+1;$(".fc-border-separate tr:last").after("<tr id=''><td style='text-align: right;' colspan='"+a+"' class=''><b>Promedio semanal de horas (3 Semanas marcadas):</b></td><td id='tdSumaPromedioTresSemanas' class='tdSumaPromedioTresSemanas fc-first fc-day fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaPromedioTresSemanas' class='fc-suma-promedio-horas-3-semanas'><span id='spSumaPromedioTresSemanas'>0</span></div></div></td></tr>")}function removerColumnaSumaTotales(){$("#thColumnaTotales").remove(),$("#tdSumaSemana1").remove(),$("#tdSumaSemana2").remove(),$("#tdSumaSemana3").remove(),$("#tdSumaSemana4").remove(),$("#tdSumaSemana5").remove(),$("#tdSumaSemana6").remove(),$("#trSumaPromedioTresSemanas").remove()}function numeroHoras(e){if(""==e)return 0;var a=e.split(":"),t=parseFloat(a[0]),n=parseFloat(a[1]),r=parseFloat(a[2]),i=0,o=0;return 0<r&&(i=r/60),0<(n+=i)&&(o=n/60),t+=o}function cargarGrillaAsignacionIndividualFechasUbicacionEstacion(e,a,t,n){var r,i={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"perfil_laboral",type:"string"},{name:"perfil_laboral_grupo",type:"string"},{name:"calendario_fecha_ini",type:"date"},{name:"calendario_fecha_fin",type:"date"},{name:"horario_nombre",type:"string"},{name:"relaboralperfilmaquina_ubicacion_entrada",type:"string"},{name:"relaboralperfilmaquina_estacion_entrada",type:"string"},{name:"relaboralperfilmaquina_ubicacion_salida",type:"string"},{name:"relaboralperfilmaquina_estacion_salida",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",type:"string"},{name:"relaboralperfil_observacion",type:"string"}],url:"/calendariolaboral/getlistallregisteredbyrelaboral?id="+a+"&fecha_ini="+t+"&fecha_fin="+n,cache:!1},o=new $.jqx.dataAdapter(i);r=prepareSimulator("grid"),$("#divGridCalendario").jqxGrid({theme:r,width:"100%",height:"530px",source:o,sortable:!0,altRows:!0,columnsresize:!0,pageable:!0,pagerMode:"advanced",showfilterrow:!0,filterable:!0,autorowheight:!0,enablebrowserselection:!0,columns:[{text:"Nro.",filterable:!1,columntype:"number",width:40,cellsalign:"center",align:"center",cellsrenderer:rownumberrenderer},{text:"Perfil",filtertype:"checkedlist",datafield:"perfil_laboral",width:100,align:"center",hidden:!1},{text:"Grupo",filtertype:"checkedlist",datafield:"perfil_laboral_grupo",width:100,align:"center",hidden:!1},{text:"Fecha Inicio",datafield:"calendario_fecha_ini",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Fin",datafield:"calendario_fecha_fin",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Horario",filtertype:"checkedlist",datafield:"horario_nombre",width:100,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_entrada",width:130,align:"center",hidden:!1},{text:"Estaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_entrada",width:100,align:"center",hidden:!1},{text:"Tipo Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",width:190,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_salida",width:100,align:"center",hidden:!1},{text:"Estaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_salida",width:100,align:"center",hidden:!1},{text:"Tipo Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",width:190,align:"center",hidden:!1},{text:"Observaci&oacute;n",filtertype:"checkedlist",datafield:"relaboralperfil_observacion",width:130,align:"center",hidden:!1}]})}function obtenerUltimoDiaMes(e){return e=$.ajax({url:"/perfileslaborales/getultimafechames/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:e},success:function(e){}}).responseText}function obtenerFechaMasDias(e,a){return e=$.ajax({url:"/perfileslaborales/getfechamasdias/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:e,dias:a},success:function(e){}}).responseText}function cerrarMensaje(e){alert("llego: "+e)}function cargarGestionesDisponiblesParaGeneracionMarcaciones(t){var n="";$("#lstGestionGeneracionMarcaciones").html(""),$("#lstGestionGeneracionMarcaciones").append("<option value=''>Seleccionar</option>"),$("#lstGestionGeneracionMarcaciones").prop("disabled",!1);$.ajax({url:"/perfileslaborales/getgestiones/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id_perfillaboral:0},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){n+="<option value='"+a+"' "+(t==a?"selected":"")+">"+a+"</option>"})}}),""!=n?$("#lstGestionGeneracionMarcaciones").append(n):$("#lstGestionGeneracionMarcaciones").prop("disabled",!0)}function cargarMesesParaResumenCsv(t,e,n){var r="Inicio";2==t&&(r="Final");var i="";$("#lstMes"+r+"ExportacionResumenCsv").html(""),$("#lstMes"+r+"ExportacionResumenCsv").append("<option value=''>Seleccionar</option>"),$("#lstMes"+r+"ExportacionResumenCsv").prop("disabled",!0);null!=n&&null!=n&&0<n&&($.each(["ENERO","FEBRERO","MARZO","ABRIL","MAYO","JUNIO","JULIO","AGOSTO","SEPTIEMBRE","OCTUBRE","NOVIEMBRE","DICIEMBRE"],function(e,a){selected=n==e+1?"selected":"",1==t?i+="<option value='"+(e+1)+"' "+selected+">"+a+"</option>":n<=e+1&&(i+="<option value='"+(e+1)+"' "+selected+">"+a+"</option>"),$("#lstMes"+r+"ExportacionResumenCsv").prop("disabled",!1)}),$("#lstMes"+r+"ExportacionResumenCsv").append(i))}function cargarMesesDisponiblesParaGeneracionMarcaciones(e,t){$("#lstMesGeneracionMarcaciones").html(""),$("#lstMesGeneracionMarcaciones").append("<option value=''>Seleccionar</option>"),$("#lstMesGeneracionMarcaciones").prop("disabled",!1);var n="",r="";0<e?($.ajax({url:"/horariosymarcaciones/getmeses/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:e},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){r=t==a.mes?"selected":"",n+="<option value='"+a.mes+"' "+r+">"+a.mes_nombre+"</option>"})}}),""!=n?$("#lstMesGeneracionMarcaciones").append(n):$("#lstMesGeneracionMarcaciones").prop("disabled",!0)):$("#lstMesGeneracionMarcaciones").prop("disabled",!0)}function cargarTiposDisponiblesParaGeneracionMarcaciones(e,a,t){$("#lstTipoGeneracionMarcaciones").html(""),$("#lstTipoGeneracionMarcaciones").append("<option value=''>Seleccionar</option>"),$("#lstTipoGeneracionMarcaciones").prop("disabled",!1);var n="",r="";0<e&&0<a?($.ajax({url:"/horariosymarcaciones/gettiposgeneracion/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:e,mes:a},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){r=t==a.tipo?"selected":"",n+="<option value='"+a.tipo+"' "+r+">"+a.tipo_descripcion+"</option>"})}}),""!=n?$("#lstTipoGeneracionMarcaciones").append(n):$("#lstTipoGeneracionMarcaciones").prop("disabled",!0)):$("#lstTipoGeneracionMarcaciones").prop("disabled",!0)}function obtenerFechaIniFinCalendario(e,a){var t="",n="";return 0<e&&0<a&&$.ajax({url:"/calendariolaboral/obtenerfechainifincalendario/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:e,mes:a},success:function(e){var a=jQuery.parseJSON(e);1==a.result&&(t=a.fecha_ini,n=a.fecha_fin)}}),{fecha_ini:t,fecha_fin:n}}function cargarGestionesRelaborales(t){var n="";$("#lstGestion").html(""),$("#lstGestion").append("<option value='0'>TODAS</option>"),$.ajax({url:"/relaborales/getgestionesrelaborales/",type:"POST",datatype:"json",async:!1,cache:!1,success:function(e){var a=jQuery.parseJSON(e);$.each(a,function(e,a){n=t==a?"selected":"",$("#lstGestion").append("<option value='"+a+"' "+n+">"+a+"</option>")})},error:function(){alert("Se ha producido un error Inesperado")}})}function obtenerTodasMarcacionesRegistradas(e,a,t){var u=[],m="transparent";return $.ajax({url:"/marcaciones/getandsavemarcaciones",type:"POST",datatype:"json",async:!1,cache:!1,data:{ci:e,fecha_ini:a,fecha_fin:t},success:function(e){var a=jQuery.parseJSON(e);if(1==a.result){var t=a.data,d=a.stations,p=a.colors,h="";$.each(t,function(s,e){$.each(e,function(e,a){if(null!=a&&null!=p[s]){var t=s.split("-"),n=yf=t[2],r=mf=t[1]-1,i=df=t[0],o=a.split(":"),c=hs=o[0],l=ms=o[1];m=null!=p[s][a]&&null!=p[s][a]?p[s][a]:"transparent",h=null!=d[s][a]&&null!=d[s][a]?(h=d[s][a]+"").replace(" ","_"):"",u.push({id:s+"_"+a,className:h,textColor:"#000",title:a,start:new Date(n,r,i,c,l),end:new Date(yf,mf,df,hs,ms),allDay:!0,color:m,editable:!1,borderColor:"#000",horas_laborales:0,dias_laborales:0,hora_entrada:a,hora_salida:a,tipo_evento:"m",icon:"fa fa-bullseye"})}})})}}}),u}