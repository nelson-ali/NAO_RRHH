function iniciarCalendarioDeActividades(){var e=new Date,a=e.getFullYear(),t=e.getMonth(),i=e.getDate(),l=[];return $("#divCalendarioActividades").fullCalendar({header:{left:"prev,next",center:"title",right:"year"},year:a,month:t,date:i,firstDay:1,weekends:!0,editable:!0,droppable:!0,selectable:!0,weekNumbers:!0,weekNumberTitle:"#S",timeFormat:"H(:mm)",eventClick:function(e,a,t){(e.className+"").split("_");var i=e.nombres,n=e.ci,r=e.expd,o=e.cargo,c=e.gerencia_administrativa,s=e.departamento_administrativo;$("#pNombres").text(i),$("#pCI").text(n+" "+r),$("#pCargo").text(o),$("#pGerenciaAdministrativa").text(c),$("#pDepartamentoAdministrativo").text(s),""!=s?$("#divDepartamentoAdministrativo").show():$("#divDepartamentoAdministrativo").hide();var d=obtenerRutaFoto(n,"");$("#pFechaCumple").text(e.fecha_cumple),$("#imgFotoPerfil").attr("src",d),$("#popupInformacionPersona").modal("show")},events:[],eventRender:function(e,a){$(a).find(".fc-event-title").prepend('<i class="gi gi-birthday_cake text-danger"></i> ')},viewRender:function(e){switch($("#divCalendarioActividadesMarcaciones").html(""),e.name){case"month":var r="",o="";l=[];var c=0,s=0,a=["mon","tue","wed","thu","fri","sat","sun"];$.each(a,function(e,a){s=0,$("td.fc-"+a).map(function(e,a){s++;var t=$(this).data("date"),i=$(this).data("date");if(null!=t){var n=t.split("-");switch(t=n[2]+"-"+n[1]+"-"+n[0],c=n[0],s){case 1:""==r&&(r=t),l.push({semana:1,fecha:t});break;case 2:l.push({semana:2,fecha:t});break;case 3:l.push({semana:3,fecha:t});break;case 4:l.push({semana:4,fecha:t});break;case 5:l.push({semana:5,fecha:t});break;case 6:o=t,l.push({semana:6,fecha:t})}i<$.fullCalendar.formatDate(new Date,"yyyy-MM-dd")&&$(this).css("background-color","silver")}})}),$("#divCalendarioActividades").fullCalendar("removeEvents");r=$.fullCalendar.formatDate($("#divCalendarioActividades").fullCalendar("getView").visStart,"dd-MM-yyyy"),o=$.fullCalendar.formatDate(sumarDias($("#divCalendarioActividades").fullCalendar("getView").visEnd,-1),"dd-MM-yyyy");var t=obtenerPersonasConCumpleRegistradas(r,o);$("#divCalendarioActividades").fullCalendar("addEventSource",t);a=["mon","tue","wed","thu","fri","sat","sun"];$.each(a,function(e,a){$("td.fc-"+a).map(function(e,a){$(this).data("date")<$.fullCalendar.formatDate(new Date,"yyyy-MM-dd")&&$(this).css("background-color","silver")})});var d=obtenerFeriadosRangoFechas(0,0,c,r,o);$.each(a,function(e,a){s=0,$("td.fc-"+a).map(function(e,a){s++;$(this).data("date");var t=$(this).data("date"),i="",n="",r=$(this);$.each(d,function(e,a){i=a.fecha_ini,n=a.fecha_fin;if(t<=n&&i<=t){$(".fc-day-content");r.append("<h6><b>(f) "+a.feriado+"</b></h6>"),r.css("background-color","orange")}})})})}}}),l}function fechaConvertirAFormato(e,a){""==a&&(a="-");var t=e,i=t.getDate(),n=t.getMonth(),r="",o="";return i<10&&(r="0"),(n+=1)<10&&(o="0"),r+i+a+o+n+a+t.getFullYear()}function obtenerUltimoDiaMes(e){return e=$.ajax({url:"/perfileslaborales/getultimafechames/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:e},success:function(e){}}).responseText}function obtenerPersonasConCumpleRegistradas(e,a){var g=[];e.split("-")[2],a.split("-")[2];return $.ajax({url:"/relaborales/getcumples",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha_ini:e,fecha_fin:a},success:function(e){var a=jQuery.parseJSON(e);$.each(a,function(e,a){var t=a.fecha_inicio.split("-"),i=t[2],n=t[1]-1,r=t[0],o=a.hora_inicio.split(":"),c=o[0],s=o[1],d=a.fecha_final.split("-"),l=d[2],u=d[1]-1,f=d[0],p=a.hora_final.split(":"),h=p[0],m=p[1],v=a.nombres+" ["+a.gerencia_administrativa;""!=a.departamento_administrativo&&(v+=" - "+a.departamento_administrativo),v+=" * "+a.cargo,v+="]";var $=a.organigrama_sigla;$=$.replace("MT/GE/",""),v=a.nombres+" ["+$+"]",g.push({id:a.nombres,className:a.ci,textColor:"#000",title:v,start:new Date(i,n,r,c,s),end:new Date(l,u,f,h,m),allDay:!0,color:"transparent",editable:!1,borderColor:"#000",horas_laborales:0,dias_laborales:0,hora_entrada:"",hora_salida:"",icon:"gi gi-birthday_cake",cargo:a.cargo,nombres:a.nombres,ci:a.ci,expd:a.expd,gerencia_administrativa:a.gerencia_administrativa,departamento_administrativo:a.departamento_administrativo,fecha_cumple:a.fecha_inicio})})}}),g}function obtenerRutaFoto(e,a){var t="/images/perfil-profesional.jpg";return""!=e&&$.ajax({url:"/relaborales/obtenerrutafoto/",type:"POST",datatype:"json",async:!1,cache:!1,data:{ci:e,num_complemento:a},success:function(e){var a=jQuery.parseJSON(e);1==a.result&&(t=a.ruta)},error:function(){alert("Se ha producido un error Inesperado")}}),t}function obtenerFeriadosRangoFechas(e,a,t,i,n){var r=[];return 0<t&&""!=i&&""!=n&&$.ajax({url:"/feriados/listrange",type:"POST",datatype:"json",async:!1,cache:!1,data:{dia:e,mes:a,gestion:t,fecha_ini:i,fecha_fin:n},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){r.push({id:a.id,feriado:a.feriado,descripcion:a.descripcion,cantidad_dias:a.cantidad_dias,repetitivo:a.repetitivo,dia:a.dia,mes:a.mes,gestion:a.gestion,fecha_ini:a.fecha_ini,fecha_fin:a.fecha_fin,observacion:a.observacion})})}}),r}function convierteTextoAFecha(e,a){var t=e.split(a);return new Date(t[2],t[1]-1,t[0])}function procesaTextoAFecha(e,a){var t=e.split(a);return(e=new Date(t[1]+"/"+t[0]+"/"+t[2])).getTime()}function sumarDias(e,a){return e.setDate(e.getDate()+a),e}function defineColumnasOcultas(t,i,e,a){var n=[],r=0;$.each(a,function(e,a){n[r]=a.title,r++}),$("#"+i).jqxDropDownList({checkboxes:!0,source:n,height:30,width:200}),$.each(a,function(e,a){0==a.selectable&&$("#"+i).jqxDropDownList("disableItem",a.title)});var o="",c="";$("#"+i).on("open",function(e){var a=$("#"+i).jqxDropDownList("getCheckedItems");o="",$.each(a,function(e){o+=this.index+","})}),$("#"+i).on("close",function(e){var a=$("#"+i).jqxDropDownList("getCheckedItems");c="",$.each(a,function(e){c+=this.index+","}),o!=c&&(","==(c=(c+=",").replace(",,",""))&&(c=""),guardarColumnasSeleccionadas(t,c))}),$.each(a,function(e,a){1==$("#"+e).val()&&1==a.selectable&&$("#"+i).jqxDropDownList("checkItem",a.title)});o="",c="";var s=$("#"+i).jqxDropDownList("getCheckedItems").length,d=$("#"+i).jqxDropDownList("getItems"),l=0;$.each(d,function(e,a){0==a.disabled&&l++}),s==l?$("#"+e).prop("checked",!0):0<s&&$("#"+e).prop("indeterminate",!0),$("#"+e).off(),$("#"+e).on("change",function(){if(this.checked){var e=$("#"+i).jqxDropDownList("getCheckedItems");o="",$.each(e,function(e){o+=this.index+","}),$("#"+i).jqxDropDownList("checkAll");e=$("#"+i).jqxDropDownList("getCheckedItems");c="",$.each(e,function(e){c+=this.index+","}),o!=c&&(","==(c=(c+=",").replace(",,",""))&&(c=""),guardarColumnasSeleccionadas(t,c))}else{e=$("#"+i).jqxDropDownList("getCheckedItems");o="",$.each(e,function(e){o+=this.index+","}),$("#"+i).jqxDropDownList("uncheckAll"),$("#"+i).jqxDropDownList("clearSelection");e=$("#"+i).jqxDropDownList("getCheckedItems");c="",$.each(e,function(e){c+=this.index+","}),o!=c&&(","==(c=(c+=",").replace(",,",""))&&(c=""),guardarColumnasSeleccionadas(t,c))}})}function guardarColumnasSeleccionadas(e,a){var t=!0;if(""!=e)t=$.ajax({url:"/relaborales/saveviewcols/",type:"POST",datatype:"json",async:!1,data:{divgrilla_id:e,indexes:a},success:function(e){var a=jQuery.parseJSON(e);1==a.result?location.reload():0==a.result?($("#divMsjePorWarning").html(""),$("#divMsjePorWarning").append(a.msj),$("#divMsjeNotificacionWarning").jqxNotification("open")):($("#divMsjePorError").html(""),$("#divMsjePorError").append(a.msj),$("#divMsjeNotificacionError").jqxNotification("open"))},error:function(){alert("Se ha producido un error Inesperado")}});else t=!1;return t}function utf8_encode(e){if(null==e)return"";var a,t,i,n=e+"",r="";a=t=0,i=n.length;for(var o=0;o<i;o++){var c=n.charCodeAt(o),s=null;if(c<128)t++;else if(127<c&&c<2048)s=String.fromCharCode(c>>6|192,63&c|128);else if(55296!=(63488&c))s=String.fromCharCode(c>>12|224,c>>6&63|128,63&c|128);else{if(55296!=(64512&c))throw new RangeError("Unmatched trail surrogate at "+o);var d=n.charCodeAt(++o);if(56320!=(64512&d))throw new RangeError("Unmatched lead surrogate at "+(o-1));c=((1023&c)<<10)+(1023&d)+65536,s=String.fromCharCode(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}null!==s&&(a<t&&(r+=n.slice(a,t)),r+=s,a=t=o+1)}return a<t&&(r+=n.slice(a,i)),r}$().ready(function(){$(".btn-menu-principal").on("click",function(){App.sidebar("toggle-sidebar")}),iniciarCalendarioDeActividades(),$("#btnImprimirCalendarioCumples").on("click",function(){$("#divCalendariosIndex").printArea({mode:"popup",popClose:!1,popTitle:"Calendario de CumpleaÃ±os"})}),$("#btnExportarExcelCalendarioCumples").on("click",function(){})});