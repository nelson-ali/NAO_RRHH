function OperaEvento(a){"keyup"!=a.type&&"keydown"!=a.type||"27"!=a.which||($("#tabControlExcepciones").jqxTabs("enableAt",0),$("#tabControlExcepciones").jqxTabs("disableAt",1),$("#tabControlExcepciones").jqxTabs("disableAt",2),$("#tabControlExcepciones").jqxTabs("enableAt",3),$("#tabControlExcepciones").jqxTabs({selectedItem:0}),$("#popupWindowCargo").jqxWindow("close"),$("#popupWindowNuevaMovilidad").jqxWindow("close"),$("#lstTipoMemorandum").off(),$("#divGridRelaborales").jqxGrid("focus"))}function procesaTextoAFecha(a,e){var o=a.split(e);return(a=new Date(o[1]+"/"+o[0]+"/"+o[2])).getTime()}function obtenerRutaFoto(a,e){var o="/images/perfil-profesional.jpg";return""!=a&&$.ajax({url:"/relaborales/obtenerrutafoto/",type:"POST",datatype:"json",async:!1,cache:!1,data:{ci:a,num_complemento:e},success:function(a){var e=jQuery.parseJSON(a);1==e.result&&(o=e.ruta)},error:function(){alert("Se ha producido un error Inesperado")}}),o}function fechaHoy(a,e){""==a&&(a="-");var o=new Date,t=o.getDate().toString(),i=(o.getMonth()+1).toString(),n=1===t.length?"0"+t:t,r=1===i.length?"0"+i:i;if("dd-mm-yyyy"==e)var c=n+a+r+a+o.getFullYear();else if("mm-dd-yyyy"==e)c=r+a+n+a+o.getFullYear();else c=o;return c}$().ready(function(){$("#divTabControlExcepciones").jqxTabs("theme","oasis"),$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0});var i=getOneRelaboralById($("#hdnIdRelaboralUsuario").val());definirGrillaParaListaControlExcepcionesPorIdRelaboralPersona(i),$("#liExcept").on("click",function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})}),$("#liTurnAndExcept").on("click",function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("enableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:4}),cargarCalendarioConControlExcepciones(i)}),$(".iExcepcion").on("click",function(){0<("iExcepcionNew"==this.id?$("#lstExcepcionNew").val():$("#lstExcepcionEdit").val())?$("#divModalDetalleExcepcion").modal("show"):alert("Debe seleccionar un tipo de Excepción o Salida inicialmente")}),$("#btnSDFSa").on("click",function(){$("#form").submit()}),$("#btnGuardarControlExcepcionNew").on("click",function(){var t="New";if(validaFormularioMisBoletasExcepciones(1)&&""!=$("#txtFechaIni"+t).val()&&""!=$("#txtFechaFin"+t).val()){var a=cantidadDias($("#txtFechaIni"+t).val(),$("#txtFechaFin"+t).val());if(30<a)bootbox.confirm("Ha solicitado "+a+" d&iacute;as. ¿Est&aacute; seguro de estos datos?",function(a){if(a&&controlaValidezPlazoDeSolicitudBoleta($("#hdnIdRelaboral"+t).val(),$("#txtFechaIni"+t).val())){var o=guardaMisControlExcepciones(1);0<o&&bootbox.confirm("¿Desea enviar su formulario ahora mismo?",function(a){if(a){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:3});var e={id:o,justificacion:$("#txtJustificacion"+t).val(),excepcion:$("#lstExcepcionNew option:selected").text(),fecha_ini:$("#txtFechaIni"+t).val()};cargarDatosDestinatariosFormulario(i,e,0)}else $("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})})}});else if(controlaValidezPlazoDeSolicitudBoleta($("#hdnIdRelaboral"+t).val(),$("#txtFechaIni"+t).val())){var o=guardaMisControlExcepciones(1);0<o&&bootbox.confirm("¿Desea enviar su formulario ahora mismo?",function(a){if(a){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:3});var e={id:o,justificacion:$("#txtJustificacion"+t).val(),excepcion:$("#lstExcepcionNew option:selected").text(),fecha_ini:$("#txtFechaIni"+t).val()};cargarDatosDestinatariosFormulario(i,e,0)}else $("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})})}}}),$("#btnGuardarControlExcepcionEdit").on("click",function(){var t="Edit";if(validaFormularioMisBoletasExcepciones(2)&&""!=$("#txtFechaIni"+t).val()&&""!=$("#txtFechaFin"+t).val()){var a=cantidadDias($("#txtFechaIni"+t).val(),$("#txtFechaFin"+t).val());if(30<a)bootbox.confirm("Ha solicitado "+a+" d&iacute;as. ¿Est&aacute; seguro de estos datos?",function(a){if(a&&controlaValidezPlazoDeSolicitudBoleta($("#hdnIdRelaboral"+t).val(),$("#txtFechaIni"+t).val())){var o=guardaMisControlExcepciones(2);0<o&&bootbox.confirm("¿Desea enviar su formulario ahora mismo?",function(a){if(a){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:3});var e={id:o,justificacion:$("#txtJustificacion"+t).val(),excepcion:$("#lstExcepcionEdit option:selected").text(),fecha_ini:$("#txtFechaIni"+t).val()};cargarDatosDestinatariosFormulario(i,e,0)}else $("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})})}});else if(controlaValidezPlazoDeSolicitudBoleta($("#hdnIdRelaboral"+t).val(),$("#txtFechaIni"+t).val())){var o=guardaMisControlExcepciones(2);0<o&&bootbox.confirm("¿Desea enviar su formulario ahora mismo?",function(a){if(a){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:3});var e={id:o,justificacion:$("#txtJustificacion"+t).val(),excepcion:$("#lstExcepcionEdit option:selected").text(),fecha_ini:$("#txtFechaIni"+t).val()};cargarDatosDestinatariosFormulario(i,e,0)}else $("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})})}}}),$("#btnEnviarSolicitudExcepcion").on("click",function(){if(0<=$("#hdnIntermediacion").val()){var a=$("#hdnIdRelSolicitante").val(),e=$("#chkDestinatarioSecundario").prop("checked"),o=$("#hdnIdRelDestSecundario").val(),t=$("#hdnIdControlExcepcionEnvio").val(),i=$("#txtMensajeAdicional").val(),n=0;if(e&&(n=1),0==$("#hdnIntermediacion").val()||2==$("#hdnIntermediacion").val()){var r=$("#hdnIdRelDestPrincipal").val();(c=enviarMensajeSolicitudExcepcion(a,r,o,t,i,$("#hdnIntermediacion").val(),n))&&($("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs("enableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0}))}else{var c=!1;if(0==$("#hdnAprobacionDirecta").val()){var l=$("#lstBoxDestinatariosPrincipales").jqxListBox("getCheckedItems");if(0<l.length)for(var s=0;s<l.length;s++){r=l[s].value;c=enviarMensajeSolicitudExcepcion(a,r,o,t,i,1,n)}else alert("Debe seleccionar al menos un Destinatario necesariamente.")}else 0<(r=$("#hdnIdRelDestPrincipal").val())?(o=0,c=enviarMensajeSolicitudExcepcion(a,r,o,t,i,0,n)):alert("Error en la configuración de aprobadores directos. Consulte con el administrador.");c&&($("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs("enableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0}))}}}),$("#btnGuardarBaja").click(function(){validaFormularioPorBajaRegistro()&&guardarRegistroBaja()}),$("#btnCancelarNew,#btnVolverAlListadoPrincipalDesdeEdit").click(function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})}),$("#btnCancelarEnvioSolicitudExcepcion").click(function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})}),$("#btnCancelarEdit").click(function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})}),$("#btnCancelarControlExcepcionNew,#btnCancelarControlExcepcionEdit").click(function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})}),$("#btnCancelarTurnAndExcept").click(function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs({selectedItem:0})}),$("#btnExportarExcel").click(function(){var a=$("#jqxlistbox").jqxListBox("getCheckedItems"),o=0;$.each(a,function(a,e){o++}),0<o?exportarReporte(1):(alert("Debe seleccionar al menos una columna para la obtención del reporte solicitado."),$("#jqxlistbox").focus())}),$("#btnExportarPDF").click(function(){var a=$("#jqxlistbox").jqxListBox("getCheckedItems"),o=0;$.each(a,function(a,e){o++}),0<o?exportarReporte(2):(alert("Debe seleccionar al menos una columna para la obtención del reporte solicitado."),$("#jqxlistbox").focus())}),$("#chkAllCols").click(function(){1==this.checked?$("#jqxlistbox").jqxListBox("checkAll"):$("#jqxlistbox").jqxListBox("uncheckAll")}),$("#btnImprimirCalendarioLaboralAndExcept").on("click",function(){$("#page-content").printArea({mode:"popup",popClose:!1})}),$("#btnImprimirCalendarioDetalle").on("click",function(){$("#divCalendarioDetalles").printArea({mode:"popup",popClose:!1})}),$("#chkAi").on("click",function(){var a=$("#txtCargoMovilidad").val();("object"==jQuery.type(a)&&(a=String(a.label)),null!=(a+="")&&""!=a)&&(1==this.checked?a.indexOf("a.i.")<0&&(a+=" a.i.",$("#txtCargoMovilidad").val(a)):0<a.indexOf("a.i.")&&(a=a.replace("a.i.","").trim(),$("#txtCargoMovilidad").val(a)))}),$(".numeral").keyup(function(a){""!=$(this).val()&&$(this).val($(this).val().replace(/[^0-9]/g,""))}),$(".literal").keyup(function(a){""!=$(this).val()&&$(this).val($(this).val().replace(/[^A-Z,a-z,ñ,Ñ, ]/g,""))}),$("#divMsjeNotificacionError").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:14e3,template:"error"}),$("#divMsjeNotificacionWarning").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:14e3,template:"warning"}),$("#divMsjeNotificacionSuccess").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:14e3,template:"success"}),$(document).keypress(OperaEvento),$(document).keyup(OperaEvento)});var cellclass=function(a,e,o){return"ACTIVO"==o?"verde":"EN PROCESO"==o?"amarillo":"PASIVO"==o?"rojo":""};function obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(a,e,o,C,t,i,n){var A=[],r=new Date,j=(r.getDate(),r.getMonth(),r.getFullYear(),!0);switch(o){case 1:case 2:j=!0}return $.ajax({url:"/calendariolaboral/listallregisteredbyrelaboralmixto",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:a,id_perfillaboral:e,fecha_ini:t,fecha_fin:i},success:function(a){var e=jQuery.parseJSON(a);0<e.length&&$.each(e,function(a,e){var o=0,t="00:00:00",i="24:00:00",n="#000000",r="DESCANSO",c=(e.perfil_laboral,e.perfil_laboral_grupo);null!=e.id_horariolaboral?(o=e.id_horariolaboral,r=e.horario_nombre,t=e.hora_entrada.split(":"),i=e.hora_salida.split(":"),n=e.color):(t=t.split(":"),i=i.split(":"));var l=e.calendario_fecha_ini.split("-"),s=l[0],d=l[1]-1,b=l[2],p=t[0],x=t[1],u=(t[2],e.calendario_fecha_fin.split("-")),m=u[0],h=u[1]-1,$=u[2],v=i[0],T=i[1],f=(i[2],"r_");0==o&&(f="d_");var E=n;C||(E="#000000",f="b_"),A.push({id:e.id_calendariolaboral,className:f+o,title:r,start:new Date(s,d,b,p,x),end:new Date(m,h,$,v,T),allDay:j,color:n,editable:C,borderColor:E,horas_laborales:e.horas_laborales,dias_laborales:e.dias_laborales,hora_entrada:e.hora_entrada,hora_salida:e.hora_salida})})}}),A}function ImageExist(a){var e=new Image;return e.src=a,0!=e.height}function fechaConvertirAFormato(e,a){try{""!=a&&null!=a||(a="-");var o=e,t=o.getDate(),i=o.getMonth();i+=1;var n=o.getFullYear(),r="",c="";return t<10&&(r="0"),i<10&&(c="0"),r+t+a+c+i+a+n}catch(a){return e}}function iniciarCalendarioLaboralPorRelaboralTurnosAndExcepcionesParaVerMisAsignacionesPersonales(p,x,a,u,m,e,o,t,i){m=parseInt(m);var h=[],v=7,n=($(".calendar-events"),"prev,next"),r="year",c=!0,l=!0,s=!0,d=!0;switch(a){case 1:case 2:case 3:switch(m){case 1:case 2:break;case 3:n="",r="year"}break;case 4:break;case 5:s=l=c=!1}switch(m){case 1:case 2:d=!1,!(v=5)}return $("#calendar").fullCalendar({header:{left:n,center:"title",right:r},year:o,month:t,date:i,firstDay:1,weekends:d,editable:c,droppable:l,selectable:s,weekNumbers:!0,weekNumberTitle:"#S",timeFormat:"H(:mm)",drop:function(a,e){var o=$(this).data("eventObject"),t=$.extend({},o);t.start=a,$("#calendar").fullCalendar("renderEvent",t,!0),sumarTotalHorasPorSemana(h)},eventDrop:function(a,e,o,t,i){sumarTotalHorasPorSemana(h)},events:e,eventClick:function(i,a,e){var n=i.className+"",o=n.split("_"),t=o[1];n=o[0];var r=0;null!=i.id&&(r=i.id);var c=fechaConvertirAFormato(i.start,"-"),l=c,s=i.start;null!=i.end&&""!=i.end&&(l=fechaConvertirAFormato(i.end,"-"),s=i.end);var d=i.start,b=s,p=s;($("#txtHorarioFechaIni").datepicker("setDate",i.start),$("#txtHorarioFechaFin").datepicker("setDate",s),$("#txtHorarioFechaIni").datepicker({format:"dd-mm-yyyy",default:i.start,weekStart:1,startDate:d,endDate:b,autoclose:!0}).on("changeDate",function(a){(d=new Date(a.date.valueOf())).setDate(d.getDate(new Date(a.date.valueOf()))),$("#txtHorarioFechaFin").datepicker("setStartDate",d)}),$("#txtHorarioFechaFin").datepicker({default:s,weekStart:1,startDate:d,endDate:p,autoclose:!0}).on("changeDate",function(a){(b=new Date(a.date.valueOf())).setDate(b.getDate(new Date(a.date.valueOf()))),$("#txtHorarioFechaIni").datepicker("setEndDate",b)}),0<t)?cargarModalHorario(t)?("b"==n?($("#btnDescartarHorario").hide(),$("#btnGuardarModificacionHorario").hide(),$("#txtHorarioFechaIni").prop("disabled","disabled"),$("#txtHorarioFechaFin").prop("disabled","disabled")):($("#btnDescartarHorario").show(),$("#txtHorarioFechaIni").prop("disabled",!1),$("#txtHorarioFechaFin").prop("disabled",!1)),$("#popupDescripcionHorario").modal("show"),$("#btnDescartarHorario").off(),$("#btnDescartarHorario").on("click",function(){switch(n){case"r":case"d":bajaTurnoEnCalendario(r)&&($("#calendar").fullCalendar("removeEvents",i._id),$("#popupDescripcionHorario").modal("hide"));break;case"n":$("#calendar").fullCalendar("removeEvents",i._id),$("#popupDescripcionHorario").modal("hide")}sumarTotalHorasPorSemana(h)}),$("#btnGuardarModificacionHorario").off(),$("#btnGuardarModificacionHorario").on("click",function(){switch(n){case"r":case"n":if(c!=$("#txtHorarioFechaIni").val()||l!=$("#txtHorarioFechaFin").val()){$("#calendar").fullCalendar("removeEvents",i._id),$("#popupDescripcionHorario").modal("hide");var a=$("#txtHorarioFechaIni").val(),e=$("#txtHorarioFechaFin").val(),o=a.split("-"),t=e.split("-");a=o[2]+"-"+o[1]+"-"+o[0],e=t[2]+"-"+t[1]+"-"+t[0],addEvent={id:i.id,title:i.title,className:i.className,start:a,end:e,color:i.color,editable:!0,hora_entrada:i.hora_entrada,hora_salida:i.hora_salida},$("#calendar").fullCalendar("renderEvent",addEvent,!0)}$("#popupDescripcionHorario").modal("hide")}sumarTotalHorasPorSemana(h)})):alert("Error al determinar los datos del horario."):alert("El registro corresponde a un periodo de salida o excepción.")},eventResize:function(a,e,o){sumarTotalHorasPorSemana(h)},viewRender:function(a){switch(a.name){case"month":removerColumnaSumaTotales(),agregarColumnaSumaTotales(v);var n="",r="";h=[];var c=0,l=0,e=["mon","tue","wed","thu","fri","sat","sun"];$.each(e,function(a,e){l=0,$("td.fc-"+e).map(function(a,e){l++;var o=$(this).data("date"),t=$(this).data("date");if(null!=o){var i=o.split("-");switch(o=i[2]+"-"+i[1]+"-"+i[0],c=i[0],l){case 1:""==n&&(n=o),h.push({semana:1,fecha:o});break;case 2:h.push({semana:2,fecha:o});break;case 3:h.push({semana:3,fecha:o});break;case 4:h.push({semana:4,fecha:o});break;case 5:h.push({semana:5,fecha:o});break;case 6:r=o,h.push({semana:6,fecha:o})}t<$.fullCalendar.formatDate(new Date,"yyyy-MM-dd")&&$(this).css("background-color","silver")}})});var o="",t="",i=(o=fechaConvertirAFormato($("#calendar").fullCalendar("getDate"),"-")).split("-");t=obtenerUltimoDiaMes(o="01-"+i[1]+"-"+i[2]),$("#hdnFechaInicialCalendario").val(o),$("#hdnFechaFinalCalendario").val(t),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(u,x,n,r);var s=obtenerListaExcepcionesParaCalendario(p,a.name,v,n,r);$("#calendar").fullCalendar("removeEvents");var d=obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(x,0,m,!1,n,r,0);$("#calendar").fullCalendar("addEventSource",d),$("#calendar").fullCalendar("addEventSource",s);var b=obtenerFeriadosRangoFechas(0,0,c,n,r);$.each(e,function(a,e){l=0,$("td.fc-"+e).map(function(a,e){l++;$(this).data("date");var o=$(this).data("date"),t="",i="",n=$(this);$.each(b,function(a,e){t=e.fecha_ini,i=e.fecha_fin;if(o<=i&&t<=o){$(".fc-day-content");n.append("<h6><b>(f) "+e.feriado+"</b></h6>"),n.css("background-color","orange")}})})}),sumarTotalHorasPorSemana(h);break;case"agendaWeek":t=obtenerFechaMasDias(o=fechaConvertirAFormato(o=$("#calendar").fullCalendar("getView").start,"-"),v-1),$("#hdnFechaInicialCalendario").val(o),$("#hdnFechaFinalCalendario").val(t),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(u,x,o,t);break;case"agendaDay":t=o=fechaConvertirAFormato($("#calendar").fullCalendar("getDate"),"-"),$("#hdnFechaInicialCalendario").val(o),$("#hdnFechaFinalCalendario").val(t),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(u,x,o,t)}}}),h}function sumarTotalHorasPorSemana(e){var a=$("#calendar").fullCalendar("clientEvents"),r=0,c=0,l=0,s=0,d=0,b=0;$("#spSumaSemana1").html(0),$("#spSumaSemana2").html(0),$("#spSumaSemana3").html(0),$("#spSumaSemana4").html(0),$("#spSumaSemana5").html(0),$("#spSumaSemana6").html(0),$("#tdSumaSemana1").css("background-color","white"),$("#tdSumaSemana2").css("background-color","white"),$("#tdSumaSemana3").css("background-color","white"),$("#tdSumaSemana4").css("background-color","white"),$("#tdSumaSemana5").css("background-color","white"),$("#tdSumaSemana6").css("background-color","white"),$.each(a,function(a,o){var t=$.fullCalendar.formatDate(o.start,"dd-MM-yyyy"),i=$.fullCalendar.formatDate(o.end,"dd-MM-yyyy");""==i&&(i=t);var n="-";$.each(e,function(a,e){1==e.semana&&procesaTextoAFecha(t,n)<=procesaTextoAFecha(e.fecha,n)&&procesaTextoAFecha(e.fecha,n)<=procesaTextoAFecha(i,n)&&(r+=parseFloat(o.horas_laborales)),2==e.semana&&procesaTextoAFecha(t,n)<=procesaTextoAFecha(e.fecha,n)&&procesaTextoAFecha(e.fecha,n)<=procesaTextoAFecha(i,n)&&(c+=parseFloat(o.horas_laborales)),3==e.semana&&procesaTextoAFecha(t,n)<=procesaTextoAFecha(e.fecha,n)&&procesaTextoAFecha(e.fecha,n)<=procesaTextoAFecha(i,n)&&(l+=parseFloat(o.horas_laborales)),4==e.semana&&procesaTextoAFecha(t,n)<=procesaTextoAFecha(e.fecha,n)&&procesaTextoAFecha(e.fecha,n)<=procesaTextoAFecha(i,n)&&(s+=parseFloat(o.horas_laborales)),5==e.semana&&procesaTextoAFecha(t,n)<=procesaTextoAFecha(e.fecha,n)&&procesaTextoAFecha(e.fecha,n)<=procesaTextoAFecha(i,n)&&(d+=parseFloat(o.horas_laborales)),6==e.semana&&procesaTextoAFecha(t,n)<=procesaTextoAFecha(e.fecha,n)&&procesaTextoAFecha(e.fecha,n)<=procesaTextoAFecha(i,n)&&(b+=parseFloat(o.horas_laborales))})}),$("#spSumaSemana1").html(r.toFixed(2)),$("#spSumaSemana2").html(c.toFixed(2)),$("#spSumaSemana3").html(l.toFixed(2)),$("#spSumaSemana4").html(s.toFixed(2)),$("#spSumaSemana5").html(d.toFixed(2)),$("#spSumaSemana6").html(b.toFixed(2));var o=(c+l+s)/3;$("#spSumaPromedioTresSemanas").html(o.toFixed(2));48<r?$("#tdSumaSemana1").css("background-color","#FF4000"):$("#tdSumaSemana1").css("background-color","white"),48<c?$("#tdSumaSemana2").css("background-color","#FF4000"):$("#tdSumaSemana2").css("background-color","silver"),48<l?$("#tdSumaSemana3").css("background-color","#FF4000"):$("#tdSumaSemana3").css("background-color","silver"),48<s?$("#tdSumaSemana4").css("background-color","#FF4000"):$("#tdSumaSemana4").css("background-color","silver"),48<d?$("#tdSumaSemana5").css("background-color","#FF4000"):$("#tdSumaSemana5").css("background-color","white"),48<b?$("#tdSumaSemana6").css("background-color","#FF4000"):$("#tdSumaSemana6").css("background-color","white"),48<o?$("#tdSumaPromedioTresSemanas").css("background-color","red"):$("#tdSumaPromedioTresSemanas").css("background-color","white")}function agregarColumnaSumaTotales(a){$(".fc-border-separate tr:first").append("<th style='width: 87px;' id='thColumnaTotales' class='thColumnaTotales'> Hrs Semana </th>");var o=0;$(".fc-border-separate tr.fc-week").each(function(a,e){o++,$(this).append("<td id='tdSumaSemana"+o+"' class='tdSumaSemana fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaSemana"+o+"' class='fc-day-suma-horas-semana'><span id='spSumaSemana"+o+"' class='spSumaSemana'>100</span></div></div></td>")});var e=a+1;$(".fc-border-separate tr:last").after("<tr id=''><td style='text-align: right;' colspan='"+e+"' class=''><b>Promedio semanal de horas (3 Semanas marcadas):</b></td><td id='tdSumaPromedioTresSemanas' class='tdSumaPromedioTresSemanas fc-first fc-day fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaPromedioTresSemanas' class='fc-suma-promedio-horas-3-semanas'><span id='spSumaPromedioTresSemanas'>0</span></div></div></td></tr>")}function removerColumnaSumaTotales(){$("#thColumnaTotales").remove(),$("#tdSumaSemana1").remove(),$("#tdSumaSemana2").remove(),$("#tdSumaSemana3").remove(),$("#tdSumaSemana4").remove(),$("#tdSumaSemana5").remove(),$("#tdSumaSemana6").remove(),$("#trSumaPromedioTresSemanas").remove()}function numeroHoras(a){if(""==a)return 0;var e=a.split(":"),o=parseFloat(e[0]),t=parseFloat(e[1]),i=parseFloat(e[2]),n=0,r=0;return 0<i&&(n=i/60),0<(t+=n)&&(r=t/60),o+=r}function cargarGrillaAsignacionIndividualFechasUbicacionEstacion(a,e,o,t){var i,n={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"perfil_laboral",type:"string"},{name:"perfil_laboral_grupo",type:"string"},{name:"calendario_fecha_ini",type:"date"},{name:"calendario_fecha_fin",type:"date"},{name:"horario_nombre",type:"string"},{name:"relaboralperfilmaquina_ubicacion_entrada",type:"string"},{name:"relaboralperfilmaquina_estacion_entrada",type:"string"},{name:"relaboralperfilmaquina_ubicacion_salida",type:"string"},{name:"relaboralperfilmaquina_estacion_salida",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",type:"string"},{name:"relaboralperfil_observacion",type:"string"}],url:"/calendariolaboral/getlistallregisteredbyrelaboral?id="+e+"&fecha_ini="+o+"&fecha_fin="+t,cache:!1},r=new $.jqx.dataAdapter(n);i=prepareSimulator("grid"),$("#divGridCalendario").jqxGrid({theme:i,width:"100%",height:"530px",source:r,sortable:!0,altRows:!0,columnsresize:!0,pageable:!0,pagerMode:"advanced",showfilterrow:!0,filterable:!0,autorowheight:!0,columns:[{text:"Nro.",filterable:!1,columntype:"number",width:40,cellsalign:"center",align:"center",cellsrenderer:rownumberrenderer},{text:"Perfil",filtertype:"checkedlist",datafield:"perfil_laboral",width:100,align:"center",hidden:!1},{text:"Grupo",filtertype:"checkedlist",datafield:"perfil_laboral_grupo",width:100,align:"center",hidden:!1},{text:"Fecha Inicio",datafield:"calendario_fecha_ini",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Fin",datafield:"calendario_fecha_fin",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Horario",filtertype:"checkedlist",datafield:"horario_nombre",width:100,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_entrada",width:130,align:"center",hidden:!1},{text:"Estaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_entrada",width:100,align:"center",hidden:!1},{text:"Tipo Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",width:190,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_salida",width:100,align:"center",hidden:!1},{text:"Estaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_salida",width:100,align:"center",hidden:!1},{text:"Tipo Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",width:190,align:"center",hidden:!1},{text:"Observaci&oacute;n",filtertype:"checkedlist",datafield:"relaboralperfil_observacion",width:130,align:"center",hidden:!1}]})}function definirListaAsignados(a,e,o,t,i){}function obtenerUltimoDiaMes(a){return a=$.ajax({url:"/perfileslaborales/getultimafechames/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:a},success:function(a){}}).responseText}function obtenerFechaMasDias(a,e){return a=$.ajax({url:"/perfileslaborales/getfechamasdias/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:a,dias:e},success:function(a){}}).responseText}function obtenerFeriadosRangoFechas(a,e,o,t,i){var n=[];return 0<o&&""!=t&&""!=i&&$.ajax({url:"/feriados/listrange",type:"POST",datatype:"json",async:!1,cache:!1,data:{dia:a,mes:e,gestion:o,fecha_ini:t,fecha_fin:i},success:function(a){var e=jQuery.parseJSON(a);0<e.length&&$.each(e,function(a,e){n.push({id:e.id,feriado:e.feriado,descripcion:e.descripcion,cantidad_dias:e.cantidad_dias,repetitivo:e.repetitivo,dia:e.dia,mes:e.mes,gestion:e.gestion,fecha_ini:e.fecha_ini,fecha_fin:e.fecha_fin,observacion:e.observacion})})}}),n}function cargarCalendarioConControlExcepciones(a,e){a.id_relaboral;$("#spanPrefijoCalendarioLaboral").html(""),$("#spanSufijoCalendarioLaboral").html(" Vrs. Calendario de Excepciones (Individual)");var o=new Date,t=o.getDate(),i=o.getMonth(),n=o.getFullYear();switch($("#calendar").html(""),sumarTotalHorasPorSemana(iniciarCalendarioLaboralPorRelaboralTurnosAndExcepcionesParaVerAsignacionesPersonales(a,a.id_relaboral,5,0,3,[],n,i,t)),$("#tabFichaPersonalTurnAndExcept").jqxTabs({selectedItem:0}),$(".ddNombresTurnAndExcept").html(a.nombres+"&nbsp;"),$(".ddCIAndNumComplementoExpdTurnAndExcept").html(a.ci+a.num_complemento+" "+a.expd+"&nbsp;"),$("#ddCargoTurnAndExcept").html(a.cargo+"&nbsp;"),$("#ddProcesoTurnAndExcept").html(a.proceso_codigo+"&nbsp;"),$("#ddFinanciamientoTurnAndExcept").html(a.condicion+" (Partida "+a.partida+")"),$("#ddGerenciaTurnAndExcept").html(a.gerencia_administrativa+"&nbsp;"),""!=a.departamento_administrativo&&null!=a.departamento_administrativo?($("#ddDepartamentoTurnAndExcept").show(),$("#dtDepartamentoTurnAndExcept").show(),$("#ddDepartamentoTurnAndExcept").html(a.departamento_administrativo+"&nbsp;")):($("#dtDepartamentoTurnAndExcept").hide(),$("#ddDepartamentoTurnAndExcept").hide()),$("#ddUbicacionTurnAndExcept").html(a.ubicacion+"&nbsp;"),a.tiene_item){case 1:$("#dtItemTurnAndExcept").show(),$("#ddItemTurnAndExcept").show(),$("#ddItemTurnAndExcept").html(a.item+"&nbsp;");break;case 0:$("#dtItemTurnAndExcept").hide(),$("#ddItemTurnAndExcept").hide()}if($("#ddNivelSalarialTurnAndExcept").html(a.nivelsalarial+"&nbsp;"),$("#ddHaberTurnAndExcept").html(a.sueldo+"&nbsp;"),$("#ddFechaIngTurnAndExcept").html(a.fecha_ing+"&nbsp;"),null!=a.fecha_incor){var r=a.fecha_incor;$("#dtFechaIncorTurnAndExcept").show(),$("#ddFechaIncorTurnAndExcept").show(),$("#ddFechaIncorTurnAndExcept").html(r+"&nbsp;")}else $("#dtFechaIncorTurnAndExcept").hide(),$("#ddFechaIncorTurnAndExcept").hide();switch($("#ddFechaIniTurnAndExcept").html(a.fecha_ini+"&nbsp;"),a.tiene_item){case 1:$("#dtFechaFinTurnAndExcept").hide(),$("#ddFechaFinTurnAndExcept").hide();break;case 0:$("#dtFechaFinTurnAndExcept").show(),$("#ddFechaFinTurnAndExcept").show(),$("#ddFechaFinTurnAndExcept").html(a.fecha_fin+"&nbsp;")}$("#ddEstadoDescripcionTurnAndExcept").html(a.estado_descripcion+"&nbsp;"),0==a.estado?($("#dtFechaBajaTurnAndExcept").show(),$("#ddFechaBajaTurnAndExcept").show(),$("#ddFechaBajaTurnAndExcept").html(a.fecha_baja+"&nbsp;"),$("#dtMotivoBajaTurnAndExcept").show(),$("#ddMotivoBajaTurnAndExcept").show(),$("#ddMotivoBajaTurnAndExcept").html(a.motivo_baja+"&nbsp;")):($("#dtFechaBajaTurnAndExcept").hide(),$("#ddFechaBajaTurnAndExcept").hide(),$("#dtMotivoBajaTurnAndExcept").hide(),$("#ddMotivoBajaTurnAndExcept").hide()),$("#ddNombresTurnAndExcept").html(a.nombres);var c=obtenerRutaFoto(a.ci,a.num_complemento);$("#imgFotoPerfilTurnAndExceptRelaboral").attr("src",c),$("#imgFotoPerfilContactoPerTurnAndExcept").attr("src",c),$("#imgFotoPerfilContactoInstTurnAndExcept").attr("src",c),$("#imgFotoPerfilTurnAndExcept").attr("src",c),cargarPersonasContactosControlExcepciones(2,a.id_persona)}function getOneRelaboralById(a){var o=[];if(0<a){return $.ajax({url:"/relaborales/getonerelaboral/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:a},success:function(a){var e=jQuery.parseJSON(a);0<e.length&&(o=e[0])}}),o}}function cantidadDias(a,e){var o=a.split("-"),t=e.split("-"),i=Date.UTC(o[2],o[1]-1,o[0]),n=Date.UTC(t[2],t[1]-1,t[0])-i;return Math.floor(n/864e5)+1}