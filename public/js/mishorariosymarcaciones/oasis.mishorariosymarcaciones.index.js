function cargarGrillaReporte(r,e,a){var o,t={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"fecha",type:"date"},{name:"turno",type:"numeric"},{name:"modalidad_marcacion",type:"string"},{name:"horario",type:"string"}],url:"/mishorariosymarcaciones/listtransposed?id="+r+"&fecha_ini="+e+"&fecha_fin="+a,cache:!1},i=new $.jqx.dataAdapter(t);o=prepareSimulator("grid"),$("#divGrillaReporte").jqxGrid({theme:o,width:"100%",height:"530px",source:i,sortable:!0,altRows:!0,columnsresize:!0,pageable:!0,pagesize:20,pagerMode:"advanced",showfilterrow:!0,filterable:!0,groupable:!0,autorowheight:!0,showtoolbar:!0,rendertoolbar:function(e){var a=$("<div></div>");e.append(a),a.append("<button title='Exportar a Excel.' id='exportexcelrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fi fi-xls fa-2x text-success' title='Exportar a Excel.'/></i></button>"),a.append("<button title='Exportar a PDF.' id='exportpdfcrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fi fi-pdf fa-2x text-danger' title='Exportar a PDF.'/></i></button>"),a.append("<button title='Refrescar Grilla' id='refreshbutton' class='btn btn-sm btn-default' type='button'><i class='fa fa-repeat fa-2x text-default' title='Refrescar grilla.'/></i></button>"),a.append("<button title='Desagrupar.' id='cleargroupsrowbutton' class='btn btn-sm btn-default' type='button'><i class='fa fa-chain-broken fa-2x text-default' title='Desagrupar.'/></i></button>"),a.append("<button title='Desfiltrar.' id='clearfiltersrowbutton' class='btn btn-sm btn-default' type='button'><i class='gi gi-sorting fa-2x text-default' title='Desfiltrar.'/></i></button>"),$("#exportexcelrowbutton").jqxButton(),$("#exportpdfcrowbutton").jqxButton(),$("#refreshbutton").jqxButton(),$("#cleargroupsrowbutton").jqxButton(),$("#clearfiltersrowbutton").jqxButton(),$("#exportexcelrowbutton").off(),$("#exportexcelrowbutton").on("click",function(){var e=$("#txtFechaIniRango").val(),a=$("#txtFechaFinRango").val();""!=e&&null!=e&&""!=a&&null!=a?exportarReporteTranspuesto(1,r,e,a):($("#divMsjePorWarning").html(""),$("#divMsjePorWarning").append("Debe definir el rango para la exportaciel reporte necesariamente."),$("#divMsjeNotificacionWarning").jqxNotification("open"))}),$("#exportpdfcrowbutton").off(),$("#exportpdfcrowbutton").on("click",function(){var e=$("#txtFechaIniRango").val(),a=$("#txtFechaFinRango").val();""!=e&&null!=e&&""!=a&&null!=a?exportarReporteTranspuesto(2,r,e,a):($("#divMsjePorWarning").html(""),$("#divMsjePorWarning").append("Debe definir el rango para la exportaciel reporte necesariamente."),$("#divMsjeNotificacionWarning").jqxNotification("open"))}),$("#refreshbutton").off(),$("#refreshbutton").on("click",function(){$("#divGrillaReporte").jqxGrid("updatebounddata")}),$("#cleargroupsrowbutton").off(),$("#cleargroupsrowbutton").on("click",function(){$("#divGrillaReporte").jqxGrid("cleargroups")}),$("#clearfiltersrowbutton").off(),$("#clearfiltersrowbutton").on("click",function(){$("#divGrillaReporte").jqxGrid("clearfilters")})},columns:[{text:"Nro.",filterable:!1,columntype:"number",width:40,cellsalign:"center",align:"center",cellsrenderer:rownumberrenderer},{text:"Fecha",datafield:"fecha",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center"},{text:"Turno",filtertype:"checkedlist",datafield:"turno",width:60,align:"center",cellsalign:"center"},{text:"Modalidad",filtertype:"checkedlist",datafield:"modalidad_marcacion",width:200,align:"center",cellsalign:"left"},{text:"Horario",filtertype:"checkedlist",datafield:"horario",width:80,align:"center",cellsalign:"center"}]})}function cargarGrillaReporteTotales(e,a,r){var o,t={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"id_relaboral",type:"integer"},{name:"atrasos",type:"numeric"},{name:"faltas",type:"numeric"},{name:"abandono",type:"numeric"},{name:"omision",type:"numeric"},{name:"lsgh",type:"numeric"}],url:"/mishorariosymarcaciones/listtransposedtotals?id="+e+"&fecha_ini="+a+"&fecha_fin="+r,cache:!1},i=new $.jqx.dataAdapter(t);o=prepareSimulator("grid"),$("#divGrillaReporteTotales").jqxGrid({theme:o,width:"100%",height:"70px",source:i,columnsresize:!0,columns:[{text:"Atrasos (Min.)",datafield:"atrasos",width:90,align:"center",cellsalign:"center"},{text:"Faltas (D&iacute;as)",datafield:"faltas",width:100,align:"center",cellsalign:"center"},{text:"Abandono (Cant.)",datafield:"abandono",width:105,align:"center",cellsalign:"center"},{text:"Omisi&oacute;n (Cant.)",datafield:"omision",width:100,align:"center",cellsalign:"center"},{text:"Lsgh (D&iacute;as)",datafield:"lsgh",width:90,align:"center",cellsalign:"center"}]})}$().ready(function(){var a=getOneRelaboralById($("#hdnIdRelaboralUsuario").val());cargarHorariosPorPersona(a),$("#btnImprimirCalendarioMarcaciones").on("click",function(){$("#divCalendarioMarcaciones").printArea({mode:"popup",popClose:!1})}),$("#btnImprimirCalendarioHorarios").on("click",function(){$("#divCalendarioHorarios").printArea({mode:"popup",popClose:!1})}),$("#btnImprimirCalendarioDetalle").on("click",function(){$("#divCalendarioDetalles").printArea({mode:"popup",popClose:!1})}),$("#btnImprimirReporte").on("click",function(){$("#divReporteHorariosMarcaciones").printArea({mode:"popup",popClose:!1})}),$("#divMsjeNotificacionWarning").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:14e3,template:"warning"}),$("#btnGenerarReporte").on("click",function(){if(""!=$("#txtFechaIniRango").val()&&""!=$("#txtFechaFinRango").val()){var e=new Date;procesaTextoAFecha($("#txtFechaIniRango").val(),"-")>e?cargarGrillaReporte(a.id_relaboral,"",""):procesaTextoAFecha($("#txtFechaFinRango").val(),"-")>e&&cargarGrillaReporte(a.id_relaboral,$("#txtFechaIniRango").val(),fechaConvertirAFormato(e,"-")),$("#lblFechaIniRango").text($("#txtFechaIniRango").val()),$("#lblFechaFinRango").text($("#txtFechaFinRango").val())}else{$("#divMsjePorWarning").html(""),$("#divMsjePorWarning").append("Debe seleccionar necesariamente la fecha de inicio y finalizaci&oacute;n del reporte."),$("#divMsjeNotificacionWarning").jqxNotification("open")}})});var rownumberrenderer=function(e,a,r,o,t,i){return"<div align='center'>"+(e+1)+"</div>"};function procesaTextoAFecha(e,a){var r=e.split(a);return(e=new Date(r[1]+"/"+r[0]+"/"+r[2])).getTime()}function obtenerRutaFoto(e,a){var r="/images/perfil-profesional.jpg";return""!=e&&$.ajax({url:"/relaborales/obtenerrutafoto/",type:"POST",datatype:"json",async:!1,cache:!1,data:{ci:e,num_complemento:a},success:function(e){var a=jQuery.parseJSON(e);1==a.result&&(r=a.ruta)},error:function(){alert("Se ha producido un error Inesperado")}}),r}function fechaHoy(e,a){""==e&&(e="-");var r=new Date,o=r.getDate().toString(),t=(r.getMonth()+1).toString(),i=1===o.length?"0"+o:o,n=1===t.length?"0"+t:t;if("dd-mm-yyyy"==a)var c=i+e+n+e+r.getFullYear();else if("mm-dd-yyyy"==a)c=n+e+i+e+r.getFullYear();else c=r;return c}var cellclass=function(e,a,r){return"ACTIVO"==r?"verde":"EN PROCESO"==r?"amarillo":"PASIVO"==r?"rojo":""};function obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(e,a,r,y,o,t,i){var j=[],n=new Date,S=(n.getDate(),n.getMonth(),n.getFullYear(),!0);switch(r){case 1:case 2:S=!0}return $.ajax({url:"/calendariolaboral/listallregisteredbyrelaboralmixto",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e,id_perfillaboral:a,fecha_ini:o,fecha_fin:t},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){var r=0,o="00:00:00",t="24:00:00",i="#000000",n="DESCANSO",c=(a.perfil_laboral,a.perfil_laboral_grupo);null!=a.id_horariolaboral?(r=a.id_horariolaboral,n=a.horario_nombre,o=a.hora_entrada.split(":"),t=a.hora_salida.split(":"),i=a.color):(o=o.split(":"),t=t.split(":"));var l=a.calendario_fecha_ini.split("-"),s=l[0],d=l[1]-1,p=l[2],u=o[0],f=o[1],h=(o[2],a.calendario_fecha_fin.split("-")),m=h[0],b=h[1]-1,x=h[2],v=t[0],$=t[1],g=(t[2],"r_");0==r&&(g="d_");var _=i;y||(_="#000000",g="b_"),j.push({id:a.id_calendariolaboral,className:g+r,title:n,start:new Date(s,d,p,u,f),end:new Date(m,b,x,v,$),allDay:S,color:i,textColor:_,editable:y,borderColor:_,horas_laborales:a.horas_laborales,dias_laborales:a.dias_laborales,hora_entrada:a.hora_entrada,hora_salida:a.hora_salida,tipo_evento:"h",icon:"fa fa-clock-o"})})}}),j}function obtenerTodasMarcacionesRegistradas(e,a,r){var f=[],h="transparent";return $.ajax({url:"/marcaciones/getandsavemarcaciones",type:"POST",datatype:"json",async:!1,cache:!1,data:{ci:e,fecha_ini:a,fecha_fin:r},success:function(e){var a=jQuery.parseJSON(e);if(1==a.result){var r=a.data,d=a.stations,p=a.colors,u="";$.each(r,function(s,e){$.each(e,function(e,a){if(null!=a&&null!=p[s]){var r=s.split("-"),o=yf=r[2],t=mf=r[1]-1,i=df=r[0],n=a.split(":"),c=hs=n[0],l=ms=n[1];h=null!=p[s][a]&&null!=p[s][a]?p[s][a]:"transparent",u=null!=d[s][a]&&null!=d[s][a]?(u=d[s][a]+"").replace(" ","_"):"",f.push({id:s+"_"+a,className:u,textColor:"#000",title:a,start:new Date(o,t,i,c,l),end:new Date(yf,mf,df,hs,ms),allDay:!0,color:h,editable:!1,borderColor:"#000",horas_laborales:0,dias_laborales:0,hora_entrada:a,hora_salida:a,tipo_evento:"m",icon:"fa fa-bullseye"})}})})}}}),f}function ImageExist(e){var a=new Image;return a.src=e,0!=a.height}function fechaConvertirAFormato(e,a){""==a&&(a="-");var r=e,o=r.getDate(),t=r.getMonth(),i="",n="";return o<10&&(i="0"),(t+=1)<10&&(n="0"),i+o+a+n+t+a+r.getFullYear()}function iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignacionesPorPersona(b,x,e,v,g,a,r,o,t,i,n){g=parseInt(g);var _=[],y=7,c="prev,next",l="year",s=!0,d=!0,p=!0,u=!0;switch(e){case 1:case 2:case 3:switch(g){case 1:case 2:break;case 3:c="",l="year"}break;case 4:break;case 5:p=d=s=!1}switch(g){case 1:case 2:u=!1,!(y=5)}return $("#calendar").fullCalendar({header:{left:c,center:"title",right:l},year:r,month:o,date:t,firstDay:1,weekends:u,editable:s,droppable:d,selectable:p,weekNumbers:!0,weekNumberTitle:"#S",timeFormat:"H(:mm)",drop:function(e,a){var r=$(this).data("eventObject"),o=$.extend({},r);o.start=e,$("#calendar").fullCalendar("renderEvent",o,!0),sumarTotalHorasPorSemana(_)},eventDrop:function(e,a,r,o,t){sumarTotalHorasPorSemana(_)},events:a,eventClick:function(e,a,r){var o=e.className+"",t=o.split("_"),i=t[1];o=t[0];null!=e.id&&e.id;fechaConvertirAFormato(e.start,"-");var n=e.start;null!=e.end&&""!=e.end&&(fechaConvertirAFormato(e.end,"-"),n=e.end);var c=e.start,l=n,s=n;($("#txtHorarioFechaIni").datepicker("setDate",e.start),$("#txtHorarioFechaFin").datepicker("setDate",n),$("#txtHorarioFechaIni").datepicker({format:"dd-mm-yyyy",default:e.start,weekStart:1,startDate:c,endDate:l,autoclose:!0}).on("changeDate",function(e){(c=new Date(e.date.valueOf())).setDate(c.getDate(new Date(e.date.valueOf()))),$("#txtHorarioFechaFin").datepicker("setStartDate",c)}),$("#txtHorarioFechaFin").datepicker({default:n,weekStart:1,startDate:c,endDate:s,autoclose:!0}).on("changeDate",function(e){(l=new Date(e.date.valueOf())).setDate(l.getDate(new Date(e.date.valueOf()))),$("#txtHorarioFechaIni").datepicker("setEndDate",l)}),0<i)&&(cargarModalHorario(i)?("b"==o?($("#btnDescartarHorario").hide(),$("#btnGuardarModificacionHorario").hide(),$("#txtHorarioFechaIni").prop("disabled","disabled"),$("#txtHorarioFechaFin").prop("disabled","disabled")):($("#btnDescartarHorario").show(),$("#txtHorarioFechaIni").prop("disabled",!1),$("#txtHorarioFechaFin").prop("disabled",!1)),$("#popupDescripcionHorario").modal("show")):alert("Error al determinar los datos del horario."))},eventResize:function(e,a,r){},eventRender:function(e,a){var r=e.tipo_evento+"";if("c"===r||"h"===r){var o='<i class="'+e.icon+'"></i> ';$(a).find(".fc-event-title").prepend(o)}if("m"===r){var t=(e.className+"").replace("_"," ");$(a).tooltip({title:"Marcación en "+t})}},viewRender:function(e){$("#calendarMarcaciones").html("");var i="",n="";_=[];var c=0,l=0,a=["mon","tue","wed","thu","fri","sat","sun"];$.each(a,function(e,a){l=0,$("td.fc-"+a).map(function(e,a){l++;var r=$(this).data("date"),o=$(this).data("date");if(null!=r){var t=r.split("-");switch(r=t[2]+"-"+t[1]+"-"+t[0],c=t[0],l){case 1:""==i&&(i=r),_.push({semana:1,fecha:r});break;case 2:_.push({semana:2,fecha:r});break;case 3:_.push({semana:3,fecha:r});break;case 4:_.push({semana:4,fecha:r});break;case 5:_.push({semana:5,fecha:r});break;case 6:n=r,_.push({semana:6,fecha:r})}o<$.fullCalendar.formatDate(new Date,"yyyy-MM-dd")&&$(this).css("background-color","silver")}})});var r,o="",t=(o=fechaConvertirAFormato($("#calendar").fullCalendar("getDate"),"-")).split("-");r=obtenerUltimoDiaMes(o="01-"+t[1]+"-"+t[2]),$("#hdnFechaInicialCalendario").val(o),$("#hdnFechaFinalCalendario").val(r),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(v,x,i,n);var s=new Date,d=i,p=n;procesaTextoAFecha(d,"-")>s?(p=d=null,$("#txtFechaIniRango").val(""),$("#txtFechaFinRango").val("")):(procesaTextoAFecha(p,"-")>s&&(p=fechaConvertirAFormato(s,"-")),$("#txtFechaIniRango").datepicker("update",d),$("#txtFechaFinRango").datepicker("update",p)),$("#lblFechaIniRango").text(d),$("#lblFechaFinRango").text(p);var u=obtenerArrayDeExcepcionesParaCalendario(b,e.name,y,i,n);$("#calendar").fullCalendar("removeEvents");var f=obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(x,0,g,!1,i,n,0);$("#calendar").fullCalendar("addEventSource",f),$("#calendar").fullCalendar("addEventSource",u);var h=obtenerFeriadosRangoFechas(0,0,c,i,n);$.each(a,function(e,a){l=0,$("td.fc-"+a).map(function(e,a){l++;$(this).data("date");var r=$(this).data("date"),o="",t="",i=$(this);$.each(h,function(e,a){if(o=a.fecha_ini,t=a.fecha_fin,r<=t&&o<=r){$(".fc-day-content");i.append("<h6><b>(f) "+a.feriado+"</b></h6>"),i.css("background-color","orange")}})})}),sumarTotalHorasPorSemana(_);t[2],t[1],t[0];var m=obtenerTodasMarcacionesRegistradas(b.ci,i,n);$("#calendar").fullCalendar("addEventSource",m),$("#divCalendarioSmall").datepicker({format:"dd/mm/yyyy",viewMode:"months",minViewMode:"months"}),$("#divCalendarioSmall").datepicker("update",o),$("#divCalendarioSmall").datepicker("show"),$("#divCalendarioSmall").datepicker().on("changeDate",function(e){var a=new Date(e.date).getMonth()+1,r=new Date(e.date).getFullYear();12==a&&(a=0,r+=1),$("#calendar").fullCalendar("gotoDate",r,a)})}}),_}function iniciarCalendarioMarcacionesPorPersona(e,a,r,o,t,i){var n=e.ci;return $("#calendarMarcaciones").fullCalendar({header:{left:"",center:"title",right:"year"},year:a,month:r,date:o,firstDay:1,weekends:!0,editable:!0,droppable:!0,selectable:!0,weekNumbers:!0,weekNumberTitle:"#S",timeFormat:"H(:mm)",events:[],eventRender:function(e,a){var r=(e.className+"").replace("_"," ");$(a).tooltip({title:r})},viewRender:function(e){switch(e.name){case"month":$("#calendarMarcaciones").fullCalendar("removeEvents");var a=obtenerTodasMarcacionesRegistradas(n,t,i);$("#calendarMarcaciones").fullCalendar("addEventSource",a);$.each(["mon","tue","wed","thu","fri","sat","sun"],function(e,a){$("td.fc-"+a).map(function(e,a){$(this).data("date")<$.fullCalendar.formatDate(new Date,"yyyy-MM-dd")&&$(this).css("background-color","silver")})})}}}),[]}function sumarTotalHorasPorSemana(a){var e=$("#calendar").fullCalendar("clientEvents"),n=0,c=0,l=0,s=0,d=0,p=0;$("#spSumaSemana1").html(0),$("#spSumaSemana2").html(0),$("#spSumaSemana3").html(0),$("#spSumaSemana4").html(0),$("#spSumaSemana5").html(0),$("#spSumaSemana6").html(0),$("#tdSumaSemana1").css("background-color","white"),$("#tdSumaSemana2").css("background-color","white"),$("#tdSumaSemana3").css("background-color","white"),$("#tdSumaSemana4").css("background-color","white"),$("#tdSumaSemana5").css("background-color","white"),$("#tdSumaSemana6").css("background-color","white"),$.each(e,function(e,r){var o=$.fullCalendar.formatDate(r.start,"dd-MM-yyyy"),t=$.fullCalendar.formatDate(r.end,"dd-MM-yyyy");""==t&&(t=o);var i="-";$.each(a,function(e,a){1==a.semana&&procesaTextoAFecha(o,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(t,i)&&(n+=parseFloat(r.horas_laborales)),2==a.semana&&procesaTextoAFecha(o,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(t,i)&&(c+=parseFloat(r.horas_laborales)),3==a.semana&&procesaTextoAFecha(o,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(t,i)&&(l+=parseFloat(r.horas_laborales)),4==a.semana&&procesaTextoAFecha(o,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(t,i)&&(s+=parseFloat(r.horas_laborales)),5==a.semana&&procesaTextoAFecha(o,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(t,i)&&(d+=parseFloat(r.horas_laborales)),6==a.semana&&procesaTextoAFecha(o,i)<=procesaTextoAFecha(a.fecha,i)&&procesaTextoAFecha(a.fecha,i)<=procesaTextoAFecha(t,i)&&(p+=parseFloat(r.horas_laborales))})}),$("#spSumaSemana1").html(n.toFixed(2)),$("#spSumaSemana2").html(c.toFixed(2)),$("#spSumaSemana3").html(l.toFixed(2)),$("#spSumaSemana4").html(s.toFixed(2)),$("#spSumaSemana5").html(d.toFixed(2)),$("#spSumaSemana6").html(p.toFixed(2));var r=(c+l+s)/3;$("#spSumaPromedioTresSemanas").html(r.toFixed(2));48<n?$("#tdSumaSemana1").css("background-color","#FF4000"):$("#tdSumaSemana1").css("background-color","white"),48<c?$("#tdSumaSemana2").css("background-color","#FF4000"):$("#tdSumaSemana2").css("background-color","silver"),48<l?$("#tdSumaSemana3").css("background-color","#FF4000"):$("#tdSumaSemana3").css("background-color","silver"),48<s?$("#tdSumaSemana4").css("background-color","#FF4000"):$("#tdSumaSemana4").css("background-color","silver"),48<d?$("#tdSumaSemana5").css("background-color","#FF4000"):$("#tdSumaSemana5").css("background-color","white"),48<p?$("#tdSumaSemana6").css("background-color","#FF4000"):$("#tdSumaSemana6").css("background-color","white"),48<r?$("#tdSumaPromedioTresSemanas").css("background-color","red"):$("#tdSumaPromedioTresSemanas").css("background-color","white")}function agregarColumnaSumaTotales(e){$(".fc-border-separate tr:first").append("<th style='width: 87px;' id='thColumnaTotales' class='thColumnaTotales'> Hrs Semana </th>");var r=0;$(".fc-border-separate tr.fc-week").each(function(e,a){r++,$(this).append("<td id='tdSumaSemana"+r+"' class='tdSumaSemana fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaSemana"+r+"' class='fc-day-suma-horas-semana'><span id='spSumaSemana"+r+"' class='spSumaSemana'>100</span></div></div></td>")});var a=e+1;$(".fc-border-separate tr:last").after("<tr id=''><td style='text-align: right;' colspan='"+a+"' class=''><b>Promedio semanal de horas (3 Semanas marcadas):</b></td><td id='tdSumaPromedioTresSemanas' class='tdSumaPromedioTresSemanas fc-first fc-day fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaPromedioTresSemanas' class='fc-suma-promedio-horas-3-semanas'><span id='spSumaPromedioTresSemanas'>0</span></div></div></td></tr>")}function removerColumnaSumaTotales(){$("#thColumnaTotales").remove(),$("#tdSumaSemana1").remove(),$("#tdSumaSemana2").remove(),$("#tdSumaSemana3").remove(),$("#tdSumaSemana4").remove(),$("#tdSumaSemana5").remove(),$("#tdSumaSemana6").remove(),$("#trSumaPromedioTresSemanas").remove()}function numeroHoras(e){if(""==e)return 0;var a=e.split(":"),r=parseFloat(a[0]),o=parseFloat(a[1]),t=parseFloat(a[2]),i=0,n=0;return 0<t&&(i=t/60),0<(o+=i)&&(n=o/60),r+=n}function cargarGrillaAsignacionIndividualFechasUbicacionEstacion(e,d,a,r){var o,t={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"perfil_laboral",type:"string"},{name:"perfil_laboral_grupo",type:"string"},{name:"calendario_fecha_ini",type:"date"},{name:"calendario_fecha_fin",type:"date"},{name:"horario_nombre",type:"string"},{name:"relaboralperfilmaquina_ubicacion_entrada",type:"string"},{name:"relaboralperfilmaquina_estacion_entrada",type:"string"},{name:"relaboralperfilmaquina_ubicacion_salida",type:"string"},{name:"relaboralperfilmaquina_estacion_salida",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",type:"string"},{name:"relaboralperfil_observacion",type:"string"}],url:"/calendariolaboral/getlistallregisteredbyrelaboral?id="+d+"&fecha_ini="+a+"&fecha_fin="+r,cache:!1},i=new $.jqx.dataAdapter(t);o=prepareSimulator("grid"),$("#divGridCalendario").jqxGrid({theme:o,width:"100%",height:"530px",source:i,sortable:!0,altRows:!0,columnsresize:!0,pageable:!0,groupable:!0,pagerMode:"advanced",showfilterrow:!0,filterable:!0,enablebrowserselection:!0,autorowheight:!0,showtoolbar:!0,rendertoolbar:function(e){var a=$("<div></div>");e.append(a),a.append("<button title='Refrescar Grilla' id='refreshbutton' class='btn btn-sm btn-default' type='button'><i class='fa fa-repeat fa-lg text-default' title='Refrescar grilla.'/></i> Actualizar</button>"),a.append("<button title='Desagrupar.' id='cleargroupsrowbutton' class='btn btn-sm btn-default' type='button'><i class='fa fa-chain-broken fa-lg text-default' title='Desagrupar.'/></i> Desagrupar</button>"),a.append("<button title='Desfiltrar.' id='clearfiltersrowbutton' class='btn btn-sm btn-default' type='button'><i class='gi gi-sorting fa-lg text-default' title='Desfiltrar.'/></i> Desfiltrar</button>"),$("#refreshbutton").off(),$("#refreshbutton").on("click",function(){$("#divGridCalendario").jqxGrid("updatebounddata")}),$("#cleargroupsrowbutton").off(),$("#cleargroupsrowbutton").on("click",function(){$("#divGridCalendario").jqxGrid("cleargroups")}),$("#clearfiltersrowbutton").off(),$("#clearfiltersrowbutton").on("click",function(){$("#divGridCalendario").jqxGrid("clearfilters")}),$("#addcontrolexceptrowbutton").off(),$("#addcontrolexceptrowbutton").on("click",function(){$("#divTabControlExcepciones").jqxTabs("enableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:1}),inicializarMiFormularioControlExcepcionesNuevoEditar(1,d,0,"","","","","","",0,-1,genero,""),$("#hdnIdRelaboralNew").val(d),$("#lstExcepcionesNew").focus()}),$("#updateexceptrowbutton").off(),$("#updateexceptrowbutton").on("click",function(){var e=$("#divGridControlExcepciones").jqxGrid("getselectedrowindex");if(0<=e){var a=$("#divGridControlExcepciones").jqxGrid("getrowdata",e);if(null!=a)if($("#hdnIdControlExcepcionEdit").val(a.id),1==a.controlexcepcion_estado||2==a.controlexcepcion_estado)if(1==a.boleta)$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs("enableAt",2),$("#divTabControlExcepciones").jqxTabs({selectedItem:2}),$("#hdnIdRelaboralEdit").val(d),$("#hdnIdControlExcepcionEdit").val(a.id),limpiarMensajesErrorPorValidacionControlExcepcion(2),inicializarMiFormularioControlExcepcionesNuevoEditar(2,d,a.excepcion_id,a.fecha_ini,a.hora_ini,a.fecha_fin,a.hora_fin,a.justificacion,a.destino,a.turno,a.entrada_salida,genero,a.controlexcepcion_observacion);else{var r="Usted no tiene los permisos suficientes para modificar este tipo de excepciones. Consulte con Personal de Control de Personal o el Administrador.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}else{var r="Debe seleccionar un registro en estado EN ELABORACI&Oacute;N necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}else{var r="Debe seleccionar un registro necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}),$("#sendexceptrowbutton").off(),$("#sendexceptrowbutton").on("click",function(){var e=$("#divGridControlExcepciones").jqxGrid("getselectedrowindex");if(0<=e){var a=$("#divGridControlExcepciones").jqxGrid("getrowdata",e);if(null!=a)if(1==a.controlexcepcion_estado||2==a.controlexcepcion_estado||-3==a.controlexcepcion_estado||-4==a.controlexcepcion_estado)if(1==a.boleta){var r=fechaConvertirAFormato(a.fecha_ini,"-"),o=controlaValidezPlazoDeSolicitudBoleta(d,r);if(o){var t=horaEsMayorAhora(a.hora_ini,a.hora_fin);if(1==t){var i="Debe modificar la hora de finalizaci&oacute;n debido a inconsistencia.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(i),$("#divMsjeNotificacionError").jqxNotification("open")}else{var n=fechaConvertirAFormato(a.fecha_ini,"-"),c=fechaConvertirAFormato(a.fecha_fin,"-"),l=verificaFrecuenciaMiBoleta(a.id,d,a.excepcion_id,n,a.hora_ini,c,a.hora_fin,a.horario);if(l){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("enableAt",3),$("#divTabControlExcepciones").jqxTabs("disableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:3});var s=0;5==a.controlexcepcion_estado&&(s=1),cargarDatosDestinatariosFormulario(dataRecordMain,a,s)}}}}else{var i="Usted no tiene los permisos suficientes para modificar este tipo de excepciones. Consulte con Personal de Control de Personal o el Administrador.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(i),$("#divMsjeNotificacionError").jqxNotification("open")}else{var i="Debe seleccionar un registro con estado EN ELABORACI&Oacute;N, ELABORADO o estar en espera de reenvio debido ERROR EN LA SOLICITUD para posibilitar la aprobaci&oacute;n del registro";$("#divMsjePorError").html(""),$("#divMsjePorError").append(i),$("#divMsjeNotificacionError").jqxNotification("open")}}else{var i="Debe seleccionar un registro necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(i),$("#divMsjeNotificacionError").jqxNotification("open")}}),$("#printexceptrowbutton").off(),$("#printexceptrowbutton").on("click",function(){var e=$("#divGridControlExcepciones").jqxGrid("getselectedrowindex");if(0<=e){var a=$("#divGridControlExcepciones").jqxGrid("getrowdata",e);if(null!=a)if(1<=a.controlexcepcion_estado||a.controlexcepcion_estado<0)if(1==a.boleta)exportarFormulario(a.id);else{var r="Usted no tiene los permisos suficientes para modificar este tipo de excepciones. Consulte con Personal de Control de Personal o el Administrador.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}else{var r="El formulario no puede ser visible en este estado "+a.controlexcepcion_estado_descripcion+".";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}else{var r="Debe seleccionar un registro necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}),$("#deleteexceptrowbutton").off(),$("#deleteexceptrowbutton").on("click",function(){var e=$("#divGridControlExcepciones").jqxGrid("getselectedrowindex");if(0<=e){var a=$("#divGridControlExcepciones").jqxGrid("getrowdata",e);if(null!=a)if(1==a.controlexcepcion_estado||2==a.controlexcepcion_estado){if(confirm("¿Esta seguro de dar de baja registro de control de excepción?"))if(1==a.boleta)darDeBajaControlExcepcion(a.id);else{var r="Usted no tiene los permisos suficientes para modificar este tipo de excepciones. Consulte con Personal de Control de Personal o el Administrador.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}else{var r="Para dar de baja un registro, este debe estar en estado ELABORADO o en ELABORACI&Oacute;N necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}else{var r="Debe seleccionar un registro necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}),$("#turnexceptrowbutton").off(),$("#turnexceptrowbutton").on("click",function(){$("#divTabControlExcepciones").jqxTabs("enableAt",0),$("#divTabControlExcepciones").jqxTabs("disableAt",1),$("#divTabControlExcepciones").jqxTabs("disableAt",2),$("#divTabControlExcepciones").jqxTabs("disableAt",3),$("#divTabControlExcepciones").jqxTabs("enableAt",4),$("#divTabControlExcepciones").jqxTabs({selectedItem:4}),$("#spanPrefijoCalendarioLaboral").html(""),$("#spanSufijoCalendarioLaboral").html(" Vrs. Calendario de Excepciones (Individual)");var e=new Date,a=e.getDate(),r=e.getMonth(),o=e.getFullYear(),t=$("#divGridControlExcepciones").jqxGrid("getselectedrowindex");if(0<=t){var i=$("#divGridControlExcepciones").jqxGrid("getrowdata",t);if(null!=i){var n=fechaConvertirAFormato(i.fecha_ini,"-"),c=n.split("-");a=c[0],r=c[1]-1,o=c[2]}}$("#calendar").html("");var l=iniciarCalendarioLaboralPorRelaboralTurnosAndExcepcionesParaVerMisAsignacionesPersonales(dataRecordMain,d,5,0,3,[],o,r,a);sumarTotalHorasPorSemana(l)})},columns:[{text:"Nro.",filterable:!1,columntype:"number",width:40,cellsalign:"center",align:"center",cellsrenderer:rownumberrenderer},{text:"Perfil",filtertype:"checkedlist",datafield:"perfil_laboral",width:100,align:"center",hidden:!1},{text:"Grupo",filtertype:"checkedlist",datafield:"perfil_laboral_grupo",width:100,align:"center",hidden:!1},{text:"Fecha Inicio",datafield:"calendario_fecha_ini",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Fin",datafield:"calendario_fecha_fin",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Horario",filtertype:"checkedlist",datafield:"horario_nombre",width:100,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_entrada",width:150,align:"center",hidden:!1},{text:"Estaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_entrada",width:100,align:"center",hidden:!1},{text:"Tipo Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",width:200,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_salida",width:150,align:"center",hidden:!1},{text:"Estaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_salida",width:100,align:"center",hidden:!1},{text:"Tipo Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",width:200,align:"center",hidden:!1},{text:"Observaci&oacute;n",filtertype:"checkedlist",datafield:"relaboralperfil_observacion",width:200,align:"center",hidden:!1}]})}function obtenerUltimoDiaMes(e){return e=$.ajax({url:"/perfileslaborales/getultimafechames/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:e},success:function(e){}}).responseText}function obtenerFechaMasDias(e,a){return e=$.ajax({url:"/perfileslaborales/getfechamasdias/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:e,dias:a},success:function(e){}}).responseText}function cargarHorariosPorPersona(e){$("#spanPrefijoCalendarioLaboral").html(""),$("#spanSufijoCalendarioLaboral").html(" Vrs. Calendario de Excepciones (Individual)");var a=new Date,r=a.getDate(),o=a.getMonth(),t=a.getFullYear();0==e.estado&&(r=e.fecha_baja.getDate(),o=e.fecha_baja.getMonth(),t=e.fecha_baja.getFullYear());$("#calendar").html("");sumarTotalHorasPorSemana(iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignacionesPorPersona(e,e.id_relaboral,5,0,3,[],t,o,r)),$("#btnRefrescarCalendarioLaboralAndExcept").off(),$("#btnRefrescarCalendarioDetalle").off(),$("#btnRefrescarCalendarioLaboralAndExcept, #btnRefrescarCalendarioDetalle").on("click",function(){$("#calendar").html("");sumarTotalHorasPorSemana(iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignacionesPorPersona(e,e.id_relaboral,5,0,3,[],t,o,r))})}function cargarHistorialDeHorariosYMarcaciones(e,a,r,o){$("#hdnIdPersonaHistorial").val(a),$("#ddNombres").html(r);var t=obtenerRutaFoto(o,"");$("#imgFotoPerfilContactoPer").attr("src",t),$("#imgFotoPerfilContactoInst").attr("src",t),$("#imgFotoPerfil").attr("src",t),cargarPersonasContactosGestionIdeas(1,a),$("#hdnIdRelaboralVista").val(e),$("#hdnSwPrimeraVistaHistorial").val(0),$("#divContent_"+e).focus().select(),definirGrillaParaListaControlMarcacionesDebidasYRealizadasPorIdRelaboralGestionMes(e,a,r,o)}function getOneRelaboralById(e){var r=[];if(0<e){return $.ajax({url:"/relaborales/getonerelaboral/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&(r=a[0])}}),r}}function obtenerArrayDeExcepcionesParaCalendario(e,a,r,o,t){var i=obtenerListadoFechasConExcepcionEnCalendario(e.id_relaboral,a,r,o,t),x=[];return $.each(i,function(e,a){var r=a.fecha.split("-"),o=a.hora_ini.split(":"),t=a.hora_fin.split(":"),i=r[0],n=r[1]-1,c=r[2],l=o[0],s=o[1],d=(o[2],a.fecha.split("-")),p=d[0],u=d[1]-1,f=d[2],h=t[0],m=t[1],b=(t[2],"(e) "+a.excepcion);1==a.horario&&(b+="\nHORARIO: "+a.hora_ini+" a "+a.hora_fin),b+="\n ESTADO: "+a.controlexcepcion_estado_descripcion,x.push({id:0,className:"excepciones",title:b,start:new Date(i,n,c,l,s),end:new Date(p,u,f,h,m),allDay:!0,color:a.color,textColor:"#000",editable:!1,borderColor:"#000",horas_laborales:0,dias_laborales:0,hora_entrada:a.hora_ini,hora_salida:a.hora_fin,tipo_evento:"c",icon:"fa fa-file-text-o"})}),x}function obtenerListadoFechasConExcepcionEnCalendario(e,a,r,o,t){var i=[];return $.ajax({url:"/controlexcepciones/listporrelaboralyrango",type:"POST",datatype:"json",cache:!1,async:!1,data:{id_relaboral:e,fecha_ini:o,fecha_fin:t},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){i.push({fecha:a.fecha,dia:a.dia,dia_nombre:a.dia_nombre,dia_nombre_abr_ing:a.dia_nombre_abr_ing,id_controlexcepcion:a.id_controlexcepcion,id_relaboral:a.id_relaboral,fecha_ini:a.fecha_ini,hora_ini:a.hora_ini,fecha_fin:a.fecha_fin,hora_fin:a.hora_fin,justificacion:a.justificacion,controlexcepcion_observacion:a.controlexcepcion_observacion,controlexcepcion_estado:a.controlexcepcion_estado,controlexcepcion_estado_descripcion:a.controlexcepcion_estado_descripcion,excepcion_id:a.excepcion_id,excepcion:a.excepcion,tipoexcepcion_id:a.tipoexcepcion_id,tipo_excepcion:a.tipo_excepcion,codigo:a.codigo,color:a.color,compensatoria:a.compensatoria,compensatoria_descripcion:a.compensatoria_descripcion,genero_id:a.genero_id,genero:a.genero,cantidad:a.cantidad,unidad:a.unidad,fraccionamiento:a.fraccionamiento,frecuencia_descripcion:a.frecuencia_descripcion,redondeo:a.redondeo,redondeo_descripcion:a.redondeo_descripcion,horario:a.horario,horario_descripcion:a.horario_descripcion})})}}),i}function cargarModalHorario(e){return 0<e&&($.ajax({url:"/horarioslaborales/getone",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){$("#txtNombreHorario").val(a.nombre),$("#txtNombreAlternativoHorario").val(a.nombre_alternativo),$("#txtColorHorario").val(a.color),$("#txtColorHorario").css({"background-color":a.color,color:a.color}),$("#txtHoraEntHorario").val(a.hora_entrada),$("#txtHoraSalHorario").val(a.hora_salida),$("#txtHoraInicioRangoEnt").val(a.hora_inicio_rango_ent),$("#txtHoraFinalizacionRangoEnt").val(a.hora_final_rango_ent),$("#txtHoraInicioRangoSal").val(a.hora_inicio_rango_sal),$("#txtHoraFinalizacionRangoSal").val(a.hora_final_rango_sal),$("#txtObservacion").val(a.observacion);var r=a.hora_entrada,o=a.hora_salida;""==r&&(r="00:00:00"),""==o&&(o="00:00:00"),$("#txtHorasLaborales").val(a.horas_laborales)})}}),!0)}function obtenerDatosHorario(e){var r=[];return 0<e&&$.ajax({url:"/horarioslaborales/getone",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){r.push({nombre:a.nombre,nombre_alternativo:a.nombre_alternativo,color:a.color,hora_entrada:a.hora_entrada,hora_salida:a.hora_salida,hora_inicio_rango_ent:a.hora_inicio_rango_ent,hora_final_rango_ent:a.hora_final_rango_ent,hora_inicio_rango_sal:a.hora_inicio_rango_sal,observacion:a.observacion,horas_laborales:a.horas_laborales,dias_laborales:a.dias_laborales})})}}),r}function obtenerFeriadosRangoFechas(e,a,r,o,t){var i=[];return 0<r&&""!=o&&""!=t&&$.ajax({url:"/feriados/listrange",type:"POST",datatype:"json",async:!1,cache:!1,data:{dia:e,mes:a,gestion:r,fecha_ini:o,fecha_fin:t},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){i.push({id:a.id,feriado:a.feriado,descripcion:a.descripcion,cantidad_dias:a.cantidad_dias,repetitivo:a.repetitivo,dia:a.dia,mes:a.mes,gestion:a.gestion,fecha_ini:a.fecha_ini,fecha_fin:a.fecha_fin,observacion:a.observacion})})}}),i}