function validaFormularioRegistroCalendario(a,r,c,l,h){var e=!0;$(".progress-bar").removeClass("progress-bar-success"),$(".progress-bar").addClass("progress-bar-info");var o="";$(".msjs-alert").hide();var n=$("#lstTolerancias").val(),i=$("#calendar").fullCalendar("clientEvents"),d=0,_=0,f=0,u=[],p=!0,v=1;if(p=3==c?verificaCruceDeHorariosEnMes():prevenirCruceDeHorariosEnVariosMeses(r,l,h),console.log("Cruce devolvio: "+p),p){var g=0;if($.each(i,function(a,r){var e=(r.className+"").split("_")[0];"r"!=e&&"n"!=e||g++}),$.each(i,function(a,r){var e=(r.className+"").split("_")[0];switch(p=!0,e){case"r":case"n":d++;var o=fechaConvertirAFormato(r.start,"-"),n="";n=null!=r.start&&null==r.end?fechaConvertirAFormato(r.start,"-"):fechaConvertirAFormato(r.end,"-");var i=o.split("-");_=i[1];var s=n.split("-");f=s[1],u.push(_),u.push(f),3==c&&(""!=l&&""!=h?(1==v&&(v=verificaSiFechaEstaEnRango(o,l,h)),1==v&&(v=verificaSiFechaEstaEnRango(n,l,h))):v=0)}if(1==v){$("#divProgressBar").show();var t=parseFloat(100*d/g);t=t.toFixed(0),$(".progress-bar",".bars-container").each(function(){var a=t+"%";$(this).css("width",a).html(a+" [Validaci&oacute;n: "+d+" de "+g+"]")})}}),0==d){e=!1;o="Debe registrar al menos un evento en el calendario necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")}else if(3==c)if(0==v)e=!1,o="Existen horarios fuera del rango admitido de registro. Verifique que todos los horarios esten entre el "+l+" al "+h+".",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open");else{var s=obtieneMesesInvolucrados(u);1<s.length?(e=!1,o="Registro "+s.length+" meses en el calendario. El registro de horarios s&oacute;lo debe contemplar la asignaci&oacute;n dentro de un mes.",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")):0==s.length&&(e=!1,o="Debe seleccionar al menos un horario para su registro.",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open"))}}else e=!1;return 3<=a&&(0==n||null==n)&&(e=!1,o="Debe seleccionar un tipo de tolerancia necesariamente.",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")),e}function guardaFormularioRegistroCalendario(d,_,a,r,e){$("#divProgressBar").hide(),$(".progress-bar").removeClass("progress-bar-info"),$(".progress-bar").addClass("progress-bar-success"),$(".progress-bar",".bars-container").each(function(){$(this).css("width","0%").html("0%")});var o=$("#calendar").fullCalendar("clientEvents"),f=0,u=0,p=0;3<=d&&null!=$("#lstTolerancias").val()&&0<$("#lstTolerancias").val()&&(p=$("#lstTolerancias").val());var v=!0,g=!0,m=0,n=r.split("-"),E=parseInt(n[1]),j=parseInt(n[2]);return $.each(o,function(a,r){var e=(r.className+"").split("_")[0];if("r"==e||"n"==e)m++;else if("b"==e){var o=fechaConvertirAFormato(r.start,"-").split("-"),n=parseInt(o[1]),i=parseInt(o[2]);n==E&&i==j&&m++}}),$.each(o,function(a,r){var e=(r.className+"").split("_"),o=e[0],n=e[1],i=0;null!=r.id&&(i=r.id);var s=fechaConvertirAFormato(r.start,"-"),t="";t=null!=r.start&&null==r.end?fechaConvertirAFormato(r.start,"-"):fechaConvertirAFormato(r.end,"-");var c=s.split("-");u=parseInt(c[1]);var l=parseInt(c[2]);switch(t.split("-")[1],o){case"r":f++,(v=guardarTurnoEnCalendario(d,i,_,n,p,1,s,t,""))||(g=!1);break;case"b":u==E&&l==j&&(f++,(v=guardarTurnoEnCalendario(d,i,_,n,p,1,s,t,""))||(g=!1));break;case"n":f++,(v=guardarTurnoEnCalendario(d,0,_,n,p,1,s,t,""))||(g=!1)}if(v){$("#divProgressBar").show();var h=parseFloat(100*f/m);h=h.toFixed(0),$(".progress-bar",".bars-container").each(function(){var a=h+"%";$(this).css("width",a).html(a+" [Registro "+f+" de "+m+"]")})}}),g}function prevenirCruceDeHorariosEnVariosMeses(a,r,e){return!0}function verificaCruceDeHorariosEnMes(){$("#divCarga").hide();var a=!0,s=[],o=$("#calendar").fullCalendar("clientEvents");if(1<o.length){$.each(["mon","tue","wed","thu","fri","sat","sun"],function(a,r){$("td.fc-"+r).map(function(a,r){var i=$(this).data("date");if(null!=i){var e=i.split("-");i=e[2]+"-"+e[1]+"-"+e[0],$.each(o,function(a,r){var e=(r.className+"").split("_")[1];null!=r.id&&r.id;var o=$.fullCalendar.formatDate(r.start,"dd-MM-yyyy"),n=$.fullCalendar.formatDate(r.end,"dd-MM-yyyy");""==n&&(n=o),procesaTextoAFecha(o,"-")<=procesaTextoAFecha(i,"-")&&procesaTextoAFecha(i,"-")<=procesaTextoAFecha(n,"-")&&s.push({fecha:i,id_horario:e,horas_laborales:r.horas_laborales,hora_entrada:r.hora_entrada,hora_inicio_rango_ent:r.hora_inicio_rango_ent,hora_final_rango_ent:r.hora_final_rango_ent,hora_salida:r.hora_salida,hora_inicio_rango_sal:r.hora_inicio_rango_sal,hora_final_rango_sal:r.hora_final_rango_sal,agrupador:r.agrupador})})}})});var e=[];$.each(s,function(a,r){e.push(r.fecha)});var r=$.unique(e),n={};$.each(r,function(a,e){var o=1;$.each(s,function(a,r){e==r.fecha&&(n[r.fecha]=o,o++)})});var c=[],l=0;$.each(n,function(t,a){if(1<=a){$.each(s,function(a,r){if(t==r.fecha)if(parseFloat(r.horas_laborales),l++,r.hora_entrada>r.hora_salida||r.hora_inicio_rango_ent>r.hora_final_rango_sal){var e=fechaConvertirAFormato(sumarDias(convierteTextoAFecha(r.fecha,"-"),1),"-");if(r.hora_entrada>r.hora_salida){var o=r.hora_entrada;if("59"!==(i=r.hora_entrada.split(":"))[2]&&(1===((s=parseInt(i[2])+1)+"").length&&(s="0"+s),o=i[0]+":"+i[1]+":"+s),c.push({id:l,fecha:r.fecha,hora_entrada:o,hora_salida:"23:59:59"}),console.log("Control 1: fecha: "+r.fecha+",hora_entrada: "+r.hora_inicio_rango_ent+", hora_salida: "+r.hora_salida+",id: "+l+"->"+r.agrupador),void 0===r.agrupador||0===r.agrupador){var n=r.hora_inicio_rango_ent;"59"!==(i=r.hora_inicio_rango_ent.split(":"))[2]&&(1===((s=parseInt(i[2])+1)+"").length&&(s="0"+s),n=i[0]+":"+i[1]+":"+s),c.push({id:l,fecha:r.fecha,hora_entrada:n,hora_salida:"23:59:59"})}l++,c.push({id:l,fecha:e,hora_entrada:"00:00:00",hora_salida:r.hora_salida}),console.log("Control 2: fecha: "+e+",hora_entrada: 00:00:00, hora_salida: "+r.hora_final_rango_sal+",id: "+l+"->"+r.agrupador),void 0!==r.agrupador&&0!==r.agrupador||c.push({id:l,fecha:e,hora_entrada:"00:00:00",hora_salida:r.hora_final_rango_sal})}else c.push({id:l,fecha:r.fecha,hora_entrada:r.hora_entrada,hora_salida:r.hora_salida}),console.log("Control 3: fecha: "+r.fecha+",hora_entrada: "+r.hora_inicio_rango_ent+", hora_salida: 23:59:59,id: "+l+"->"+r.agrupador),(void 0===r.agrupador||0===r.agrupador)&&(n=r.hora_inicio_rango_ent,"59"!==(i=r.hora_inicio_rango_ent.split(":"))[2]&&(1===((s=parseInt(i[2])+1)+"").length&&(s="0"+s),n=i[0]+":"+i[1]+":"+s),c.push({id:l,fecha:r.fecha,hora_entrada:n,hora_salida:"23:59:59"}),l++,c.push({id:l,fecha:e,hora_entrada:"00:00:00",hora_salida:r.hora_final_rango_sal}))}else{var i,s;o=r.hora_entrada,"59"!==(i=r.hora_entrada.split(":"))[2]&&(1===((s=parseInt(i[2])+1)+"").length&&(s="0"+s),o=i[0]+":"+i[1]+":"+s),c.push({id:l,fecha:r.fecha,hora_entrada:o,hora_salida:r.hora_salida})}});var r=t.split("-");r[2],r[1],r[0]}}),$("#divCarga").show(),a=verificarCruceHorariosParticionados(c),$("#divCarga").hide()}return a}function verificarCruceHorariosParticionados(e){var t=!0,c=!0,l="";return 0<e.length&&$.each(e,function(a,s){var r=e;if(!t||!c)return!1;$.each(r,function(a,r){if(r.id!=s.id&&r.fecha==s.fecha){console.log("1.1 ("+s.id+":"+r.id+") - comparar: '"+s.fecha+" "+s.hora_entrada+"' entre '"+r.fecha+" "+r.hora_entrada+"' y '"+r.fecha+" "+r.hora_salida+"'"),l="No se puede registrar el calendario debido a que existe cruce de horarios en fecha '"+s.fecha+" "+s.hora_entrada+"' entre '"+r.fecha+" "+r.hora_entrada+"' y '"+r.fecha+" "+r.hora_salida+"'";var e,o=s.fecha+" "+s.hora_entrada,n=r.fecha+" "+r.hora_entrada,i=r.fecha+" "+r.hora_salida;if("00"==(e=n.split(":"))[2]&&(n=e[0]+":"+e[1]+":01"),t=verificaFechaHoraEnRango(o,n,i))console.log("1.2 ("+s.id+":"+r.id+") - comparar: '"+s.fecha+" "+s.hora_salida+"' entre '"+r.fecha+" "+r.hora_entrada+"' y '"+r.fecha+" "+r.hora_salida+"'"),l="No se puede registrar el calendario debido a que existe cruce de horarios en fecha '"+s.fecha+" "+s.hora_salida+"' entre '"+r.fecha+" "+r.hora_entrada+"' y '"+r.fecha+" "+r.hora_salida+"'",o=s.fecha+" "+s.hora_salida,n=r.fecha+" "+r.hora_entrada,i=r.fecha+" "+r.hora_salida,"00"==(e=n.split(":"))[2]&&(n=e[0]+":"+e[1]+":01"),c=verificaFechaHoraEnRango(o,n,i);if(!t||!c)return $("#divCarga").hide(),$("#divMsjePorError").html(""),$("#divMsjePorError").append(l),$("#divMsjeNotificacionError").jqxNotification("open"),!1}})}),!(!t||!c)}function verificaCrucePorListaDeHorariosRangos(e,d){var _=!0,f=!0,u=fechaConvertirAFormato(sumarDias(convierteTextoAFecha(d,"-"),1),"-");return 0<e.length&&""!=d&&$.each(e,function(a,h){var r=e;$.each(r,function(a,r){if(h.id!=r.id){if(!_||!f)return!1;var e=h.hora_inicio_rango_ent.split(":"),o=h.hora_inicio_rango_ent;"00"==e[2]&&(o=e[0]+":"+e[1]+":01");var n=d+" "+o,i=d+" "+r.hora_inicio_rango_ent,s=d+" "+r.hora_final_rango_sal;if(r.hora_inicio_rango_ent>r.hora_final_rango_sal||2==r.cruce){var t="("+h.id+":"+r.id+") 1.1) Existe cruce posterior. Compara: "+n+" entre "+i+" al "+s;t+="=> "+n+" entre "+(i=u+" "+r.hora_inicio_rango_ent)+" al "+(s=u+" "+r.hora_final_rango_sal),console.log(t)}else h.hora_inicio_rango_ent>h.hora_final_rango_sal?(t="("+h.id+":"+r.id+") 1.1) Existe cruce anterior. Compara: "+n+" entre "+i+" al "+s,console.log(t)):console.log("("+h.id+":"+r.id+") 1.1) Compara: "+n+" entre "+i+" al "+s);if(_=verificaFechaHoraEnRango(n,i,s)){var c=r.hora_inicio_rango_ent.split(":"),l=r.hora_inicio_rango_ent;"00"==e[2]&&(l=c[0]+":"+c[1]+":01"),n=d+" "+h.hora_final_rango_sal,i=d+" "+l,s=d+" "+r.hora_final_rango_sal,r.hora_inicio_rango_ent>r.hora_final_rango_sal?(t="("+h.id+":"+r.id+") 2.1) Existe cruce posterior. Compara: "+n+" entre "+i+" al "+s,t+="=> "+n+" entre "+i+" al "+(s=u+" "+r.hora_final_rango_sal),console.log(t)):(h.hora_inicio_rango_ent>h.hora_final_rango_sal?(t="("+h.id+":"+r.id+") 2.1) Existe cruce anterior. Compara: "+n+" entre "+i+" al "+s,t+="=> "+(n=u+" "+h.hora_final_rango_sal)+" entre "+i+" al "+s,console.log(t)):console.log("("+h.id+":"+r.id+") 2.1) Compara: "+n+" entre "+i+" al "+s),2==h.cruce&&(n=u+" "+h.hora_final_rango_sal)),f=verificaFechaHoraEnRango(n,i,s)}if(!_||!f)return!1}})}),!(!_||!f)}function verificaHoraEnRango(a,r,e){var o=!0;return""!=a&&""!=r&&""!=e?$.ajax({url:"/calendariolaboral/verificahoraenrango/",type:"POST",datatype:"json",async:!1,cache:!1,data:{hora:a,hora_ini:r,hora_fin:e},success:function(a){var r=jQuery.parseJSON(a);o=1!=r.result}}):o=!1,o}function verificaFechaHoraEnRango(a,r,e){var o=!0;return""!=a&&""!=r&&""!=e?$.ajax({url:"/calendariolaboral/verificafechayhoraenrango/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha_hora:a,fecha_hora_ini:r,fecha_hora_fin:e},success:function(a){var r=jQuery.parseJSON(a);o=1!=r.result}}):o=!1,o}function guardarTurnoEnCalendario(a,r,e,o,n,i,s,t,c){var l=!1;return 1<=a&&0<e&&0<o&&""!=s&&""!=t&&0<i&&$.ajax({url:"/calendariolaboral/saveturno/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:r,id_perfillaboral:e,id_horario:o,fecha_ini:s,fecha_fin:t,id_tolerancia:n,id_jornada_laboral:i,observacion:c,opcion:a},success:function(a){var r=jQuery.parseJSON(a);if(1==r.result)l=!0;else{l=!1;var e=r.msj;$("#divMsjePorError").html(""),$("#divMsjePorError").append(e),$("#divMsjeNotificacionError").jqxNotification("open")}}}),l}function obtieneMesesInvolucrados(a){var e=[];return 0<a.length&&$.each(a,function(a,r){jQuery.inArray(r,e)<0&&e.push(r)}),e}function verificaSiFechaEstaEnRango(a,r,e){return $.ajax({url:"/perfileslaborales/checkinrange/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha_eval:a,fecha_ini:r,fecha_fin:e},success:function(a){}}).responseText}function retornaEstadoElaboracion(a,r,e,o){var n=!0,i=$("#calendar").fullCalendar("clientEvents"),s=[],t="";return $.each(i,function(a,r){var e=(r.className+"").split("_"),o=e[0];e[1],"r"==o&&null!=r.id&&s.push(r.id)}),0<s.length&&(t=s.join(",")),$.ajax({url:"/calendariolaboral/retornaestadoelaboracion/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id_perfillaboral:a,tipo_horario:r,id_horarios:t,fecha_ini:e,fecha_fin:o},success:function(a){1!=jQuery.parseJSON(a).result&&(n=!1)}}),n}function verificaExcesoHorasSemanales(){var a=!0,r=parseFloat($("#hdnJornadaLaboralSemanal").val());return r<parseFloat($("#spSumaSemana1").text())&&(a=!1),r<parseFloat($("#spSumaSemana2").text())&&(a=!1),r<parseFloat($("#spSumaSemana3").text())&&(a=!1),r<parseFloat($("#spSumaSemana4").text())&&(a=!1),r<parseFloat($("#spSumaSemana5").text())&&(a=!1),r<parseFloat($("#spSumaSemana6").text())&&(a=!1),a}function calculaExcesoPromedioTresSemanas(){var a=!0,r=parseFloat($("#hdnJornadaLaboralSemanal").val()),e=(parseFloat($("#spSumaSemana1").text()),parseFloat($("#spSumaSemana2").text())),o=parseFloat($("#spSumaSemana3").text()),n=parseFloat($("#spSumaSemana4").text());return parseFloat($("#spSumaSemana5").text()),parseFloat($("#spSumaSemana6").text()),r<parseFloat(e+o+n)/3&&(a=!1),a}