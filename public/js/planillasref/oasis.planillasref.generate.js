function cargarGestiones(e,i){var a="Gen";2==e&&(a="View");var t="";$("#lstGestion"+a).html(""),$("#lstGestion"+a).append("<option value=''>Seleccionar</option>"),$("#lstGestion"+a).prop("disabled",!1);$.ajax({url:"/planillassal/getgestionesgeneracion/",type:"POST",datatype:"json",async:!1,cache:!1,success:function(e){var a=jQuery.parseJSON(e);return 0<a.length&&$.each(a,function(e,a){t+="<option value='"+a+"' "+(i==a?"selected":"")+">"+a+"</option>"}),a}}),""!=t?$("#lstGestion"+a).append(t):$("#lstGestion"+a).prop("disabled",!0)}function cargarMeses(e,a,i){var t="Gen";2==e&&(t="View");var l="";$("#lstMes"+t).html(""),$("#lstMes"+t).append("<option value=''>Seleccionar</option>"),$("#lstMes"+t).prop("disabled",!1);var r="";0<a&&$.ajax({url:"/planillasref/getmesesgeneracion/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:a},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){r=i==a.mes?"selected":"",l+="<option value='"+a.mes+"' "+r+">"+a.mes_nombre+"</option>"})}}),""!=l?$("#lstMes"+t).append(l):$("#lstMes"+t).prop("disabled",!0)}function cargarFinPartidas(e,a,i,t){var l="Gen";2==e&&(l="View");var r="";$("#lstFinPartida"+l).html(""),$("#lstFinPartida"+l).append("<option value=''>Seleccionar</option>"),$("#lstFinPartida"+l).prop("disabled",!1);var n="";0<a&&0<i&&$.ajax({url:"/planillasref/getfinpartidasgeneracion/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:a,mes:i},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){n=t==a.id_finpartida?"selected":"",r+="<option value='"+a.id_finpartida+"' "+n+">"+a.fin_partida+"</option>"})}}),""!=r?$("#lstFinPartida"+l).append(r):$("#lstFinPartida"+l).prop("disabled",!0)}function cargarTiposDePlanilla(e,a,i,t,l){var r="Gen";2==e&&(r="View");var n="";$("#lstTipoPlanillaRef"+r).html(""),$("#lstTipoPlanillaRef"+r).append("<option value=''>Seleccionar</option>"),$("#lstTipoPlanillaRef"+r).prop("disabled",!1);var o="";0<a&&0<i&&0<t&&$.ajax({url:"/planillasref/gettiposplanillasref/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:a,mes:i,id_finpartida:t},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){o=l==a.id_tipoplanilla?"selected":"",n+="<option value='"+a.id_tipoplanilla+"' "+o+" data-numero='"+a.numero+"'>"+a.tipo_planilla_disponible+"</option>"})}}),""!=n?$("#lstTipoPlanillaRef"+r).append(n):$("#lstTipoPlanillaRef"+r).prop("disabled",!0)}function limpiarFormularioPlanillaRef(e){var a="Gen";2==e&&(a="View"),$("#divGestion"+a).removeClass("has-error"),$("#helpErrorGestion"+a).html(""),$("#divMes"+a).removeClass("has-error"),$("#helpErrorMes"+a).html(""),$("#divFinPartida"+a).removeClass("has-error"),$("#helpErrorFinPartida"+a).html(""),$("#divTipoPlanillaRef"+a).removeClass("has-error"),$("#helpErrorTipoPlanillaRef"+a).html("")}function validaFormularioPlanillaRef(e){var a=!0,i="Gen",t="generaci&oacute;n";2==e&&(i="View",t="vista");var l=$("#divGestion"+i),r=$("#lstGestion"+i).val(),n=$("#helpErrorGestion"+i),o=$("#divMes"+i),d=$("#lstMes"+i).val(),s=$("#helpErrorMes"+i),c=$("#divFinPartida"+i),p=$("#lstFinPartida"+i).val(),u=$("#helpErrorFinPartida"+i),f=$("#divTipoPlanillaRef"+i),g=$("#lstTipoPlanillaRef"+i).val(),h=($("#lstTipoPlanillaRef"+i).data("numero"),$("#helpErrorTipoPlanillaRef"+i));if(""==r||0==r){a=!1;var v="Debe seleccionar la gesti&oacute;n para la "+t+" de la Planilla de Refrigerio.";l.addClass("has-error"),n.html(v)}if(""==d||0==d){a=!1;v="Debe seleccionar el mes para la "+t+" de la Planilla de Refrigerio.";o.addClass("has-error"),s.html(v)}if(""==p||0==p){a=!1;v="Debe seleccionar la Fuente para la "+t+" de la Planilla de Refrigerio.";c.addClass("has-error"),u.html(v)}if(""==g||0==g){a=!1;v="Debe seleccionar la Fuente para la "+t+" de la Planilla de Refrigerio.";f.addClass("has-error"),h.html(v)}return a}function desplegarPlanillaPreviaRef(e){var a={datatype:"json",updaterow:function(e,a,i){i(!0)},datafields:[{name:"nro_row",type:"integer"},{name:"chk",type:"bool"},{name:"opcion",type:"string"},{name:"id_relaboral",type:"integer"},{name:"gestion",type:"integer"},{name:"mes",type:"integer"},{name:"gerencia_administrativa",type:"string"},{name:"departamento_administrativo",type:"string"},{name:"area",type:"string"},{name:"ubicacion",type:"string"},{name:"fin_partida",type:"string"},{name:"proceso_codigo",type:"string"},{name:"cargo",type:"string"},{name:"nombres",type:"string"},{name:"ci",type:"string"},{name:"expd",type:"string"},{name:"cargo",type:"string"},{name:"sueldo",type:"numeric"},{name:"fecha_ini",type:"date"},{name:"fecha_incor",type:"date"},{name:"fecha_fin",type:"date"},{name:"fecha_baja",type:"date"},{name:"dias_efectivos",type:"numeric"},{name:"monto_diario",type:"numeric"},{name:"faltas",type:"numeric"},{name:"atrasos",type:"numeric"},{name:"lsgh",type:"numeric"},{name:"vacacion",type:"numeric"},{name:"otros",type:"numeric"},{name:"id_form110impref",type:"numeric"},{name:"importe",type:"numeric"},{name:"rc_iva",type:"numeric"},{name:"retencion",type:"numeric"},{name:"form110impref_observacion",type:"string"},{name:"fecha_form",type:"date"},{name:"total_ganado",type:"numeric"},{name:"total_liquido",type:"numeric"},{name:"estado",type:"string"},{name:"estado_descripcion",type:"string"},{name:"cargar_formulario_110",type:"numeric"}],url:"/planillasref/displayplanprevia?gestion="+$("#lstGestionGen").val()+"&mes="+$("#lstMesGen").val()+"&id_finpartida="+$("#lstFinPartidaGen").val()+"&id_tipoplanilla="+$("#lstTipoPlanillaRefGen").val()+"&numero="+$("#lstTipoPlanillaRefGen option:selected").data("numero")+"&id_relaborales="+e,cache:!1},i=new $.jqx.dataAdapter(a);!function(){var e=prepareSimulator("grid");$("#divGridPlanillasRefGen").jqxGrid({theme:e,width:"100%",height:"100%",source:i,editable:!0,sortable:!0,altRows:!0,columnsresize:!0,pageable:!0,pagerMode:"advanced",showfilterrow:!0,filterable:!0,showstatusbar:!0,statusbarheight:50,showaggregates:!0,autorowheight:!0,selectionmode:"checkbox",pagesize:10,columns:[{text:"Nro.",filterable:!1,columntype:"number",width:40,cellsalign:"center",align:"center",editable:!1,pinned:!0,cellsrenderer:rownumberrenderer,aggregatesrenderer:function(e){return'<div id="divTotalConsiderados" style="float: center; margin: 4px; overflow: hidden;">0</div>'}},{text:"Nombres",datafield:"nombres",width:100,cellsalign:"justify",align:"center",pinned:!0,editable:!1},{text:"CI",datafield:"ci",width:60,align:"center",editable:!1,pinned:!0,cellsalign:"center",aggregatesrenderer:function(e){return'<div id="divTotal" style="float: right; margin: 4px; overflow: hidden;">Totales:</div>'}},{text:"Expd",filtertype:"checkedlist",datafield:"expd",width:30,cellsalign:"center",align:"center",editable:!1},{text:"Gerencia",filtertype:"checkedlist",datafield:"gerencia_administrativa",width:220,align:"center",editable:!1,hidden:!1},{text:"Departamento",filtertype:"checkedlist",datafield:"departamento_administrativo",width:220,align:"center",editable:!1,hidden:!1},{text:"&Aacute;rea",filtertype:"checkedlist",datafield:"area",width:150,align:"center",editable:!1,hidden:!1},{text:"Proceso",filtertype:"checkedlist",datafield:"proceso_codigo",width:220,cellsalign:"center",align:"center",editable:!1,hidden:!0},{text:"Fuente",filtertype:"checkedlist",datafield:"fin_partida",width:220,cellsalign:"center",align:"center",editable:!1,hidden:!0},{text:"Cargo",filtertype:"checkedlist",datafield:"cargo",width:100,cellsalign:"justify",align:"center",editable:!1,hidden:!0},{text:"Estado",filtertype:"checkedlist",datafield:"estado_descripcion",width:70,cellsalign:"center",align:"center",editable:!1,cellclassname:cellclass,hidden:!0},{text:"Fecha Inicio",datafield:"fecha_ini",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!0},{text:"Fecha Incor.",datafield:"fecha_incor",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Fin",datafield:"fecha_fin",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!0},{text:"Fecha Baja",datafield:"fecha_baja",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Haber",filtertype:"checkedlist",datafield:"sueldo",width:60,align:"center",editable:!1,cellsalign:"right",aggregatesrenderer:function(e){return'<div id="divTotalHaberes" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'},hidden:!0},{text:"D&iacute;as Efectivos",filtertype:"checkedlist",datafield:"dias_efectivos",width:40,align:"center",editable:!1,cellsalign:"right",aggregatesrenderer:function(e){return'<div id="divTotalDiasEfectivos" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"Monto Diario",editable:!1,filtertype:"checkedlist",datafield:"monto_diario",width:40,align:"center",cellsalign:"right",aggregatesrenderer:function(e){return'<div id="divTotalMontosDiarios" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"LSGHs",filtertype:"checkedlist",datafield:"lsgh",width:50,align:"center",editable:!1,cellsalign:"right",columngroup:"DescuentoDias",aggregatesrenderer:function(e){return'<div id="divTotalLsgh" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"Faltas",filtertype:"checkedlist",datafield:"faltas",width:50,align:"center",editable:!1,cellsalign:"right",columngroup:"DescuentoDias",aggregatesrenderer:function(e){return'<div id="divTotalFaltas" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"Vac.",filtertype:"checkedlist",datafield:"vacacion",width:50,align:"center",editable:!1,cellsalign:"right",columngroup:"DescuentoDias",aggregatesrenderer:function(e){return'<div id="divTotalVacacion" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"Otros",filtertype:"checkedlist",datafield:"otros",width:50,align:"center",editable:!1,cellsalign:"right",columngroup:"DescuentoDias",aggregatesrenderer:function(e){return'<div id="divTotalOtros" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"",datafield:"opcion",width:10,sortable:!1,editable:!1,showfilterrow:!1,filterable:!1,columntype:"string",columngroup:"ImpuestoRefrigerio",cellsrenderer:function(e){var a=$("#divGridPlanillasRefGen").jqxGrid("getrowdata",e);return 0<a.total_ganado&&1==a.cargar_formulario_110?($("#btnGenerarPlanillaRef").show(),"<div style='width: 100%' align='center'><a href='#' class='btnForm110' id='"+e+"' onclick='abrirVentanaModalForm110ImpRef("+e+");'><i class='fa fa-file-text-o fa-2x text-info' title='Registrar Formulario 110'></i></a></div>"):""}},{text:"Importe",filtertype:"checkedlist",datafield:"importe",width:60,align:"center",cellsalign:"right",cellsformat:"f2",columngroup:"ImpuestoRefrigerio",columntype:"numberinput",hidden:!0,aggregatesrenderer:function(e){return'<div id="divTotalForm110" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"RC-IVA",filtertype:"checkedlist",datafield:"rc_iva",width:60,align:"center",editable:!1,cellsalign:"right",columngroup:"ImpuestoRefrigerio",aggregatesrenderer:function(e){return'<div id="divTotalRcIva" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"Retenci&oacute;n",filtertype:"checkedlist",datafield:"retencion",width:60,align:"center",editable:!1,cellsalign:"right",columngroup:"ImpuestoRefrigerio",aggregatesrenderer:function(e){return'<div id="divTotalRetencion" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"Fecha F. 110",datafield:"fecha_form",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",editable:!1,columntype:"datetimeinput",hidden:!0},{text:"F. 110 Obs.",datafield:"form110impref_observacion",width:90,align:"center",editable:!1,cellsalign:"right",hidden:!0},{text:"Ganado",filtertype:"checkedlist",datafield:"total_ganado",width:60,align:"center",editable:!1,cellsalign:"right",aggregatesrenderer:function(e){return'<div id="divTotalTotalGanado" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}},{text:"L&iacute;quido",filtertype:"checkedlist",datafield:"total_liquido",width:60,align:"center",editable:!1,cellsalign:"right",aggregatesrenderer:function(e){return'<div id="divTotalTotalLiquido" style="float: right; margin: 4px; overflow: hidden;">0.00</div>'}}],columngroups:[{text:"Desc. D&iacute;as",align:"center",name:"DescuentoDias"},{text:"Impuestos",align:"center",name:"ImpuestoRefrigerio"}]});function a(){var e=$("#divGridPlanillasRefGen").jqxGrid("selectedrowindexes"),l=0,r=0,n=0,o=0,d=0,s=0,c=0,p=0,u=0,f=0,g=0,h=0,v=0,m=0;$.each(e,function(e,a){var i=a,t=$("#divGridPlanillasRefGen").jqxGrid("getrowdata",i);0<t.dias_efectivos&&(0<t.id_relaboral&&l++,isNaN(t.sueldo)||null==t.sueldo||(r+=Number(parseFloat(t.sueldo))),isNaN(t.dias_efectivos)||null==t.dias_efectivos||(n+=Number(parseFloat(t.dias_efectivos))),isNaN(t.monto_diario)||null==t.monto_diario||(o+=Number(parseFloat(t.monto_diario))),isNaN(t.faltas)||null==t.faltas||(d+=Number(parseFloat(t.faltas))),isNaN(t.atrasos)||null==t.atrasos||(s+=Number(parseFloat(t.atrasos))),isNaN(t.lsgh)||null==t.lsgh||(c+=Number(parseFloat(t.lsgh))),isNaN(t.vacacion)||null==t.vacacion||(p+=Number(parseFloat(t.vacacion))),isNaN(t.otros)||null==t.otros||(u+=Number(parseFloat(t.otros))),isNaN(t.importe)||null==t.importe||(g+=Number(parseFloat(t.importe))),isNaN(t.rc_iva)||null==t.rc_iva||(f+=Number(parseFloat(t.rc_iva))),isNaN(t.retencion)||null==t.retencion||(h+=Number(parseFloat(t.retencion))),isNaN(t.total_ganado)||null==t.total_ganado||(v+=Number(parseFloat(t.total_ganado))),isNaN(t.total_liquido)||null==t.total_liquido||(m+=Number(parseFloat(t.total_liquido))))}),$("#divTotalConsiderados").text(""),$("#divTotalConsiderados").text(l),$("#divTotalHaberes").text(""),$("#divTotalHaberes").text(r.toFixed(2)),$("#divTotalMontosDiarios").text(""),$("#divTotalMontosDiarios").text(o.toFixed(2)),$("#divTotalDiasEfectivos").text(""),$("#divTotalDiasEfectivos").text(n.toFixed(2)),$("#divTotalFaltas").text(""),$("#divTotalFaltas").text(d.toFixed(2)),$("#divTotalAtrasos").text(""),$("#divTotalAtrasos").text(s.toFixed(2)),$("#divTotalImporte").text(""),$("#divTotalImporte").text(g.toFixed(2)),$("#divTotalRcIva").text(""),$("#divTotalRcIva").text(f.toFixed(2)),$("#divTotalRetencion").text(""),$("#divTotalRetencion").text(h.toFixed(2)),$("#divTotalLsgh").text(""),$("#divTotalLsgh").text(c.toFixed(2)),$("#divTotalVacacion").text(""),$("#divTotalVacacion").text(p.toFixed(2)),$("#divTotalOtros").text(""),$("#divTotalOtros").text(u.toFixed(2)),$("#divTotalTotalGanado").text(""),$("#divTotalTotalGanado").text(v.toFixed(2)),$("#divTotalTotalLiquido").text(""),$("#divTotalTotalLiquido").text(m.toFixed(2))}$("#divPlanilllaRefGenListBox").jqxListBox({source:[{label:"Nombres",value:"nombres",checked:!0},{label:"CI",value:"ci",checked:!0},{label:"Exp",value:"expd",checked:!0},{label:"Gerencia",value:"gerencia_administrativa",checked:!0},{label:"Departamento",value:"departamento_administrativo",checked:!0},{label:"&Aacute;rea",value:"area",checked:!0},{label:"Ubicaci&oacute;n",value:"ubicacion",checked:!1},{label:"Fuente",value:"fin_partida",checked:!1},{label:"Proceso",value:"procesocontratacion_codigo",checked:!1},{label:"Cargo",value:"cargo",checked:!1},{label:"Estado",value:"estado_descripcion",checked:!1},{label:"Fecha Ini",value:"fecha_ini",checked:!1},{label:"Fecha Incor",value:"fecha_incor",checked:!0},{label:"Fecha Fin",value:"fecha_fin",checked:!1},{label:"Fecha Baja",value:"fecha_baja",checked:!0},{label:"Nivel Salarial",value:"nivelsalarial",checked:!1},{label:"Haber",value:"sueldo",checked:!1},{label:"D&iacute;as Efec.",value:"dias_efectivos",checked:!0},{label:"Monto Diario",value:"monto_diario",checked:!0},{label:"LSGHs",value:"lsgh",checked:!0},{label:"Faltas",value:"faltas",checked:!0},{label:"Vacaci&oacute;n",value:"vacacion",checked:!0},{label:"Otros",value:"otros",checked:!0},{label:"Importe",value:"importe",checked:!1},{label:"RC-IVA",value:"rc_iva",checked:!0},{label:"Retenci&oacute;n",value:"retencion",checked:!0},{label:"Fecha F. 110",value:"fecha_form",checked:!1},{label:"F. 110 Obs.",value:"form110impref_observacion",checked:!1},{label:"Total Ganado",value:"total_ganado",checked:!0},{label:"Total L&iacute;quido",value:"total_liquido",checked:!0},{label:"Observacion",value:"observacion",checked:!1}],width:"100%",height:520,checkboxes:!0}),$("#divPlanilllaRefGenListBox").on("checkChange",function(e){$("#divGridPlanillasRefGen").jqxGrid("beginupdate"),e.args.checked?$("#divGridPlanillasRefGen").jqxGrid("showcolumn",e.args.value):$("#divGridPlanillasRefGen").jqxGrid("hidecolumn",e.args.value),$("#divGridPlanillasRefGen").jqxGrid("endupdate")}),$("#divGridPlanillasRefGen").off(),$("#divGridPlanillasRefGen").on("bindingcomplete",function(){var e=$("#divGridPlanillasRefGen").jqxGrid("getrows");0<e.length?$("#btnCalcularPlanillaPreviaRef").show():($("#btnGenerarPlanillaRef").hide(),$("#btnCalcularPlanillaPreviaRef").hide()),$("#divGridPlanillasRefGen").jqxGrid("clearselection")}),$("#divGridPlanillasRefGen").on("rowselect",function(e){a()}),$("#divGridPlanillasRefGen").on("rowunselect",function(e){a()})}()}function generarPlanillaDeRefrigerio(e,a,i,t,l,r,n){var o=!1;return 0<e&&0<a&&0<i&&0<=l&&""!=r&&$.ajax({url:"/planillasref/genplanilla/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:e,mes:a,id_finpartida:i,id_tipoplanilla:t,numero:l,id_relaborales:r,obs:n},beforeSend:function(){$("#divCarga").css({display:"block"})},success:function(e){$("#divCarga").css({display:"none"});var a=jQuery.parseJSON(e);$(".msjes").hide(),1==a.result?($("#divMsjePorSuccess").html(""),$("#divMsjePorSuccess").append(a.msj),$("#divMsjeNotificacionSuccess").jqxNotification("open"),o=!0):(a.result,$("#divMsjePorError").html(""),$("#divMsjePorError").append(a.msj),$("#divMsjeNotificacionError").jqxNotification("open"))},error:function(){alert("Se ha producido un error inesperado")}}),o}function procesaTextoAFecha(e,a){var i=e.split(a);return(e=new Date(i[1]+"/"+i[0]+"/"+i[2])).getTime()}