function abrirVentanaModalForm110ImpRef(e){$("#txtImporte").val(""),$("#txtImpuesto").val(""),$("#txtFechaForm").val(""),$("#txtObservacion").val(""),$("#hdnRowLine").val(e),$("#hdnIdForm110ImpRef").val(0),$("#hdnIdRelaboralForm110ImpRef").val(0),$("#hdnTotalGanadoForm110ImpRef").val(0),$("#hdnGestionForm110ImpRef").val(0),$("#hdnMesForm110ImpRef").val(0);if(limpiarVentanaModalForm110ImpRef(),0<=e){var a=$("#divGridPlanillasRefGen").jqxGrid("getrowdata",e),o=.13*a.total_ganado;o=o.toFixed(0);var r=getOneForm110ImpRef(a.id_form110impref,a.id_relaboral,a.gestion,a.mes);0<a.id_form110impref&&$("#hdnIdForm110ImpRef").val(parseInt(a.id_form110impref)),0<a.id_relaboral&&$("#hdnIdRelaboralForm110ImpRef").val(a.id_relaboral),0<a.total_ganado&&$("#hdnTotalGanadoForm110ImpRef").val(parseInt(a.total_ganado)),0<a.gestion&&$("#hdnGestionForm110ImpRef").val(a.gestion),0<a.mes&&$("#hdnMesForm110ImpRef").val(a.mes),0<r.id?($("#txtImporte").val(r.importe),$("#txtImpuesto").val(r.impuesto),$("#txtRetencion").val(r.retencion),$("#txtFechaForm").val(r.fecha_form),$("#txtObservacion").val(r.observacion)):$("#txtRetencion").val(o),$("#popupFormulario110ImpRef").modal("show"),$("#popupFormulario110ImpRef").on("shown.bs.modal",function(){$("#txtImporte").focus()}),$("#lblTotalGanado").text(a.total_ganado),$("#txtImporte").off(),$("#txtImporte").on("change",function(){var e=.13*$("#txtImporte").val();e=e.toFixed(0),$("#txtImpuesto").val(e);var a=o-e;(a=a.toFixed(0))<0&&(a=0),$("#txtRetencion").val(a)});$("#txtFechaForm").on("blur",function(){accept=$(this).val().match(/([0-9]{2})\-([0-9]{2})\-([0-9]{4})/),accept||$(this).val("")})}}function limpiarVentanaModalForm110ImpRef(){$("#divImporte").removeClass("has-error"),$("#helpErrorImporte").html(""),$("#divImpuesto").removeClass("has-error"),$("#helpErrorImpuesto").html(""),$("#divFechaForm").removeClass("has-error"),$("#helpErrorFechaForm").html(""),$("#divObservacion").removeClass("has-error"),$("#helpErrorObservacion").html("")}function getOneForm110ImpRef(e,a,o,r){var t={id:0,relaboral_id:0,gestion:0,mes:0,cantidad:0,monto_diario:0,importe:0,impuesto:0,retencion:0,fecha_form:null,codigo:null,observacion:null,estado:0};return $.ajax({url:"/form110impref/getoneforrelaboral/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e,id_relaboral:a,gestion:o,mes:r},success:function(e){var a=jQuery.parseJSON(e);return 0<a.length&&$.each(a,function(e,a){t={id:a.id,relaboral_id:a.relaboral_id,gestion:a.gestion,mes:a.mes,cantidad:a.cantidad,monto_diario:a.monto_diario,importe:a.importe,impuesto:a.impuesto,retencion:a.retencion,fecha_form:a.fecha_form,codigo:a.codigo,observacion:a.observacion,estado:a.estado}}),t},error:function(){alert("Se ha producido un error Inesperado")}}),t}function validaFormulario110ImpRef(){var e=!0;limpiarVentanaModalForm110ImpRef();var a=$("#divImporte"),o=$("#txtImporte").val(),r=$("#txtImporte"),t=$("#helpErrorImporte"),i=$("#divFechaForm"),n=$("#txtFechaForm").val(),l=$("#txtFechaForm"),m=$("#helpErrorFechaForm"),d=null;if(""==o||o<0){e=!1;var s="Debe seleccionar un monto mayor igual a cero para ser registrado en el sistema.";a.addClass("has-error"),t.html(s),null==d&&(d=r)}else if(isNaN(o)){e=!1;s="Debe seleccionar un monto mayor igual a cero para ser registrado en el sistema, no carÃ¡cteres alfanum&eacute;ricos.";a.addClass("has-error"),t.html(s),null==d&&(d=r)}if(""==n){e=!1;s="Debe seleccionar la fecha correspondiente del formulario 110.";i.addClass("has-error"),m.html(s),null==d&&(d=l)}return e}function guardarFormulario110ImpRef(){var e=!0,a=$("#hdnIdForm110ImpRef").val(),o=$("#hdnIdRelaboralForm110ImpRef").val(),r=$("#hdnTotalGanadoForm110ImpRef").val(),t=$("#txtImporte").val(),i=$("#hdnGestionForm110ImpRef").val(),n=$("#hdnMesForm110ImpRef").val(),l=$("#txtFechaForm").val(),m=$("#txtObservacion").val();if(0<o&&0<i&&0<n&&""!=l)e=$.ajax({url:"/form110impref/save/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:a,id_relaboral:o,total_ganado:r,cantidad:1,importe:t,gestion:i,mes:n,fecha_form:l,observacion:m},success:function(e){var a=jQuery.parseJSON(e);if($(".msjes").hide(),1==a.result)$("#divMsjePorSuccess").html(""),$("#divMsjePorSuccess").append(a.msj),$("#divMsjeNotificacionSuccess").jqxNotification("open");else if(0==a.result){$("#divMsjePorWarning").html(""),$("#divMsjePorWarning").append(a.msj),$("#divMsjeNotificacionWarning").jqxNotification("open")}else{$("#divMsjePorError").html(""),$("#divMsjePorError").append(a.msj),$("#divMsjeNotificacionError").jqxNotification("open")}},error:function(){alert("Se ha producido un error Inesperado")}});else e=!1;return e}function actualizaFila(){var e=!1,a=$("#hdnRowLine").val();if(0<=a){var o=$("#divGridPlanillasRefGen").jqxGrid("getrowdata",a),r=o.id_relaboral;if(null!=o.id_form110impref&&0<o.id_form110impref)var t=o.total_ganado;var i=o.gestion,n=o.mes,l=getOneForm110ImpRef(0,r,i,n),m=Math.round($("#txtImporte").val(),2),d=$("#txtFechaForm").val();d=procesaTextoAFecha(d,"-");var s=$("#txtObservacion").val(),c=.13*m,p=.13*t-(c=c.toFixed(2));p=p.toFixed(2),0<l.id&&(m=l.importe,d=l.fecha_form,s=l.observacion,c=l.impuesto,p=l.retencion),p<0&&(p=0);var v=parseFloat(o.total_ganado)-parseFloat(p);v=v.toFixed(2),0<r&&0<i&&0<n&&""!=d&&($("#divGridPlanillasRefGen").jqxGrid("setcellvalue",a,"importe",Math.round(m,0)),$("#divGridPlanillasRefGen").jqxGrid("setcellvalue",a,"rc_iva",Math.round(c,0)),$("#divGridPlanillasRefGen").jqxGrid("setcellvalue",a,"retencion",Math.round(p,0)),$("#divGridPlanillasRefGen").jqxGrid("setcellvalue",a,"form110impref_observacion",s),$("#divGridPlanillasRefGen").jqxGrid("setcellvalue",a,"fecha_form",d),$("#divGridPlanillasRefGen").jqxGrid("setcellvalue",a,"total_liquido",Math.round(v,0)),e=!0)}return e}function procesaTextoAFecha(e,a){var o=e.split(a);return(e=new Date(o[1]+"/"+o[0]+"/"+o[2])).getTime()}