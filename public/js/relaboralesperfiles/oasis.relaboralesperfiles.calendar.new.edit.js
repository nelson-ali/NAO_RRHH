function validaFormularioRegistroCalendario(a,r,s,l,c){var e=!0,o="";$(".msjs-alert").hide();var i,n=$("#lstTolerancias").val(),t=$("#calendar").fullCalendar("clientEvents"),d=0,u=0,h=0,f=[],p=!0,v=1;if(p=3==s?verificaCruceDeHorariosEnMes():prevenirCruceDeHorariosEnVariosMeses(r,l,c),i=calculaExcesoPromedioTresSemanas(),p&&i){if($.each(t,function(a,r){var e=(r.className+"").split("_")[0];switch(p=!0,e){case"r":case"n":d++;var o=fechaConvertirAFormato(r.start,"-"),i="";i=null!=r.start&&null==r.end?fechaConvertirAFormato(r.start,"-"):fechaConvertirAFormato(r.end,"-");var n=o.split("-");u=n[1];var t=i.split("-");h=t[1],f.push(u),f.push(h),3==s&&(""!=l&&""!=c?(1==v&&(v=verificaSiFechaEstaEnRango(o,l,c)),1==v&&(v=verificaSiFechaEstaEnRango(i,l,c))):v=0)}}),0==d){e=!1;o="Debe registrar al menos un evento en el calendario necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")}else if(3==s)if(0==v){e=!1;o="Existen horarios fuera del rango admitido de registro. Verifique que todos los horarios esten entre el "+l+" al "+c+".";$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")}else{var m=obtieneMesesInvolucrados(f);1<m.length?(e=!1,o="Registro "+m.length+" meses en el calendario. El registro de horarios s&oacute;lo debe contemplar la asignaci&oacute;n dentro de un mes.",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")):0==m.length&&(e=!1,o="Debe seleccionar al menos un horario para su registro.",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open"))}}else e=!1,i||(o="No se puede registrar el calendario debido a que existe carga horaria semanal que excede las 48 horas admitidas en promedio de tres semanas (Segunda, tercera y cuarta semana del mes en el calendario).",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open"));return 3<=a&&(0==n||null==n)&&(e=!1,o="Debe seleccionar un tipo de tolerancia necesariamente.",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")),e}function guardaFormularioRegistroCalendario(l,c,a,r,e){var o=$("#calendar").fullCalendar("clientEvents"),d=0;3<=l&&null!=$("#lstTolerancias").val()&&0<$("#lstTolerancias").val()&&(d=$("#lstTolerancias").val());var u=!0;return $.each(o,function(a,r){var e=(r.className+"").split("_"),o=e[0],i=e[1],n=0;null!=r.id&&(n=r.id);var t=fechaConvertirAFormato(r.start,"-"),s="";switch(s=null!=r.start&&null==r.end?fechaConvertirAFormato(r.start,"-"):fechaConvertirAFormato(r.end,"-"),t.split("-")[1],s.split("-")[1],o){case"r":guardarTurnoEnCalendario(l,n,c,i,d,1,t,s,"")||(u=!1);break;case"n":guardarTurnoEnCalendario(l,0,c,i,d,1,t,s,"")||(u=!1)}}),u}function prevenirCruceDeHorariosEnVariosMeses(a,r,e){return!0}function verificaCruceDeHorariosEnMes(){var t=!0,s=[],o=$("#calendar").fullCalendar("clientEvents");if(1<o.length){$.each(["mon","tue","wed","thu","fri","sat","sun"],function(a,r){$("td.fc-"+r).map(function(a,r){var n=$(this).data("date");if(null!=n){var e=n.split("-");n=e[2]+"-"+e[1]+"-"+e[0],$.each(o,function(a,r){var e=(r.className+"").split("_")[1];null!=r.id&&r.id;var o=$.fullCalendar.formatDate(r.start,"dd-MM-yyyy"),i=$.fullCalendar.formatDate(r.end,"dd-MM-yyyy");""==i&&(i=o),procesaTextoAFecha(o,"-")<=procesaTextoAFecha(n,"-")&&procesaTextoAFecha(n,"-")<=procesaTextoAFecha(i,"-")&&s.push({fecha:n,id_horario:e,horas_laborales:r.horas_laborales,hora_entrada:r.hora_entrada,hora_salida:r.hora_salida})})}})});var e=[];$.each(s,function(a,r){e.push(r.fecha)});var a=$.unique(e),i={};$.each(a,function(a,e){var o=1;$.each(s,function(a,r){e==r.fecha&&(i[r.fecha]=o,o++)})}),$.each(i,function(e,a){if(1<a){var o=0,i=[];$.each(s,function(a,r){e==r.fecha&&(parseFloat(r.horas_laborales),o++,i.push({id:o,fecha:r.fecha,id_horario:r.id_horario,horas_laborales:r.horas_laborales,hora_entrada:r.hora_entrada,hora_salida:r.hora_salida}))});var r=e.split("-");if(r[2],r[1],r[0],!(t=verificaCrucePorListaDeHorarios(i,e))){var n="No se puede registrar el calendario debido a que existe cruce de horarios en el calendario para la fecha: '"+e+"'.";return $("#divMsjePorError").html(""),$("#divMsjePorError").append(n),$("#divMsjeNotificacionError").jqxNotification("open"),!1}}})}return t}function verificaCrucePorListaDeHorarios(e,a){var s=!0,l=!0;return 0<e.length&&""!=a&&$.each(e,function(a,t){var r=e;$.each(r,function(a,r){if(t.id!=r.id){if(!s||!l)return!1;var e=t.hora_entrada.split(":"),o=t.hora_entrada;if("00"==e[2]&&(o=e[0]+":"+e[1]+":01"),s=verificaHoraEnRango(o,r.hora_entrada,r.hora_salida)){var i=r.hora_entrada.split(":"),n=r.hora_entrada;"00"==e[2]&&(n=i[0]+":"+i[1]+":01"),l=verificaHoraEnRango(t.hora_salida,n,r.hora_salida)}if(!s||!l)return!1}})}),!(!s||!l)}function verificaHoraEnRango(a,r,e){var o=!0;return""!=a&&""!=r&&""!=e?$.ajax({url:"/calendariolaboral/verificahoraenrango/",type:"POST",datatype:"json",async:!1,cache:!1,data:{hora:a,hora_ini:r,hora_fin:e},success:function(a){var r=jQuery.parseJSON(a);o=1!=r.result}}):o=!1,o}function guardarTurnoEnCalendario(a,r,e,o,i,n,t,s,l){var c=!1;return 1<=a&&0<e&&0<o&&""!=t&&""!=s&&0<n&&$.ajax({url:"/calendariolaboral/saveturno/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:r,id_perfillaboral:e,id_horario:o,fecha_ini:t,fecha_fin:s,id_tolerancia:i,id_jornada_laboral:n,observacion:l,opcion:a},success:function(a){var r=jQuery.parseJSON(a);if(1==r.result)c=!0;else{c=!1;var e=r.msj;$("#divMsjePorError").html(""),$("#divMsjePorError").append(e),$("#divMsjeNotificacionError").jqxNotification("open")}}}),c}function obtieneMesesInvolucrados(a){var e=[];return 0<a.length&&$.each(a,function(a,r){jQuery.inArray(r,e)<0&&e.push(r)}),e}function verificaSiFechaEstaEnRango(a,r,e){return $.ajax({url:"/perfileslaborales/checkinrange/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha_eval:a,fecha_ini:r,fecha_fin:e},success:function(a){}}).responseText}function retornaEstadoElaboracion(a,r,e,o){var i=!0,n=$("#calendar").fullCalendar("clientEvents"),t=[],s="";return $.each(n,function(a,r){var e=(r.className+"").split("_"),o=e[0];e[1],"r"==o&&null!=r.id&&t.push(r.id)}),0<t.length&&(s=t.join(",")),$.ajax({url:"/calendariolaboral/retornaestadoelaboracion/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id_perfillaboral:a,tipo_horario:r,id_horarios:s,fecha_ini:e,fecha_fin:o},success:function(a){1!=jQuery.parseJSON(a).result&&(i=!1)}}),i}function verificaExcesoHorasSemanales(){var a=!0,r=parseFloat($("#hdnJornadaLaboralSemanal").val());return r<parseFloat($("#spSumaSemana1").text())&&(a=!1),r<parseFloat($("#spSumaSemana2").text())&&(a=!1),r<parseFloat($("#spSumaSemana3").text())&&(a=!1),r<parseFloat($("#spSumaSemana4").text())&&(a=!1),r<parseFloat($("#spSumaSemana5").text())&&(a=!1),r<parseFloat($("#spSumaSemana6").text())&&(a=!1),a}function calculaExcesoPromedioTresSemanas(){var a=!0,r=parseFloat($("#hdnJornadaLaboralSemanal").val()),e=(parseFloat($("#spSumaSemana1").text()),parseFloat($("#spSumaSemana2").text())),o=parseFloat($("#spSumaSemana3").text()),i=parseFloat($("#spSumaSemana4").text());return parseFloat($("#spSumaSemana5").text()),parseFloat($("#spSumaSemana6").text()),r<parseFloat(e+o+i)/3&&(a=!1),a}