function definirListaDualNueva(p,a,e,r,t){if(0<e){var u=[],i=[],o=[],l=[],n="New",d=[];if(url=2==p?(n="Edit","/relaborales/listagrupadas/"):"/relaborales/listactivos/",$("#lstBox"+n+"A").html(""),$("#lstBox"+n+"B").html(""),$("#lstBox"+n+"A").jqxListBox("render"),$("#lstBox"+n+"B").jqxListBox("render"),$("#formNew")[0].reset(),$.ajax({url:url,type:"POST",datatype:"json",async:!1,cache:!1,data:{id_perfillaboral:a,id_ubicacion:e,fecha_ini:r,fecha_fin:t},success:function(a){u=jQuery.parseJSON(a)}}),i={localdata:u,datatype:"array"},l=new $.jqx.dataAdapter(i),2==p){var s=[],c=[];$.each(u,function(a,e){0==e.agrupador?s.push(e):c.push(e)}),i={localdata:s,datatype:"array"},l=new $.jqx.dataAdapter(i),d={localdata:c,datatype:"array"},o=new $.jqx.dataAdapter(d)}$("#lstBox"+n+"A").jqxListBox({multiple:!0,filterable:!0,allowDrop:!0,allowDrag:!0,source:l,width:"100%",height:250,displayMember:"nombres",valueMember:"id_relaboral",renderer:function(a,e,r){if(null==(d=u[a])||1!=p)return"number"===jQuery.type(r)?(t=(d=getOneByIdRelaboralInArray(u,r)).ci,i=d.expd,ImageExist(s="/images/personal/"+t+".jpg")||(s="/images/perfil-profesional.jpg"),o=d.cargo,l=d.fecha_ini,l=null!=d.fecha_fin?"Fechas: "+l+" AL "+d.fecha_fin:"Fecha Inicio: "+l,n='<img height="70" width="70" src="'+s+'"/>',$("#tbl_"+d.id_relaboral).remove(),c=d.fecha_incor,h=d.fecha_fin,""!=d.fecha_baja&&(h=d.fecha_baja),'<table id="tbl_'+d.id_relaboral+'" data-agrupador="'+d.agrupador+'" data-nombres="'+d.nombres+'" data-date-min="'+c+'" data-date-max="'+h+'" style="min-width: 130px;"><tr><td style="width: 80px;" rowspan="4">'+n+"</td><td>Nombres: "+d.nombres+"</td></tr><tr><td>CI: "+t+" "+i+"</td></tr><tr><td>Cargo: "+o+"</td></tr><tr><td>"+l+'<input type="hidden" id="hdn_'+d.id_relaboral+'" value="'+d.agrupador+'"></td></tr></table>'):"object"===jQuery.type(r)?(t=(d=r).ci,i=d.expd,ImageExist(s="/images/personal/"+t+".jpg")||(s="/images/perfil-profesional.jpg"),o=d.cargo,l=d.fecha_ini,l=null!=d.fecha_fin?"Fechas: "+l+" AL "+d.fecha_fin:"Fecha Inicio: "+l,n='<img height="70" width="70" src="'+s+'"/>',$("#tbl_"+d.id_relaboral).remove(),c=d.fecha_incor,h=d.fecha_fin,""!=d.fecha_baja&&(h=d.fecha_baja),'<table id="tbl_'+d.id_relaboral+'" data-agrupador="'+d.agrupador+'" data-nombres="'+d.nombres+'" data-date-min="'+c+'" data-date-max="'+h+'" style="min-width: 130px;"><tr><td style="width: 80px;" rowspan="4">'+n+"</td><td>Nombres: "+d.nombres+"</td></tr><tr><td>CI: "+t+" "+i+"</td></tr><tr><td>Cargo: "+o+"</td></tr><tr><td>"+l+'<input type="hidden" id="hdn_'+d.id_relaboral+'" value="'+d.agrupador+'"></td></tr></table>'):void 0;var t=d.ci,i=d.expd;ImageExist(s="/images/personal/"+t+".jpg")||(s="/images/perfil-profesional.jpg");var o=d.cargo,l=d.fecha_ini;l=null!=d.fecha_fin?"Fechas: "+l+" AL "+d.fecha_fin:"Fecha Inicio: "+l;var n='<img height="70" width="70" src="'+s+'"/>';$("#tbl_"+d.id_relaboral).remove();var d,s,c=d.fecha_incor,h=d.fecha_fin;return""!=d.fecha_baja&&(h=d.fecha_baja),'<table id="tbl_'+d.id_relaboral+'" data-agrupador="'+d.agrupador+'" data-nombres="'+d.nombres+'" data-date-min="'+c+'" data-date-max="'+h+'" style="min-width: 130px;"><tr><td style="width: 80px;" rowspan="4">'+n+"</td><td>Nombres: "+d.nombres+"</td></tr><tr><td>CI: "+t+" "+i+"</td></tr><tr><td>Cargo: "+o+"</td></tr><tr><td>"+l+'<input type="hidden" id="hdn_'+d.id_relaboral+'" value="'+d.agrupador+'"></td></tr></table>'},ready:function(){var a=$("#lstBox"+n+"A").jqxListBox("getItems");$("#spanContadorLstBox"+n+"A").text(a.length)}}),$("#lstBox"+n+"B").jqxListBox({multiple:!0,filterable:!0,allowDrop:!0,allowDrag:!0,source:o,width:"100%",height:250,renderer:function(a,e,r){if(null==(d=u[a])||1!=p)return"number"===jQuery.type(r)?(t=(d=getOneByIdRelaboralInArray(u,r)).ci,i=d.expd,ImageExist(s="/images/personal/"+t+".jpg")||(s="/images/perfil-profesional.jpg"),o=d.cargo,l=d.fecha_ini,l=null!=d.fecha_fin?"Fechas: "+l+" AL "+d.fecha_fin:"Fecha Inicio: "+l,n='<img height="70" width="70" src="'+s+'"/>',$("#tbl_"+d.id_relaboral).remove(),c=d.fecha_incor,h=d.fecha_fin,""!=d.fecha_baja&&(h=d.fecha_baja),'<table id="tbl_'+d.id_relaboral+'" data-agrupador="'+d.agrupador+'" data-nombres="'+d.nombres+'" data-date-min="'+c+'" data-date-max="'+h+'" style="min-width: 130px;"><tr><td style="width: 80px;" rowspan="4">'+n+"</td><td>Nombres: "+d.nombres+"</td></tr><tr><td>CI: "+t+" "+i+"</td></tr><tr><td>Cargo: "+o+"</td></tr><tr><td>"+l+'<input type="hidden" id="hdn_'+d.id_relaboral+'" value="'+d.agrupador+'"></td></tr></table>'):"object"===jQuery.type(r)?(t=(d=r).ci,i=d.expd,ImageExist(s="/images/personal/"+t+".jpg")||(s="/images/perfil-profesional.jpg"),o=d.cargo,l=d.fecha_ini,l=null!=d.fecha_fin?"Fechas: "+l+" AL "+d.fecha_fin:"Fecha Inicio: "+l,n='<img height="70" width="70" src="'+s+'"/>',$("#tbl_"+d.id_relaboral).remove(),c=d.fecha_incor,h=d.fecha_fin,""!=d.fecha_baja&&(h=d.fecha_baja),'<table id="tbl_'+d.id_relaboral+'" data-agrupador="'+d.agrupador+'" data-nombres="'+d.nombres+'" data-date-min="'+c+'" data-date-max="'+h+'" style="min-width: 130px;"><tr><td style="width: 80px;" rowspan="4">'+n+"</td><td>Nombres: "+d.nombres+"</td></tr><tr><td>CI: "+t+" "+i+"</td></tr><tr><td>Cargo: "+o+"</td></tr><tr><td>"+l+'<input type="hidden" id="hdn_'+d.id_relaboral+'" value="'+d.agrupador+'"></td></tr></table>'):void 0;var t=d.ci,i=d.expd;ImageExist(s="/images/personal/"+t+".jpg")||(s="/images/perfil-profesional.jpg");var o=d.cargo,l=d.fecha_ini;l=null!=d.fecha_fin?"Fechas: "+l+" AL "+d.fecha_fin:"Fecha Inicio: "+l;var n='<img height="70" width="70" src="'+s+'"/>';$("#tbl_"+d.id_relaboral).remove();var d,s,c=d.fecha_incor,h=d.fecha_fin;return""!=d.fecha_baja&&(h=d.fecha_baja),'<table id="tbl_'+d.id_relaboral+'" data-agrupador="'+d.agrupador+'" data-nombres="'+d.nombres+'" data-date-min="'+c+'" data-date-max="'+h+'" style="min-width: 130px;"><tr><td style="width: 80px;" rowspan="4">'+n+"</td><td>Nombres: "+d.nombres+"</td></tr><tr><td>CI: "+t+" "+i+"</td></tr><tr><td>Cargo: "+o+"</td></tr><tr><td>"+l+'<input type="hidden" id="hdn_'+d.id_relaboral+'" value="'+d.agrupador+'"></td></tr></table>'},ready:function(){var a=$("#lstBox"+n+"B").jqxListBox("getItems");$("#spanContadorLstBox"+n+"B").text(a.length)}}),$("#lstBox"+n+"A,#lstBox"+n+"B").off(),$("#lstBox"+n+"A,#lstBox"+n+"B").on("dragEnd",function(){var a=$("#lstBox"+n+"A").jqxListBox("getItems"),e=$("#lstBox"+n+"B").jqxListBox("getItems");$("#spanContadorLstBox"+n+"A").text(a.length),$("#spanContadorLstBox"+n+"B").text(e.length)}),$("#clearFilter"+n+"A").jqxButton(),$("#clearFilter"+n+"A").click(function(){$("#lstBox"+n+"A").jqxListBox("clearFilter")}),$("#clearFilter"+n+"B").jqxButton(),$("#clearFilter"+n+"B").click(function(){$("#lstBox"+n+"B").jqxListBox("clearFilter")})}}function ImageExist(a){var e=new Image;return e.src=a,0!=e.height}function validaFormularioPorNuevoRegistroAsignacionPerfilLaboral(a){var d=!0,e="",r=null,t="New";2==a&&(t="Edit"),$(".msjs-alert").hide();var s=$("#hdnIdPerfilLaboral"+t).val();limpiarMensajesErrorPorValidacionNuevoRegistroAsignacionPerfilLaboral(a);var c=$("#lstUbicaciones"+t).val(),i=0,o=$("#lstUbicaciones"+t+" option:selected").data("cant-nodos-hijos"),h=$("#txtFechaIni"+t).val(),p=$("#txtFechaFin"+t).val();null==c||""==c||0==c?(d=!1,e="Debe seleccionar la ubicaci&oacute;n necesariamente.",$("#divUbicaciones"+t).addClass("has-error"),$("#helpErrorUbicaciones"+t).html(e),null==r&&(r=$("#lstUbicaciones"+t))):0<o&&(i=$("#lstEstaciones"+t).val(),null==(c=i)||""==i||0==i)&&(d=!1,e="Debe seleccionar la estaci&oacute;n necesariamente.",$("#divEstaciones"+t).addClass("has-error"),$("#helpErrorEstaciones"+t).html(e),null==r&&(r=$("#lstEstaciones"+t))),null!=h&&""!=h||(d=!1,e="Debe introducir la fecha de inicio.",$("#divFechaIni"+t).addClass("has-error"),$("#helpErrorFechaIni"+t).html(e),null==r&&(r=$("#txtFechaIni"+t))),""!=p&&null!=p||(d=!1,e="Debe introducir la fecha de finalizaci&oacute;n.",$("#divFechaFin"+t).addClass("has-error"),$("#helpErrorFechaFin"+t).html(e),null==r&&(r=$("#txtFechaFin"+t))),d&&procesaTextoAFecha(p,"-")<procesaTextoAFecha(h,"-")&&(d=!1,e="La fecha de inicio no puede ser superior a la fecha de finalizaci&oacute;n.",$("#divFechaIni"+t).addClass("has-error"),$("#helpErrorFechaIni"+t).html(e),$("#divFechaFin"+t).show(),$("#divFechaFin"+t).addClass("has-error"),$("#helpErrorFechaFin"+t).html(e),null==r&&(r=$("#txtFechaFin"+t)));var l=$("#lstBox"+t+"B").jqxListBox("getItems");return 0<l.length&&$.each(l,function(a,e){var r=e.value,t=0;"object"===jQuery.type(e.value)&&(r=r.id_relaboral),0<$("#tbl_"+r).data("agrupador")&&(t=$("#tbl_"+r).data("agrupador"));var i=$("#tbl_"+r).data("nombres");if(null==i&&(i=" una persona."),verificaSobrePosicionDePerfiles(t,r,s,c,h,p)){d=!1;var o="Existe ya un registro de perfil con sobreposici&oacute;n con el perfil que intenta registrar para "+i+".";$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")}var l=$("#tbl_"+r).data("date-min"),n=$("#tbl_"+r).data("date-max");procesaTextoAFecha(l,"-")>procesaTextoAFecha(h,"-")&&(d=!1,o="La fechas establecidas para la asignaci&oacute;n: ("+h+" al "+p+"), tienen conflicto con las fechas de relaci&oacute;n laboral para "+i+" cuyas fechas v&aacute;lidas deben estar entre: ("+l+" al "+n+").",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open")),procesaTextoAFecha(n,"-")<procesaTextoAFecha(p,"-")&&(d=!1,o="La fechas establecidas para la asignaci&oacute;n: ("+h+" al "+p+"), tienen conflicto con las fechas de relaci&oacute;n laboral para "+i+" cuyas fechas v&aacute;lidas deben estar entre: ("+l+" al "+n+").",$("#divMsjePorError").html(""),$("#divMsjePorError").append(o),$("#divMsjeNotificacionError").jqxNotification("open"))}),null!=r&&r.focus(),d}function limpiarMensajesErrorPorValidacionNuevoRegistroAsignacionPerfilLaboral(a){var e="New";2==a&&(e="Edit"),$("#divUbicaciones"+e).removeClass("has-error"),$("#helpErrorUbicaciones"+e).html(""),$("#divEstaciones"+e).removeClass("has-error"),$("#helpErrorEstaciones"+e).html(""),$("#divFechaIni"+e).removeClass("has-error"),$("#helpErrorFechaIni"+e).html(""),$("#divFechaFin"+e).removeClass("has-error"),$("#helpErrorFechaFin"+e).html("")}function getOneByIdRelaboral(a){var r=[];if(0<a)return $.ajax({url:"/relaborales/getone/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:a},success:function(a){var e=jQuery.parseJSON(a);0<e.length&&(r=e[0])}}),r}function getOneByIdRelaboralInArray(a,r){var t=[];return 0<a.length&&0<r&&$.each(a,function(a,e){if(r==e.id_relaboral)return t.push(e),!1}),0<t.length?t[0]:t}function guardaFormularioRegistroAsignacionGroupPerfilLaboral(a,i){var o=!0,e="New";2==a&&(e="Edit");var l=$("#lstUbicaciones"+e).val(),n=0;0<$("#lstUbicaciones"+e+" option:selected").data("cant-nodos-hijos")&&(n=$("#lstEstaciones"+e).val());var d=$("#txtFechaIni"+e).val(),s=$("#txtFechaFin"+e).val();if(0<i){var r=$("#lstBox"+e+"B").jqxListBox("getItems");if(0<r.length&&$.each(r,function(a,e){var r=e.value,t=0;"number"===jQuery.type(e.value)||(r=r.id_relaboral),0<$("#tbl_"+r).data("agrupador")&&(t=$("#tbl_"+r).data("agrupador")),guardaRegistroAsignacionPerfilLaboral(2,t,r,i,l,n,d,s,"")||(o=!1)}),2==a){var c=!0,t=$("#lstBox"+e+"A").jqxListBox("getItems");0<t.length&&$.each(t,function(a,e){var r=e.value,t=0;"object"===jQuery.type(e.value)&&(r=r.id_relaboral),0<$("#hdn_"+r).val()&&(t=$("#tbl_"+r).data("agrupador")),0<t&&(c=bajaRegistroAsignacionPerfilLaboral(t)),c||(o=!1)})}}else o=!1;return o}function guardaRegistroAsignacionPerfilLaboral(a,e,r,t,i,o,l,n,d,s,c,h,p){var u=!1;return 0<o&&(i=o),0<n&&(l=n),0<r&&0<t&&0<i&&0<l&&""!=d&&""!=s&&$.ajax({url:"/relaboralesperfiles/save/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e,id_relaboral:r,id_perfillaboral:t,id_ubicacion_entrada:i,id_ubicacion_salida:l,fecha_ini:d,fecha_fin:s,tipo_marcacion_entrada:c,tipo_marcacion_salida:h,observacion:p,opcion:a},success:function(a){var e=jQuery.parseJSON(a);1==e.result?u=!0:($("#divMsjePorError").html(""),$("#divMsjePorError").append(e.msj),$("#divMsjeNotificacionError").jqxNotification("open"))}}),u}function bajaRegistroAsignacionPerfilLaboral(a){var t=!1;return 0<a&&$.ajax({url:"/relaboralesperfiles/down/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:a},success:function(a){var e=jQuery.parseJSON(a);if(1==e.result)t=!0;else{t=!1;var r=e.msj;$("#divMsjePorError").html(""),$("#divMsjePorError").append(r),$("#divMsjeNotificacionError").jqxNotification("open")}}}),t}function verificaSobrePosicionDePerfiles(a,e,r,t,i,o){var l=!1;return 0<e&&0<r&&0<t&&""!=i&&""!=o&&$.ajax({url:"/relaboralesperfiles/verifyoverlaydates/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:a,id_relaboral:e,id_perfillaboral:r,id_ubicacion:t,fecha_ini:i,fecha_fin:o},success:function(a){1==jQuery.parseJSON(a).result&&(l=!0)}}),l}